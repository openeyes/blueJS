Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,a)=>{if("function"!=typeof a)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(a._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=a,a._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",(()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")}),{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),a=()=>t.next().value;function o(){this.map=new Map,this.dataAttr="data-bjc"}e.extend("getKey",a),o.prototype.add=function(e,t){const o=a();return this.map.set(o,e),t.setAttribute(this.dataAttr,o),o},o.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},o.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},o.prototype.getFirst=function(){return this.map.values().next().value},o.prototype.next=function(e){const t=this.map.keys();let a=t.next();for(;!a.done;){if(a.value===e)return t.next().value;a=t.next()}},o.prototype.prev=function(e){const t=this.map.keys();let a=!1;for(const o of t){if(o===e)return a;a=o}},o.prototype.has=function(e){return this.map.has(e)},o.prototype.delete=function(e){return this.map.delete(e)},e.extend("Collection",o)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",((e,t)=>{const a=new CustomEvent(e,{detail:t});document.dispatchEvent(a)}))})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,a=new Map,o=new Map,s=new Map,r=new Set,n=(e,t,a)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,a)},i=(e,t)=>{const a=e.target;if(a===document)return!1;t.forEach(((t,o)=>{a.matches(o)&&t(e)}))},l=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout((()=>{r.forEach((e=>{e()}))}),150)}}})();function d(e){i(e,a)}function c(e){i(e,t)}function y(e){i(e,o)}window.onresize=()=>l.delay();let u=e=>{document.removeEventListener("mouseenter",d,{capture:!0}),document.removeEventListener("mousedown",c,{capture:!0}),document.removeEventListener("mouseleave",y,{capture:!0}),i(e,t),u=e=>{i(e,t)}};document.addEventListener("mouseenter",d,{capture:!0}),document.addEventListener("mousedown",c,{capture:!0}),document.addEventListener("mouseleave",y,{capture:!0}),document.addEventListener("touchstart",(e=>u(e)),{capture:!0}),document.addEventListener("click",(e=>i(e,s)),{capture:!0}),e.extend("userEnter",((e,t)=>n(a,e,t))),e.extend("userDown",((e,a)=>n(t,e,a))),e.extend("userLeave",((e,t)=>n(o,e,t))),e.extend("userClick",((e,t)=>n(s,e,t))),e.extend("listenForResize",(e=>r.add(e)))})(bluejay),(function(e){"use strict";const t=e=>{console.log(e),e.parentNode.removeChild(e)};const a=(function*(){let e=1;for(;;)++e,yield`bj${e}`})();e.extend("nodeArray",(e=>Array.prototype.slice.call(e))),e.extend("find",((e,t)=>(t||document).querySelector(e))),e.extend("getParent",((e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1})),e.extend("wrap",((e,t="")=>{const a=document.createElement("div"),o=window.getComputedStyle(e);return a.style.width=o.getPropertyValue("width"),a.style.position="relative",a.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(a,e),a.appendChild(e),a})),e.extend("unwrap",(e=>{const a=e.parentNode,o=a.parentNode;e.style.width="",o.insertBefore(e,a),t(a)})),e.extend("div",((e,t=!1)=>{const a=document.createElement("div");return a.className=e,t&&(a.innerHTML=t),a})),e.extend("dom",((e,t=!1,a=!1)=>{const o=document.createElement(e);return t&&(o.className=t),a&&(o.innerHTML=a),o})),e.extend("remove",t),e.extend("show",((e,t="")=>{null!==e&&(e.style.display=t)})),e.extend("reshow",(e=>{null!==e&&(e.style.display="")})),e.extend("hide",(e=>{null!==e&&(e.style.display="none")})),e.extend("empty",(e=>{e.firstChild&&(e.textContent=null)})),e.extend("xhr",((t,a=!1)=>(e.log("[XHR] - "+t),new Promise(((o,s)=>{let r=new XMLHttpRequest;r.open("GET",t),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?(e.log("[XHR] - Success"),r.token=a,o({html:r.responseText,token:a})):(e.log("[XHR] - Failed"),s(this.status+" "+this.statusText)))},r.send()}))))),e.extend("getToken",(()=>a.next().value)),e.extend("loadJS",((t,a=!1)=>(e.log("[JS script] - "+t),new Promise(((o,s)=>{const r=document.createElement("script");r.src=t,a&&r.setAttribute("crossorigin",""),r.onload=()=>{setTimeout((()=>{e.log("[JS loaded] - "+t),o()}),100)},r.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(r)}))))),e.extend("getHiddenElemSize",(e=>{e.parentNode;e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t})),e.extend("idgReporter",(e=>{let t="idg-js-ui-message-out",a=document.getElementById(t),o=document.createElement("li");null===a&&(a=document.createElement("ul"),a.id=t,a.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(a));let s=a.children.length;o.appendChild(document.createTextNode(s+" - "+e)),a.appendChild(o)})),e.extend("clock24",(e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")))})(bluejay),(function(e){"use strict";const t=[],a=new Map;e.extend("addModule",(e=>t.push(e))),e.extend("registeredModules",(()=>(t.sort(),t.join(", ")))),e.extend("namespace",(e=>(a.has(e)||a.set(e,{}),a.get(e))))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",(()=>({views:Object.create(t())})))})(),(function(e){"use strict";let t=window.innerWidth,a=window.innerHeight;e.listenForResize((()=>{t=window.innerWidth,a=window.innerHeight}));const o=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",(t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}})),e.extend("getWinH",(()=>a)),e.extend("getWinW",(()=>t)),e.extend("getDataAttributeName",o),e.extend("setDataAttr",((e,t)=>{e.setAttribute(o(),t)})),e.extend("getDataAttr",(e=>{const t=o();return!!e.hasAttribute(t)&&e.getAttribute(t)}))})(bluejay),(function(e,t){"use strict";e.log("Plot.ly version: "+Plotly.version),t.isDarkTheme=()=>"dark"===window.oeThemeMode;const a={blue:"#63d7d6",highlight:"#fff",green:"#65d235",red:"#ea2b34",greenSeries:["#65d235","#A5D712","#02B546"],redSeries:["#ea2b34","#F64A2D","#C92845"],yellowSeries:["#FAD94B","#E8B131","#F1F555"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},o={blue:"#00f",highlight:"#000",green:"#418c20",red:"#da3e43",greenSeries:["#418c20","#598617","#139149"],redSeries:["#da3e43","#E64C02","#E64562"],yellowSeries:["#FCCE14","#E69812","#FCBB21"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]};t.getBlue=e=>e?a.blue:o.blue,t.getColorSeries=(e,t)=>{let s=null;const r=a,n=o;switch(e){case"varied":s=t?r.varied:n.varied;break;case"posNeg":s=t?r.dual:n.dual;break;case"rightEyeSeries":s=t?r.greenSeries:n.greenSeries;break;case"leftEyeSeries":s=t?r.redSeries:n.redSeries;break;case"BEOSeries":s=t?r.yellowSeries:n.yellowSeries;break;default:s=t?r.standard:n.standard}return s},t.getColor=(e,t)=>{switch(e){case"highlight":return t?a.highlight:o.highlight;case"rightEye":return t?a.green:o.green;case"leftEye":return t?a.red:o.red;default:return"pink"}},t.getColorFor=(e,t)=>getColor(e,t)})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,a=[];let o,s=0;const r=e=>{s=e.target.selectedIndex;for(const e of t.keys())o(e)};return{init:t=>{o=t.plotlyUpdate;const n=t.darkTheme,i=t.axisDefaults,l=i.title,d=[];t.unitRanges.forEach(((t,o)=>{let r;t.makeDefault&&(s=o),d.push(t.option),i.title=`${l} - ${t.option}`,r="number"==typeof t.range[0]?Object.assign({},i,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},i,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),a.push(e.getAxis(r,n))})),(e=>{const t=['<div class="plot-tool">',"<label>VA Scale</label>","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>","</div>"].join(""),a=document.createElement("div");a.className="oeplot-toolbar",a.innerHTML=Mustache.render(t,{options:e});const o=document.querySelector(".oeplot");o.classList.add("with-toolbar"),o.append(a);let n=a.querySelector("select");n.options[s].selected=!0,n.addEventListener("change",r,!1)})(d)},addTrace:(e,a)=>{t.has(e)?t.get(e).push(a):t.set(e,[a])},selectedTrace:e=>t.get(e)[s],selectedAxis:()=>a[s]}}})(bluejay.namespace("oePlot")),(function(e){"use strict";bluejay.namespace("oePlot").findRegression=function(e,t){let a=0,o=0,s=0,r=0,n=0,i=0,l=0,d=e.length;if(d!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===d)return[[],[]];for(let c=0;c<d;c++)i=e[c],l=t[c],a+=i,o+=l,r+=i*i,s+=i*l,n++;const c=(n*s-a*o)/(n*r-a*a),y=o/n-c*a/n;let u=[],p=[];for(let t=0;t<d;t++)i=e[t],l=i*c+y,u.push(parseFloat(Number.parseFloat(i).toFixed(2))),p.push(parseFloat(Number.parseFloat(l).toFixed(2)));return{x:u,y:p}}})(),(function(e){"use strict";e.axisGridColor=e=>e?"#292929":"#e6e6e6",e.axisTickColor=e=>e?"#666":"#ccc",e.getAxis=function(t,a){let o={linecolor:a?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:e.axisGridColor(a),tickmode:"auto",nticks:10,ticks:"outside",ticklen:3,tickcolor:e.axisTickColor(a),automargin:!0,mirror:!0,connectgaps:!1};const s="y"==t.type;if(t.noMirrorLines&&(o.mirror=!1),t.domain&&s&&(o.domain=t.domain),t.title&&(o.title={text:t.title,standoff:s?10:20,font:{size:12}}),t.rightSide&&s&&(o.overlaying=t.rightSide,o.side="right",o.showgrid=!1,o.zeroline=!1,o.title.standoff=15),t.maxAxisTicks&&(o.nticks=t.maxAxisTicks),t.useDates&&(o.tickformat="%b %Y"),t.fixRange&&(o.fixedrange=!0),t.range&&(o.range=t.range),t.axisType&&(o.type=t.axisType),t.useCategories){let e=t.useCategories.categoryarray;if(o.type="category",o.categoryarray=e,t.useCategories.rangeFit)switch(t.useCategories.rangeFit){case"exact":o.range=[0,e.length-1];break;case"pad":o.range=[-1,e.length];break;case"padTop":o.range=[0,e.length];break;case"padBottom":o.range=[-1,e.length-1]}}return t.spikes&&(o.showspikes=!0,o.spikecolor=a?"#0ff":"#00f",o.spikethickness=a?.5:1,o.spikedash=a?"1px,3px":"2px,3px"),o}})(bluejay.namespace("oePlot")),(function(e){"use strict";e.getLayout=function(t){const a=t.darkTheme,o={isDark:a,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:40,pad:4,autoexpand:!0},paper_bgcolor:a?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:a?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:a?"#aaa":"#333"},hoverlabel:{bgcolor:a?"#003":"#fff",bordercolor:a?"#009":"#00f",font:{size:11,color:e.getBlue(a)}},shapes:[],annotations:[]};if(t.colors?o.colorway=e.getColorSeries(t.colors,a):o.colorway=e.getColorSeries("default",a),t.plotTitle&&(o.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},o.margin.t=50),t.legend){o.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?o.legend=e:o.legend=Object.assign(e,t.legend)}else o.showlegend=!1;if(t.subplot&&(o.grid={rows:t.subplot,columns:1,pattern:"independent"}),t.xaxis&&(o.xaxis=t.xaxis,o.xaxis.title&&(o.margin.b=80)),t.yaxes&&t.yaxes.forEach(((e,t)=>{t?o["yaxis"+(t+1)]=e:o.yaxis=e,e.title&&("right"==e.side?o.margin.r=80:o.margin.l=80)})),t.rangeSlider){const e={thickness:.08};a&&(e.bgcolor=o.paper_bgcolor,e.borderwidth=1,e.bordercolor=o.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),o.xaxis.rangeslider=e,o.margin.b=15}return t.dateRangeButtons&&(o.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(a))),o}})(bluejay.namespace("oePlot")),(function(e,t){"use strict";t.buildDiv=(t,a=!1)=>{const o=e.div("oeplot-wrap");return o.classList.add(t.toLowerCase()),a&&(o.style.width=a),o},t.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter((e=>null!==e));return[e[0],e.pop()]}}),t.addClickEvent=(t,a)=>{t.on("plotly_click",(function(t){const o=t.points[0];let s={eye:a,name:o.data.name,index:o.pointIndex,x:o.x,y:o.y};e.customEvent("oePlotClick",s),e.log('"oePlotClick" Event data: '+JSON.stringify(s))}))},t.addHoverEvent=(t,a)=>{t.on("plotly_hover",(function(t){const o=t.points[0];let s={eye:a,name:o.data.name,index:o.pointIndex,x:o.x,y:o.y};e.customEvent("oePlotHover",s)}))},t.dataLine=e=>{let a={};return e.color&&(a.color=e.color),e.dashed&&(a=Object.assign(a,t.dashedLine())),a},t.dashedLine=()=>({dash:"2px,2px",width:2}),t.markerFor=e=>{const t={};switch(e){case"managment":t.symbol="square",t.size=9;break;case"image":t.symbol="triangle-down",t.size=11;break;case"drug":t.symbol="diamond",t.size=9;break;case"injection":t.symbol="star-diamond",t.size=10}return t},t.eventStyle=(e,a=!1)=>{const o={marker:t.markerFor(e)};switch(e){case"managment":case"image":case"injection":o.mode="markers";break;case"drug":o.mode="lines+markers",o.line={width:3}}return a&&(o.marker&&(o.marker.color=a),o.line&&(o.line.color=a)),o},t.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(225,225,225)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),t.addDropDown=e=>{let a=[];a.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),a.push({method:"update",args:[{},{title:"some new title",colorway:t.getColorSeries("default",!0)}],label:"Options Title"});let o=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:a},t.buttonStyling());e.updatemenus=[o]}})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";e.highlightPoint=t=>(a,o)=>{let s=a.split(".");if(2!=s.length)return void bj.log('oePlot - for highlightPoint to work it need side and trace name: "leftEye.OCT" ');let r,n,i=s[0],l=s[1],d=0;t.get(i).get("data").forEach(((e,t)=>{t===l&&(r=e,n=d),d++}));let c=e.getColor(i,e.isDarkTheme()),y=[];for(let e=0;e<r.x.length;e++)y.push(c);y[o]=e.getColor("highlight",e.isDarkTheme());let u=e.markerFor(r.oeEventType);u.color=y,Plotly.restyle(t.get(i).get("div"),{marker:u},[n])}})(bluejay.namespace("oePlot")),(function(e){"use strict";e.addLayoutVerticals=(t,a,o)=>{if(!Array.isArray(a))throw new Error("[oePlot] addLayoutVerticals - must be an Array");t.shapes=t.shapes.concat(a.map((({x:t})=>({type:"line",layer:"above",yref:"paper",x0:t,y0:0,x1:t,y1:o,line:{color:e.getBlue(e.isDarkTheme()),width:.5}})))),t.annotations=t.annotations.concat(a.map((({name:t,x:a})=>({showarrow:!1,text:t,textangle:90,align:"left",font:{color:e.getBlue(e.isDarkTheme())},borderpad:2,x:a,xshift:8,yref:"paper",y:o}))))},e.addLayoutHorizontals=(t,a,o)=>{if(!Array.isArray(a))throw new Error("[oePlot] addLayoutVerticals - must be an Array");t.shapes=t.shapes.concat(a.map((({y:t})=>({type:"line",layer:"below",xref:"paper",yref:o,x0:0,y0:t,x1:1,y1:t,line:{color:e.getBlue(e.isDarkTheme()),width:2,dash:"3px,12px"}})))),t.annotations=t.annotations.concat(a.map((({name:t,y:a})=>({showarrow:!1,text:t,align:"left",font:{color:e.getBlue(e.isDarkTheme())},borderpad:2,xref:"paper",x:0,yshift:8,yref:o,y:a}))))}})(bluejay.namespace("oePlot")),(function(e,t){"use strict";t.tools=()=>{const a=e.div("oeplot-toolbar"),o={_render:null,_plots:null,setReacts(e,t=!1){this._render=e,this._plots=t},update(){this._plots.forEach((e=>this._render(e)))}},s={_popup:null,add(t){const o=e.div("oe-popup-wrap");this._popup=o,o.innerHTML=['<div class="oe-popup">','<div class="title">Tabular Data of plots</div>','<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>','<div class="oe-popup-content max"></div>',"</div>"].join("");const s=document.getElementById(t);o.querySelector(".oe-popup-content").append(s),e.show(s);const r=e.div("plot-tool"),n=document.createElement("button");n.textContent="View tabular data of plots",r.append(n),n.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.show()}),{capture:!0}),a.append(r)},show(){document.body.append(this._popup),this._popup.querySelector(".close-icon-btn").addEventListener("mousedown",(e=>{e.stopPropagation(),this.hide()}),{once:!0})},hide(){this._popup.remove()}},r={_mode:"closest",getMode(){return this._mode},add(){const t=e.div("plot-tool");t.innerHTML=Mustache.render(["<label>Labels</label>","<select>{{#options}}",'<option value="{{key}}" {{#selected}}selected{{/selected}}>{{option}}</option>',"{{/options}}</select>"].join(""),{options:[{key:"closest",option:"Single",selected:!0},{key:"x",option:"Closest",selected:!1},{key:"x unified",option:"Grouped",selected:!1}]}),t.querySelector("select").addEventListener("change",(e=>{const t=e.target;this._mode=t.options[t.selectedIndex].value,o.update()}),{capture:!0}),a.append(t)}},n={traces:new Map,axes:new Map,activeKey:null,getTrace(e,t){return this.traces.get(e).get(this.activeKey)},getAxis(e){return this.axes.get(this.activeKey)},addTrace(e,t,a){this.traces.has(e)||this.traces.set(e,new Map),this.traces.get(e).set(t,a)},addAxes({axisDefaults:e,yaxes:a,prefix:o}){const s=[];for(const[r,n]of Object.entries(a)){let a;n.makeDefault&&(this.activeKey=r),e.title=`${o} - ${n.option}`,a="number"==typeof n.range[0]?t.getAxis(Object.assign({},e,{range:n.range,axisType:"linear"}),t.isDarkTheme()):t.getAxis(Object.assign({},e,{useCategories:{showAll:!0,categoryarray:n.range}}),t.isDarkTheme()),this.axes.set(r,a),s.push({key:r,option:n.option,selected:n.makeDefault})}this.buildDropDown(s,o)},buildDropDown(t,s){const r=e.div("plot-tool");r.innerHTML=Mustache.render(["<label>{{prefix}}</label>","<select>{{#options}}",'<option value="{{key}}" {{#selected}}selected{{/selected}}>{{option}}</option>',"{{/options}}</select>"].join(""),{options:t,prefix:s}),r.querySelector("select").addEventListener("change",(e=>{const t=e.target;this.activeKey=t.options[t.selectedIndex].value,o.update()}),{capture:!0}),a.append(r)},updateAxesColors(){const e=this.axes.values();for(const a of e)a.gridcolor=t.axisGridColor(t.isDarkTheme()),a.tickcolor=t.axisTickColor(t.isDarkTheme())},clearTraces(){this.traces.clear()}};return{plot:o,tabularData:s,hoverMode:r,selectableUnits:n,showToolbar:()=>{const e=document.querySelector(".oeplot");e.classList.add("with-toolbar"),e.append(a)}}}})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";new Map;e.extend("plotPatientPopup",((e=null)=>{}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const a=t.isDarkTheme();e.extend("plotBarChart",((o=null)=>{if(null===o)return e.log("[oePlot] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlot] - building Plot.ly Bar Chart");const s=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(o),r=t.getAxis({type:"x",numTicks:20},a),n=t.getAxis({type:"y",numTicks:20},a);o.title.xaxis&&(r.title=o.title.xaxis),o.title.yaxis&&(n.title=o.title.yaxis),console.log(o),(e=>{const o=t.getLayout({darkTheme:a,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});o.barmode="stack",Plotly.react(e.div,e.data,o,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(o.dom),title:o.title.plot,data:s,xaxis:r,yaxes:[n]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const a="Bar Percent Complete",o=t.isDarkTheme();e.extend("plotBarPercentComplete",((s=null)=>{if(null===s)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${a} ??`),!1;e.log(`[oePlot] - building Plot.ly ${a}`);const r=(e=>{let t=e.percentComplete.map((e=>100-e));return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(s),n=t.getAxis({type:"x",numTicks:20},o),i=t.getAxis({type:"y",range:[0,100],numTicks:20},o);(e=>{const a=t.getLayout({darkTheme:o,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});a.barmode="stack",Plotly.react(e.div,e.data,a,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),data:r,xaxis:n,yaxes:[i]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const a="Combined Medical Retina",o=t.isDarkTheme(),s=new Map,r=t.fullDateRange(),n=t.selectableUnits(),i=(e,a,o)=>{const i=(()=>{let e=0;return()=>{let t=e++;return e>=o.length&&(e=0),o[t]}})();s.get(a).set("data",new Map);const l={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:i()})};s.get(a).get("data").set(e.VA.offScale.name,l),r.add(e.VA.offScale.x);const d={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:i(),dashed:!0})};s.get(a).get("data").set(e.CRT.name,d),r.add(e.CRT.x);const c=i();Object.values(e.VA.units).forEach(((e,o)=>{n.addTrace(a,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:c})}),o||r.add(e.x)})),s.get(a).get("data").set("VA",n.selectedTrace(a))},l=()=>{let e=[];["rightEye","leftEye","BEO"].forEach((t=>{if(s.has(t)){let a=s.get(t).get("data");a.set("VA",n.selectedTrace(t)),e=e.concat(Array.from(a.values()))}})),s.get("layout").yaxis3=Object.assign({},n.selectedAxis()),Plotly.react(s.get("div"),e,s.get("layout"),{displayModeBar:!1,responsive:!0})};e.extend("plotCombinedMedRet",((d=null)=>{if(null===d)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${a} ??`),!1;e.log(`[oePlot] - building Plot.ly ${a}`);const c=[[0,.15],[.2,1]];n.init({darkTheme:o,plotlyUpdate:l,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(d.yaxis.unitRanges)}),d.rightEye&&(s.set("rightEye",new Map),i(d.rightEye,"rightEye",t.getColorSeries("rightEyeSeries",o))),d.leftEye&&(s.set("leftEye",new Map),i(d.leftEye,"leftEye",t.getColorSeries("leftEyeSeries",o))),d.BEO&&(s.set("BEO",new Map),i(d.BEO,"BEO",t.getColorSeries("BEOSeries",o)));(e=>{const n=t.getLayout({darkTheme:o,legend:{yanchor:"top",y:1},plotTitle:"Right, Left and BEO",xaxis:e.x,yaxes:e.y,subplot:2,rangeSlider:r.firstLast(),dateRangeButtons:!0}),i=t.buildDiv(`${a}`,"80vh","650px");document.querySelector(".oes-left-side").appendChild(i),s.set("div",i),s.set("layout",n),l(),t.addClickEvent(i,"?"),t.addHoverEvent(i,"?"),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(i,n)}))})({x:t.getAxis({type:"x",numTicks:10,useDates:!0,range:r.firstLast(),spikes:!0,noMirrorLines:!0},o),y:[t.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:d.yaxis.offScale.reverse()},spikes:!0},o),t.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},o),n.selectedAxis()]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const a="Combined Medical Retina",o=t.isDarkTheme(),s=new Map,r=(e,a,o)=>{const r=(()=>{let e=0;return()=>{let t=e++;return e>=o.length&&(e=0),o[t]}})();s.get(a).set("data",new Map);const n={x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",mode:"lines+markers",yaxis:"y2",line:t.dataLine({color:r()}),error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}};s.get(a).get("data").set("VA",n);const i={x:e.CRT.x,y:e.CRT.y,name:"CRT",hovertemplate:"Mean ± SD<br>CRT: %{y}<br>(N: %{x})",type:"scatter",line:t.dataLine({color:r(),dashed:!0}),error_y:{type:"data",array:e.CRT.error_y,visible:!0,thickness:.5}};s.get(a).get("data").set(e.CRT.name,i)};e.extend("plotCombinedOutcomesWithErrors",((n=null)=>{if(null===n)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${a} ??`),!1;e.log(`[oePlot] - building Plot.ly ${a}`);n.rightEye&&(s.set("rightEye",new Map),r(n.rightEye,"rightEye",t.getColorSeries("rightEyeSeries",o))),n.leftEye&&(s.set("leftEye",new Map),r(n.leftEye,"leftEye",t.getColorSeries("leftEyeSeries",o)));const i=t.getAxis({type:"x",numTicks:10,spikes:!0,noMirrorLines:!0},o),l=t.getAxis({type:"y",title:"CRT",range:n.yaxis.CRT,spikes:!0},o),d=t.getAxis({type:"y",title:"VA",range:n.yaxis.VA,rightSide:"y1",spikes:!0},o);(e=>{const a=t.getLayout({darkTheme:o,legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});let r=[];["rightEye","leftEye"].forEach((e=>{if(s.has(e)){let t=s.get(e).get("data");r=r.concat(Array.from(t.values()))}})),Plotly.react(e.div,r,a,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),xaxis:i,yaxes:[l,d]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const a="Outcomes with Error bars",o=t.isDarkTheme();e.extend("plotOutcomesWithErrors",((s=null)=>{if(null===s)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${a} ??`),!1;e.log(`[oePlot] - building Plot.ly ${a}`);const r=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(s),n=t.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},o),i=t.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},o),l=t.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},o);(e=>{const a=t.getLayout({darkTheme:o,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,a,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),data:r,xaxis:n,yaxes:[i,l]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";if(null==document.querySelector(".oeplot"))return;const a=[[.82,1],[.47,.77],[.1,.42],[0,.1]],o=new Map;let s=null;const r=(e,a)=>{const r={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}<extra></extra>",yaxis:"y",type:"scatter",mode:"lines+markers"},n={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y2",hovertemplate:"%{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers",line:t.dashedLine()},i={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y4",hovertemplate:"IOP: %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"};for(const[t,o]of Object.entries(e.VA.units))s.selectableUnits.addTrace(a,t,{x:o.x,y:o.y,name:o.name,yaxis:"y3",hovertemplate:o.name+": %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"});o.set(a,new Map),o.get(a).set("data",new Map),o.get(a).get("data").set(r.name,r),o.get(a).get("data").set(n.name,n),o.get(a).get("data").set(i.name,i),o.get(a).get("data").set("VA",s.selectableUnits.getTrace(a)),Object.values(e.events).forEach((e=>{const s=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y5",hovertemplate:e.customdata?"%{y}<br>%{customdata}<br>%{x}<extra></extra>":"%{y}<br>%{x}<extra></extra>",type:"scatter",showlegend:!1},t.eventStyle(e.event));o.get(a).get("data").set(s.name,s)}))},n=e=>{if(!o.has(e))return;let t=o.get(e);t.get("data").set("VA",s.selectableUnits.getTrace(e)),t.get("layout").yaxis3=s.selectableUnits.getAxis(),t.get("layout").hovermode=s.hoverMode.getMode(),Plotly.react(t.get("div"),Array.from(t.get("data").values()),t.get("layout"),{displayModeBar:!1,responsive:!0})},i=({title:s,eyeSide:r,colors:i,xaxis:l,yaxes:d,procedures:c,targetIOP:y,parentDOM:u})=>{const p=document.querySelector(u);e.empty(p);const g=t.buildDiv(`oes-${r}`);p.append(g);const m=t.getLayout({darkTheme:t.isDarkTheme(),legend:{traceorder:"reversed",yanchor:"bottom",y:a[1][1]},colors:i,plotTitle:s,xaxis:l,yaxes:d,subplot:a.length,rangeSlider:!0,dateRangeButtons:!0});c&&t.addLayoutVerticals(m,Object.values(c),a[1][1]),y&&t.addLayoutHorizontals(m,Object.values(y),"y4"),o.get(r).set("div",g),o.get(r).set("layout",m),n(r),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(g,m)}))},l=(d,c=!1)=>{if(null===d)throw new Error("[oePlot] Sorry, no JSON data!");e.log("[oePlot] - OES Glaucoma"),o.clear(),null==s?(s=t.tools(),s.plot.setReacts(n,["rightEye","leftEye"]),s.hoverMode.add(),s.selectableUnits.addAxes({axisDefaults:{type:"y",rightSide:"y2",domain:a[2],title:"VA",spikes:!0},yaxes:d.yaxis.VA,prefix:"VA"}),d.tabularDataID&&s.tabularData.add(d.tabularDataID),s.showToolbar()):(s.selectableUnits.clearTraces(),s.selectableUnits.updateAxesColors()),d.rightEye&&r(d.rightEye,"rightEye"),d.leftEye&&r(d.leftEye,"leftEye");const y=s.selectableUnits.getAxis(),u=t.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t.isDarkTheme()),p=t.getAxis({type:"y",domain:a[3],useCategories:{categoryarray:d.yaxis.offScale,rangeFit:"padTop"},spikes:!0},t.isDarkTheme()),g=t.getAxis({type:"y",domain:a[2],title:"VFI",range:d.yaxis.VFI,spikes:!0,maxAxisTicks:12},t.isDarkTheme()),m=t.getAxis({type:"y",domain:a[1],title:"IOP",range:d.yaxis.IOP,maxAxisTicks:12,spikes:!0},t.isDarkTheme()),x=t.getAxis({type:"y",domain:a[0],useCategories:{categoryarray:d.allEvents,rangeFit:"pad"},spikes:!0},t.isDarkTheme());if(o.has("rightEye")&&i({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[p,g,y,m,x],procedures:d.rightEye.procedures,targetIOP:d.rightEye.targetIOP,parentDOM:".oes-left-side"}),o.has("leftEye")&&i({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[p,g,y,m,x],procedures:d.leftEye.procedures,targetIOP:d.leftEye.targetIOP,parentDOM:".oes-right-side"}),document.addEventListener("oeThemeChange",(()=>{setTimeout((()=>l(d,!0)),100)}),{once:!0}),0==c)return e.log("[oePlot] Click and Hover Events available (click point to see data structure)"),["rightEye","leftEye"].forEach((e=>{if(!o.has(e))return;const a=o.get(e).get("div");t.addClickEvent(a,e),t.addHoverEvent(a,e)})),{highlightPoint:t.highlightPoint(o)}};e.extend("plotSummaryGlaucoma",l)})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";if(null==document.querySelector(".oeplot"))return;const a=[[.7,1],[.15,.64],[0,.15]],o=new Map;let s=null;const r=(e,a)=>{const r={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}<extra></extra>",yaxis:"y",type:"scatter",mode:"lines+markers"},n={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers",line:t.dashedLine()};for(const[t,o]of Object.entries(e.VA.units))s.selectableUnits.addTrace(a,t,{x:o.x,y:o.y,name:o.name,yaxis:"y3",hovertemplate:o.name+": %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"});o.set(a,new Map),o.get(a).set("data",new Map),o.get(a).get("data").set(r.name,r),o.get(a).get("data").set(n.name,n),o.get(a).get("data").set("VA",s.selectableUnits.getTrace(a)),Object.values(e.events).forEach((e=>{const s=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:e.customdata?"%{y}<br>%{customdata}<br>%{x}<extra></extra>":"%{y}<br>%{x}<extra></extra>",type:"scatter",showlegend:!1},t.eventStyle(e.event));o.get(a).get("data").set(s.name,s)}))},n=e=>{if(!o.has(e))return;let t=o.get(e);t.get("data").set("VA",s.selectableUnits.getTrace(e)),t.get("layout").yaxis3=s.selectableUnits.getAxis(),t.get("layout").hovermode=s.hoverMode.getMode(),Plotly.react(t.get("div"),Array.from(t.get("data").values()),t.get("layout"),{displayModeBar:!1,responsive:!0})},i=({title:s,eyeSide:r,colors:i,xaxis:l,yaxes:d,parentDOM:c})=>{const y=document.querySelector(c);e.empty(y);const u=t.buildDiv(`oes-${r}`);y.append(u);const p=t.getLayout({darkTheme:t.isDarkTheme(),legend:{yanchor:"bottom",y:a[1][1]},colors:i,plotTitle:s,xaxis:l,yaxes:d,subplot:a.length,rangeSlider:!0,dateRangeButtons:!0});o.get(r).set("div",u),o.get(r).set("layout",p),n(r),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(u,p)}))},l=(d,c=!1)=>{if(null===d)throw new Error("[oePlot] Sorry, no JSON data!");e.log("[oePlot] - OES Medical Retina"),o.clear(),null==s?(s=t.tools(),s.plot.setReacts(n,["rightEye","leftEye"]),s.hoverMode.add(),s.selectableUnits.addAxes({axisDefaults:{type:"y",rightSide:"y2",domain:a[1],title:"VA",spikes:!0},yaxes:d.yaxis.VA,prefix:"VA"}),d.tabularDataID&&s.tabularData.add(d.tabularDataID),s.showToolbar()):(s.selectableUnits.clearTraces(),s.selectableUnits.updateAxesColors()),d.rightEye&&r(d.rightEye,"rightEye"),d.leftEye&&r(d.leftEye,"leftEye");const y=s.selectableUnits.getAxis(),u=t.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t.isDarkTheme()),p=t.getAxis({type:"y",domain:a[2],useCategories:{categoryarray:d.yaxis.offScale,rangeFit:"padTop"},spikes:!0},t.isDarkTheme()),g=t.getAxis({type:"y",domain:a[1],title:"CRT",range:d.yaxis.CRT,spikes:!0},t.isDarkTheme()),m=t.getAxis({type:"y",domain:a[0],useCategories:{categoryarray:d.allEvents,rangeFit:"pad"},spikes:!0},t.isDarkTheme());o.has("rightEye")&&i({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[p,g,y,m],parentDOM:".oes-left-side"}),o.has("leftEye")&&i({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[p,g,y,m],parentDOM:".oes-right-side"}),document.addEventListener("oeThemeChange",(()=>{setTimeout((()=>l(d,!0)),100)}),{once:!0}),0==c&&(e.log("[oePlot] Click and Hover Events available (click point to see data structure)"),["rightEye","leftEye"].forEach((e=>{if(!o.has(e))return;const a=o.get(e).get("div");t.addClickEvent(a,e),t.addHoverEvent(a,e)})))};e.extend("plotSummaryMedicalRetina",l)})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);