Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,s)=>{if("function"!=typeof s)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(s._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=s,s._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",(()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")}),{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),s=()=>t.next().value;function a(){this.map=new Map,this.dataAttr="data-bjc"}e.extend("getKey",s),a.prototype.add=function(e,t){const a=s();return this.map.set(a,e),t.setAttribute(this.dataAttr,a),a},a.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},a.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},a.prototype.getFirst=function(){return this.map.values().next().value},a.prototype.next=function(e){const t=this.map.keys();let s=t.next();for(;!s.done;){if(s.value===e)return t.next().value;s=t.next()}},a.prototype.prev=function(e){const t=this.map.keys();let s=!1;for(const a of t){if(a===e)return s;s=a}},a.prototype.has=function(e){return this.map.has(e)},a.prototype.delete=function(e){return this.map.delete(e)},e.extend("Collection",a)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",((e,t)=>{const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)}))})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,s=new Map,a=new Map,n=new Map,i=new Set,o=(e,t,s)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,s)},r=(e,t)=>{const s=e.target;if(s===document)return!1;t.forEach(((t,a)=>{s.matches(a)&&t(e)}))},l=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout((()=>{i.forEach((e=>{e()}))}),150)}}})();function c(e){r(e,s)}function d(e){r(e,t)}function u(e){r(e,a)}window.onresize=()=>l.delay();let p=e=>{document.removeEventListener("mouseenter",c,{capture:!0}),document.removeEventListener("mousedown",d,{capture:!0}),document.removeEventListener("mouseleave",u,{capture:!0}),r(e,t),p=e=>{r(e,t)}};document.addEventListener("mouseenter",c,{capture:!0}),document.addEventListener("mousedown",d,{capture:!0}),document.addEventListener("mouseleave",u,{capture:!0}),document.addEventListener("touchstart",(e=>p(e)),{capture:!0}),document.addEventListener("click",(e=>r(e,n)),{capture:!0}),e.extend("userEnter",((e,t)=>o(s,e,t))),e.extend("userDown",((e,s)=>o(t,e,s))),e.extend("userLeave",((e,t)=>o(a,e,t))),e.extend("userClick",((e,t)=>o(n,e,t))),e.extend("listenForResize",(e=>i.add(e)))})(bluejay),(function(e){"use strict";const t=e=>{console.log(e),e.parentNode.removeChild(e)};const s=(function*(){let e=1;for(;;)++e,yield`bj${e}`})();e.extend("nodeArray",(e=>Array.prototype.slice.call(e))),e.extend("find",((e,t)=>(t||document).querySelector(e))),e.extend("getParent",((e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1})),e.extend("wrap",((e,t="")=>{const s=document.createElement("div"),a=window.getComputedStyle(e);return s.style.width=a.getPropertyValue("width"),s.style.position="relative",s.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(s,e),s.appendChild(e),s})),e.extend("unwrap",(e=>{const s=e.parentNode,a=s.parentNode;e.style.width="",a.insertBefore(e,s),t(s)})),e.extend("div",((e,t=!1)=>{const s=document.createElement("div");return s.className=e,t&&(s.innerHTML=t),s})),e.extend("dom",((e,t=!1,s=!1)=>{const a=document.createElement(e);return t&&(a.className=t),s&&(a.innerHTML=s),a})),e.extend("remove",t),e.extend("show",((e,t="")=>{null!==e&&(e.style.display=t)})),e.extend("reshow",(e=>{null!==e&&(e.style.display="")})),e.extend("hide",(e=>{null!==e&&(e.style.display="none")})),e.extend("empty",(e=>{e.firstChild&&(e.textContent=null)})),e.extend("xhr",((t,s=!1)=>(e.log("[XHR] - "+t),new Promise(((a,n)=>{let i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?(e.log("[XHR] - Success"),i.token=s,a({html:i.responseText,token:s})):(e.log("[XHR] - Failed"),n(this.status+" "+this.statusText)))},i.send()}))))),e.extend("getToken",(()=>s.next().value)),e.extend("loadJS",((t,s=!1)=>(e.log("[JS script] - "+t),new Promise(((a,n)=>{const i=document.createElement("script");i.src=t,s&&i.setAttribute("crossorigin",""),i.onload=()=>{setTimeout((()=>{e.log("[JS loaded] - "+t),a()}),100)},i.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(i)}))))),e.extend("getHiddenElemSize",(e=>{e.parentNode;e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t})),e.extend("idgReporter",(e=>{let t="idg-js-ui-message-out",s=document.getElementById(t),a=document.createElement("li");null===s&&(s=document.createElement("ul"),s.id=t,s.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(s));let n=s.children.length;a.appendChild(document.createTextNode(n+" - "+e)),s.appendChild(a)})),e.extend("clock24",(e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")))})(bluejay),(function(e){"use strict";const t=[],s=new Map;e.extend("addModule",(e=>t.push(e))),e.extend("registeredModules",(()=>(t.sort(),t.join(", ")))),e.extend("namespace",(e=>(s.has(e)||s.set(e,{}),s.get(e))))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",(()=>({views:Object.create(t())})))})(),(function(e){"use strict";let t=window.innerWidth,s=window.innerHeight;e.listenForResize((()=>{t=window.innerWidth,s=window.innerHeight}));const a=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",(t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}})),e.extend("getWinH",(()=>s)),e.extend("getWinW",(()=>t)),e.extend("getDataAttributeName",a),e.extend("setDataAttr",((e,t)=>{e.setAttribute(a(),t)})),e.extend("getDataAttr",(e=>{const t=a();return!!e.hasAttribute(t)&&e.getAttribute(t)}))})(bluejay),(function(e,t){"use strict";e.log("Plot.ly version: "+Plotly.version),t.isDarkTheme=()=>"dark"===window.oeThemeMode;const s={blue:"#63d7d6",highlight:"#fff",green:"#65d235",red:"#ea2b34",greenSeries:["#65d235","#A5D712","#02B546"],redSeries:["#ea2b34","#F64A2D","#C92845"],yellowSeries:["#FAD94B","#E8B131","#F1F555"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},a={blue:"#00f",highlight:"#000",green:"#418c20",red:"#da3e43",greenSeries:["#418c20","#598617","#139149"],redSeries:["#da3e43","#E64C02","#E64562"],yellowSeries:["#FCCE14","#E69812","#FCBB21"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]};t.getBlue=e=>e?s.blue:a.blue,t.getColorSeries=(e,t)=>{let n=null;const i=s,o=a;switch(e){case"varied":n=t?i.varied:o.varied;break;case"posNeg":n=t?i.dual:o.dual;break;case"rightEyeSeries":n=t?i.greenSeries:o.greenSeries;break;case"leftEyeSeries":n=t?i.redSeries:o.redSeries;break;case"BEOSeries":n=t?i.yellowSeries:o.yellowSeries;break;default:n=t?i.standard:o.standard}return n},t.getColor=(e,t)=>{switch(e){case"highlight":return t?s.highlight:a.highlight;case"rightEye":return t?s.green:a.green;case"leftEye":return t?s.red:a.red;default:return"pink"}},t.getColorFor=(e,t)=>getColor(e,t)})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,s=[];let a,n=0;const i=e=>{n=e.target.selectedIndex;for(const e of t.keys())a(e)};return{init:t=>{a=t.plotlyUpdate;const o=t.darkTheme,r=t.axisDefaults,l=r.title,c=[];t.unitRanges.forEach(((t,a)=>{let i;t.makeDefault&&(n=a),c.push(t.option),r.title=`${l} - ${t.option}`,i="number"==typeof t.range[0]?Object.assign({},r,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},r,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),s.push(e.getAxis(i,o))})),(e=>{const t=['<div class="plot-tool">',"<label>VA Scale</label>","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>","</div>"].join(""),s=document.createElement("div");s.className="oeplot-toolbar",s.innerHTML=Mustache.render(t,{options:e});const a=document.querySelector(".oeplot");a.classList.add("with-toolbar"),a.append(s);let o=s.querySelector("select");o.options[n].selected=!0,o.addEventListener("change",i,!1)})(c)},addTrace:(e,s)=>{t.has(e)?t.get(e).push(s):t.set(e,[s])},selectedTrace:e=>t.get(e)[n],selectedAxis:()=>s[n]}}})(bluejay.namespace("oePlot")),(function(e){"use strict";bluejay.namespace("oePlot").findRegression=function(e,t){let s=0,a=0,n=0,i=0,o=0,r=0,l=0,c=e.length;if(c!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===c)return[[],[]];for(let d=0;d<c;d++)r=e[d],l=t[d],s+=r,a+=l,i+=r*r,n+=r*l,o++;const d=(o*n-s*a)/(o*i-s*s),u=a/o-d*s/o;let p=[],h=[];for(let t=0;t<c;t++)r=e[t],l=r*d+u,p.push(parseFloat(Number.parseFloat(r).toFixed(2))),h.push(parseFloat(Number.parseFloat(l).toFixed(2)));return{x:p,y:h}}})(),(function(e){"use strict";e.axisGridColor=e=>e?"#292929":"#e6e6e6",e.axisTickColor=e=>e?"#666":"#ccc",e.getAxis=function(t,s){let a={linecolor:s?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:e.axisGridColor(s),tickmode:"auto",nticks:10,ticks:"outside",ticklen:3,tickcolor:e.axisTickColor(s),automargin:!0,mirror:!0,connectgaps:!1};const n="y"==t.type;if(t.noMirrorLines&&(a.mirror=!1),t.domain&&n&&(a.domain=t.domain),t.title&&(a.title={text:t.title,standoff:n?10:20,font:{size:12}}),t.rightSide&&n&&(a.overlaying=t.rightSide,a.side="right",a.showgrid=!1,a.zeroline=!1,a.title.standoff=15),t.maxAxisTicks&&(a.nticks=t.maxAxisTicks),t.useDates&&(a.tickformat="%b %Y"),t.fixRange&&(a.fixedrange=!0),t.range&&(a.range=t.range),t.axisType&&(a.type=t.axisType),t.useCategories){let e=t.useCategories.categoryarray;if(a.type="category",a.categoryarray=e,t.useCategories.rangeFit)switch(t.useCategories.rangeFit){case"exact":a.range=[0,e.length-1];break;case"pad":a.range=[-1,e.length];break;case"padTop":a.range=[0,e.length];break;case"padBottom":a.range=[-1,e.length-1]}}return t.spikes&&(a.showspikes=!0,a.spikecolor=s?"#0ff":"#00f",a.spikethickness=s?.5:1,a.spikedash=s?"1px,3px":"2px,3px"),a}})(bluejay.namespace("oePlot")),(function(e){"use strict";e.getLayout=function(t){const s=t.darkTheme,a={isDark:s,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:40,pad:4,autoexpand:!0},paper_bgcolor:s?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:s?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:s?"#aaa":"#333"},hoverlabel:{bgcolor:s?"#003":"#fff",bordercolor:s?"#009":"#00f",font:{size:11,color:e.getBlue(s)}},shapes:[],annotations:[]};if(t.colors?a.colorway=e.getColorSeries(t.colors,s):a.colorway=e.getColorSeries("default",s),t.plotTitle&&(a.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},a.margin.t=50),t.legend){a.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?a.legend=e:a.legend=Object.assign(e,t.legend)}else a.showlegend=!1;if(t.subplot&&(a.grid={rows:t.subplot,columns:1,pattern:"independent"}),t.xaxis&&(a.xaxis=t.xaxis,a.xaxis.title&&(a.margin.b=80)),t.yaxes&&t.yaxes.forEach(((e,t)=>{t?a["yaxis"+(t+1)]=e:a.yaxis=e,e.title&&("right"==e.side?a.margin.r=80:a.margin.l=80)})),t.rangeSlider){const e={thickness:.08};s&&(e.bgcolor=a.paper_bgcolor,e.borderwidth=1,e.bordercolor=a.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),a.xaxis.rangeslider=e,a.margin.b=15}return t.dateRangeButtons&&(a.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(s))),a}})(bluejay.namespace("oePlot")),(function(e,t){"use strict";t.buildDiv=(t,s=!1)=>{const a=e.div("oeplot-wrap");return a.classList.add(t.toLowerCase()),s&&(a.style.width=s),a},t.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter((e=>null!==e));return[e[0],e.pop()]}}),t.addClickEvent=(t,s)=>{t.on("plotly_click",(function(t){const a=t.points[0];let n={eye:s,name:a.data.name,index:a.pointIndex,x:a.x,y:a.y};e.customEvent("oePlotClick",n),e.log('"oePlotClick" Event data: '+JSON.stringify(n))}))},t.addHoverEvent=(t,s)=>{t.on("plotly_hover",(function(t){const a=t.points[0];let n={eye:s,name:a.data.name,index:a.pointIndex,x:a.x,y:a.y};e.customEvent("oePlotHover",n)}))},t.dataLine=e=>{let s={};return e.color&&(s.color=e.color),e.dashed&&(s=Object.assign(s,t.dashedLine())),s},t.dashedLine=()=>({dash:"2px,2px",width:2}),t.markerFor=e=>{const t={};switch(e){case"managment":t.symbol="square",t.size=9;break;case"image":t.symbol="triangle-down",t.size=11;break;case"drug":t.symbol="diamond",t.size=9;break;case"injection":t.symbol="star-diamond",t.size=10}return t},t.eventStyle=(e,s=!1)=>{const a={marker:t.markerFor(e)};switch(e){case"managment":case"image":case"injection":a.mode="markers";break;case"drug":a.mode="lines+markers",a.line={width:3}}return s&&(a.marker&&(a.marker.color=s),a.line&&(a.line.color=s)),a},t.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(225,225,225)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),t.addDropDown=e=>{let s=[];s.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),s.push({method:"update",args:[{},{title:"some new title",colorway:t.getColorSeries("default",!0)}],label:"Options Title"});let a=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:s},t.buttonStyling());e.updatemenus=[a]}})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";e.highlightPoint=t=>(s,a)=>{let n=s.split(".");if(2!=n.length)return void bj.log('oePlot - for highlightPoint to work it need side and trace name: "leftEye.OCT" ');let i,o,r=n[0],l=n[1],c=0;t.get(r).get("data").forEach(((e,t)=>{t===l&&(i=e,o=c),c++}));let d=e.getColor(r,e.isDarkTheme()),u=[];for(let e=0;e<i.x.length;e++)u.push(d);u[a]=e.getColor("highlight",e.isDarkTheme());let p=e.markerFor(i.oeEventType);p.color=u,Plotly.restyle(t.get(r).get("div"),{marker:p},[o])}})(bluejay.namespace("oePlot")),(function(e){"use strict";e.addLayoutVerticals=(t,s,a)=>{if(!Array.isArray(s))throw new Error("[oePlot] addLayoutVerticals - must be an Array");t.shapes=t.shapes.concat(s.map((({x:t})=>({type:"line",layer:"above",yref:"paper",x0:t,y0:0,x1:t,y1:a,line:{color:e.getBlue(e.isDarkTheme()),width:.5}})))),t.annotations=t.annotations.concat(s.map((({name:t,x:s})=>({showarrow:!1,text:t,textangle:90,align:"left",font:{color:e.getBlue(e.isDarkTheme())},borderpad:2,x:s,xshift:8,yref:"paper",y:a}))))},e.addLayoutHorizontals=(t,s,a)=>{if(!Array.isArray(s))throw new Error("[oePlot] addLayoutVerticals - must be an Array");t.shapes=t.shapes.concat(s.map((({y:t})=>({type:"line",layer:"below",xref:"paper",yref:a,x0:0,y0:t,x1:1,y1:t,line:{color:e.getBlue(e.isDarkTheme()),width:2,dash:"3px,12px"}})))),t.annotations=t.annotations.concat(s.map((({name:t,y:s})=>({showarrow:!1,text:t,align:"left",font:{color:e.getBlue(e.isDarkTheme())},borderpad:2,xref:"paper",x:0,yshift:8,yref:a,y:s}))))}})(bluejay.namespace("oePlot")),(function(e,t){"use strict";t.tools=()=>{const s=e.div("oeplot-toolbar"),a={_render:null,_plots:null,setReacts(e,t=!1){this._render=e,this._plots=t},update(){this._plots.forEach((e=>this._render(e)))}},n={_popup:null,add(t){const a=e.div("oe-popup-wrap");this._popup=a,a.innerHTML=['<div class="oe-popup">','<div class="title">Tabular Data of plots</div>','<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>','<div class="oe-popup-content max"></div>',"</div>"].join("");const n=document.getElementById(t);a.querySelector(".oe-popup-content").append(n),e.show(n);const i=e.div("plot-tool"),o=document.createElement("button");o.textContent="View tabular data of plots",i.append(o),o.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.show()}),{capture:!0}),s.append(i)},show(){document.body.append(this._popup),this._popup.querySelector(".close-icon-btn").addEventListener("mousedown",(e=>{e.stopPropagation(),this.hide()}),{once:!0})},hide(){this._popup.remove()}},i={_mode:"closest",getMode(){return this._mode},add(){const t=e.div("plot-tool");t.innerHTML=Mustache.render(["<label>Labels</label>","<select>{{#options}}",'<option value="{{key}}" {{#selected}}selected{{/selected}}>{{option}}</option>',"{{/options}}</select>"].join(""),{options:[{key:"closest",option:"Single",selected:!0},{key:"x",option:"Closest",selected:!1},{key:"x unified",option:"Grouped",selected:!1}]}),t.querySelector("select").addEventListener("change",(e=>{const t=e.target;this._mode=t.options[t.selectedIndex].value,a.update()}),{capture:!0}),s.append(t)}},o={traces:new Map,axes:new Map,activeKey:null,getTrace(e,t){return this.traces.get(e).get(this.activeKey)},getAxis(e){return this.axes.get(this.activeKey)},addTrace(e,t,s){this.traces.has(e)||this.traces.set(e,new Map),this.traces.get(e).set(t,s)},addAxes({axisDefaults:e,yaxes:s,prefix:a}){const n=[];for(const[i,o]of Object.entries(s)){let s;o.makeDefault&&(this.activeKey=i),e.title=`${a} - ${o.option}`,s="number"==typeof o.range[0]?t.getAxis(Object.assign({},e,{range:o.range,axisType:"linear"}),t.isDarkTheme()):t.getAxis(Object.assign({},e,{useCategories:{showAll:!0,categoryarray:o.range}}),t.isDarkTheme()),this.axes.set(i,s),n.push({key:i,option:o.option,selected:o.makeDefault})}this.buildDropDown(n,a)},buildDropDown(t,n){const i=e.div("plot-tool");i.innerHTML=Mustache.render(["<label>{{prefix}}</label>","<select>{{#options}}",'<option value="{{key}}" {{#selected}}selected{{/selected}}>{{option}}</option>',"{{/options}}</select>"].join(""),{options:t,prefix:n}),i.querySelector("select").addEventListener("change",(e=>{const t=e.target;this.activeKey=t.options[t.selectedIndex].value,a.update()}),{capture:!0}),s.append(i)},updateAxesColors(){const e=this.axes.values();for(const s of e)s.gridcolor=t.axisGridColor(t.isDarkTheme()),s.tickcolor=t.axisTickColor(t.isDarkTheme())},clearTraces(){this.traces.clear()}};return{plot:a,tabularData:n,hoverMode:i,selectableUnits:o,showToolbar:()=>{const e=document.querySelector(".oeplot");e.classList.add("with-toolbar"),e.append(s)}}}})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";new Map;e.extend("plotPatientPopup",((e=null)=>{}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const s=t.isDarkTheme();e.extend("plotBarChart",((a=null)=>{if(null===a)return e.log("[oePlot] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlot] - building Plot.ly Bar Chart");const n=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(a),i=t.getAxis({type:"x",numTicks:20},s),o=t.getAxis({type:"y",numTicks:20},s);a.title.xaxis&&(i.title=a.title.xaxis),a.title.yaxis&&(o.title=a.title.yaxis),console.log(a),(e=>{const a=t.getLayout({darkTheme:s,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});a.barmode="stack",Plotly.react(e.div,e.data,a,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(a.dom),title:a.title.plot,data:n,xaxis:i,yaxes:[o]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const s="Bar Percent Complete",a=t.isDarkTheme();e.extend("plotBarPercentComplete",((n=null)=>{if(null===n)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${s} ??`),!1;e.log(`[oePlot] - building Plot.ly ${s}`);const i=(e=>{let t=e.percentComplete.map((e=>100-e));return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(n),o=t.getAxis({type:"x",numTicks:20},a),r=t.getAxis({type:"y",range:[0,100],numTicks:20},a);(e=>{const s=t.getLayout({darkTheme:a,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});s.barmode="stack",Plotly.react(e.div,e.data,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:i,xaxis:o,yaxes:[r]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const s="Combined Medical Retina",a=t.isDarkTheme(),n=new Map,i=t.fullDateRange(),o=t.selectableUnits(),r=(e,s,a)=>{const r=(()=>{let e=0;return()=>{let t=e++;return e>=a.length&&(e=0),a[t]}})();n.get(s).set("data",new Map);const l={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:r()})};n.get(s).get("data").set(e.VA.offScale.name,l),i.add(e.VA.offScale.x);const c={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:r(),dashed:!0})};n.get(s).get("data").set(e.CRT.name,c),i.add(e.CRT.x);const d=r();Object.values(e.VA.units).forEach(((e,a)=>{o.addTrace(s,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:t.dataLine({color:d})}),a||i.add(e.x)})),n.get(s).get("data").set("VA",o.selectedTrace(s))},l=()=>{let e=[];["rightEye","leftEye","BEO"].forEach((t=>{if(n.has(t)){let s=n.get(t).get("data");s.set("VA",o.selectedTrace(t)),e=e.concat(Array.from(s.values()))}})),n.get("layout").yaxis3=Object.assign({},o.selectedAxis()),Plotly.react(n.get("div"),e,n.get("layout"),{displayModeBar:!1,responsive:!0})};e.extend("plotCombinedMedRet",((c=null)=>{if(null===c)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${s} ??`),!1;e.log(`[oePlot] - building Plot.ly ${s}`);const d=[[0,.15],[.2,1]];o.init({darkTheme:a,plotlyUpdate:l,axisDefaults:{type:"y",rightSide:"y2",domain:d[1],title:"VA",spikes:!0},unitRanges:Object.values(c.yaxis.unitRanges)}),c.rightEye&&(n.set("rightEye",new Map),r(c.rightEye,"rightEye",t.getColorSeries("rightEyeSeries",a))),c.leftEye&&(n.set("leftEye",new Map),r(c.leftEye,"leftEye",t.getColorSeries("leftEyeSeries",a))),c.BEO&&(n.set("BEO",new Map),r(c.BEO,"BEO",t.getColorSeries("BEOSeries",a)));(e=>{const o=t.getLayout({darkTheme:a,legend:{yanchor:"top",y:1},plotTitle:"Right, Left and BEO",xaxis:e.x,yaxes:e.y,subplot:2,rangeSlider:i.firstLast(),dateRangeButtons:!0}),r=t.buildDiv(`${s}`,"80vh","650px");document.querySelector(".oes-left-side").appendChild(r),n.set("div",r),n.set("layout",o),l(),t.addClickEvent(r,"?"),t.addHoverEvent(r,"?"),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(r,o)}))})({x:t.getAxis({type:"x",numTicks:10,useDates:!0,range:i.firstLast(),spikes:!0,noMirrorLines:!0},a),y:[t.getAxis({type:"y",domain:d[0],useCategories:{showAll:!0,categoryarray:c.yaxis.offScale.reverse()},spikes:!0},a),t.getAxis({type:"y",domain:d[1],title:"CRT",range:[200,650],spikes:!0},a),o.selectedAxis()]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const s="Combined Medical Retina",a=t.isDarkTheme(),n=new Map,i=(e,s,a)=>{const i=(()=>{let e=0;return()=>{let t=e++;return e>=a.length&&(e=0),a[t]}})();n.get(s).set("data",new Map);const o={x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",mode:"lines+markers",yaxis:"y2",line:t.dataLine({color:i()}),error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}};n.get(s).get("data").set("VA",o);const r={x:e.CRT.x,y:e.CRT.y,name:"CRT",hovertemplate:"Mean ± SD<br>CRT: %{y}<br>(N: %{x})",type:"scatter",line:t.dataLine({color:i(),dashed:!0}),error_y:{type:"data",array:e.CRT.error_y,visible:!0,thickness:.5}};n.get(s).get("data").set(e.CRT.name,r)};e.extend("plotCombinedOutcomesWithErrors",((o=null)=>{if(null===o)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${s} ??`),!1;e.log(`[oePlot] - building Plot.ly ${s}`);o.rightEye&&(n.set("rightEye",new Map),i(o.rightEye,"rightEye",t.getColorSeries("rightEyeSeries",a))),o.leftEye&&(n.set("leftEye",new Map),i(o.leftEye,"leftEye",t.getColorSeries("leftEyeSeries",a)));const r=t.getAxis({type:"x",numTicks:10,spikes:!0,noMirrorLines:!0},a),l=t.getAxis({type:"y",title:"CRT",range:o.yaxis.CRT,spikes:!0},a),c=t.getAxis({type:"y",title:"VA",range:o.yaxis.VA,rightSide:"y1",spikes:!0},a);(e=>{const s=t.getLayout({darkTheme:a,legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});let i=[];["rightEye","leftEye"].forEach((e=>{if(n.has(e)){let t=n.get(e).get("data");i=i.concat(Array.from(t.values()))}})),Plotly.react(e.div,i,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(o.dom),xaxis:r,yaxes:[l,c]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";const s="Outcomes with Error bars",a=t.isDarkTheme();e.extend("plotOutcomesWithErrors",((n=null)=>{if(null===n)return e.log(`[oePlot] - no JSON data provided for Plot.ly ${s} ??`),!1;e.log(`[oePlot] - building Plot.ly ${s}`);const i=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(n),o=t.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},a),r=t.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},a),l=t.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},a);(e=>{const s=t.getLayout({darkTheme:a,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:i,xaxis:o,yaxes:[r,l]})}))})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";if(null==document.querySelector(".oeplot"))return;const s=[[.7,1],[0,.64]],a=new Map;let n=null;const i=(e,s)=>{const n={x:e.daily.x,y:e.daily.y,name:e.daily.name,yaxis:"y",hovertemplate:`${e.daily.name}: %{y}:00<extra></extra>`,type:"scatter",mode:"markers"};a.set(s,new Map),a.get(s).set("data",new Map),a.get(s).get("data").set(`a:${n.name}`,n),Object.values(e.events).forEach((e=>{const n=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y2",hovertemplate:e.customdata?"%{y}<br>%{customdata}<br>%{x}<extra></extra>":"%{y}<br>%{x}<extra></extra>",type:"scatter",showlegend:!1},t.eventStyle(e.event));a.get(s).get("data").set(n.name,n)}))},o=e=>{if(!a.has(e))return;let t=a.get(e);t.get("layout").hovermode=n.hoverMode.getMode(),Plotly.react(t.get("div"),Array.from(t.get("data").values()),t.get("layout"),{displayModeBar:!1,responsive:!0})},r=({title:n,eyeSide:i,colors:r,xaxis:l,yaxes:c,parentDOM:d})=>{const u=document.querySelector(d);e.empty(u);const p=t.buildDiv(`oes-${i}`);u.append(p);const h=t.getLayout({darkTheme:t.isDarkTheme(),legend:{yanchor:"bottom",y:s[1][1]},colors:r,plotTitle:n,xaxis:l,yaxes:c,subplot:s.length,rangeSlider:!0,dateRangeButtons:!0});t.addLayoutHorizontals(h,[{name:"Noon",y:12}],"y"),a.get(i).set("div",p),a.get(i).set("layout",h),o(i),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(p,h)}))},l=(c,d=!1)=>{if(null===c)throw new Error("[oePlot] Sorry, no JSON data!");e.log("[oePlot] - OES Medical Retina"),a.clear(),null==n&&(n=t.tools(),n.plot.setReacts(o,["rightEye","leftEye"]),n.hoverMode.add(),c.tabularDataID&&n.tabularData.add(c.tabularDataID),n.showToolbar()),c.rightEye&&i(c.rightEye,"rightEye"),c.leftEye&&i(c.leftEye,"leftEye");const u=t.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t.isDarkTheme()),p=t.getAxis({type:"y",domain:s[1],title:"24 Hours",range:c.yaxis.hours,spikes:!0},t.isDarkTheme()),h=t.getAxis({type:"y",domain:s[0],useCategories:{categoryarray:c.allEvents,rangeFit:"pad"},spikes:!0},t.isDarkTheme());a.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[p,h],parentDOM:".oes-left-side"}),a.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[p,h],parentDOM:".oes-right-side"}),document.addEventListener("oeThemeChange",(()=>{setTimeout((()=>l(c,!0)),100)}),{once:!0}),0==d&&(e.log("[oePlot] Click and Hover Events available (click point to see data structure)"),["rightEye","leftEye"].forEach((e=>{if(!a.has(e))return;const s=a.get(e).get("div");t.addClickEvent(s,e),t.addHoverEvent(s,e)})))};e.extend("plotSummaryAdherence",l)})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";if(null==document.querySelector(".oeplot"))return;const s=[[.82,1],[.47,.77],[.1,.42],[0,.1]],a=new Map;let n=null;const i=(e,s)=>{const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}<extra></extra>",yaxis:"y",type:"scatter",mode:"lines+markers"},o={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y2",hovertemplate:"%{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers",line:t.dashedLine()},r={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y4",hovertemplate:"IOP: %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"};for(const[t,a]of Object.entries(e.VA.units))n.selectableUnits.addTrace(s,t,{x:a.x,y:a.y,name:a.name,yaxis:"y3",hovertemplate:a.name+": %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"});a.set(s,new Map),a.get(s).set("data",new Map),a.get(s).get("data").set(i.name,i),a.get(s).get("data").set(o.name,o),a.get(s).get("data").set(r.name,r),a.get(s).get("data").set("VA",n.selectableUnits.getTrace(s)),Object.values(e.events).forEach((e=>{const n=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y5",hovertemplate:e.customdata?"%{y}<br>%{customdata}<br>%{x}<extra></extra>":"%{y}<br>%{x}<extra></extra>",type:"scatter",showlegend:!1},t.eventStyle(e.event));a.get(s).get("data").set(n.name,n)}))},o=e=>{if(!a.has(e))return;let t=a.get(e);t.get("data").set("VA",n.selectableUnits.getTrace(e)),t.get("layout").yaxis3=n.selectableUnits.getAxis(),t.get("layout").hovermode=n.hoverMode.getMode(),Plotly.react(t.get("div"),Array.from(t.get("data").values()),t.get("layout"),{displayModeBar:!1,responsive:!0})},r=({title:n,eyeSide:i,colors:r,xaxis:l,yaxes:c,procedures:d,targetIOP:u,parentDOM:p})=>{const h=document.querySelector(p);e.empty(h);const g=t.buildDiv(`oes-${i}`);h.append(g);const m=t.getLayout({darkTheme:t.isDarkTheme(),legend:{traceorder:"reversed",yanchor:"bottom",y:s[1][1]},colors:r,plotTitle:n,xaxis:l,yaxes:c,subplot:s.length,rangeSlider:!0,dateRangeButtons:!0});d&&t.addLayoutVerticals(m,Object.values(d),s[1][1]),u&&t.addLayoutHorizontals(m,Object.values(u),"y4"),a.get(i).set("div",g),a.get(i).set("layout",m),o(i),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(g,m)}))},l=(c,d=!1)=>{if(null===c)throw new Error("[oePlot] Sorry, no JSON data!");e.log("[oePlot] - OES Glaucoma"),a.clear(),null==n?(n=t.tools(),n.plot.setReacts(o,["rightEye","leftEye"]),n.hoverMode.add(),n.selectableUnits.addAxes({axisDefaults:{type:"y",rightSide:"y2",domain:s[2],title:"VA",spikes:!0},yaxes:c.yaxis.VA,prefix:"VA"}),c.tabularDataID&&n.tabularData.add(c.tabularDataID),n.showToolbar()):(n.selectableUnits.clearTraces(),n.selectableUnits.updateAxesColors()),c.rightEye&&i(c.rightEye,"rightEye"),c.leftEye&&i(c.leftEye,"leftEye");const u=n.selectableUnits.getAxis(),p=t.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t.isDarkTheme()),h=t.getAxis({type:"y",domain:s[3],useCategories:{categoryarray:c.yaxis.offScale,rangeFit:"padTop"},spikes:!0},t.isDarkTheme()),g=t.getAxis({type:"y",domain:s[2],title:"VFI",range:c.yaxis.VFI,spikes:!0,maxAxisTicks:12},t.isDarkTheme()),m=t.getAxis({type:"y",domain:s[1],title:"IOP",range:c.yaxis.IOP,maxAxisTicks:12,spikes:!0},t.isDarkTheme()),y=t.getAxis({type:"y",domain:s[0],useCategories:{categoryarray:c.allEvents,rangeFit:"pad"},spikes:!0},t.isDarkTheme());if(a.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:p,yaxes:[h,g,u,m,y],procedures:c.rightEye.procedures,targetIOP:c.rightEye.targetIOP,parentDOM:".oes-left-side"}),a.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:p,yaxes:[h,g,u,m,y],procedures:c.leftEye.procedures,targetIOP:c.leftEye.targetIOP,parentDOM:".oes-right-side"}),document.addEventListener("oeThemeChange",(()=>{setTimeout((()=>l(c,!0)),100)}),{once:!0}),0==d)return e.log("[oePlot] Click and Hover Events available (click point to see data structure)"),["rightEye","leftEye"].forEach((e=>{if(!a.has(e))return;const s=a.get(e).get("div");t.addClickEvent(s,e),t.addHoverEvent(s,e)})),{highlightPoint:t.highlightPoint(a)}};e.extend("plotSummaryGlaucoma",l)})(bluejay,bluejay.namespace("oePlot")),(function(e,t){"use strict";if(null==document.querySelector(".oeplot"))return;const s=[[.7,1],[.15,.64],[0,.15]],a=new Map;let n=null;const i=(e,s)=>{const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}<extra></extra>",yaxis:"y",type:"scatter",mode:"lines+markers"},o={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers",line:t.dashedLine()};for(const[t,a]of Object.entries(e.VA.units))n.selectableUnits.addTrace(s,t,{x:a.x,y:a.y,name:a.name,yaxis:"y3",hovertemplate:a.name+": %{y}<br>%{x}<extra></extra>",type:"scatter",mode:"lines+markers"});a.set(s,new Map),a.get(s).set("data",new Map),a.get(s).get("data").set(i.name,i),a.get(s).get("data").set(o.name,o),a.get(s).get("data").set("VA",n.selectableUnits.getTrace(s)),Object.values(e.events).forEach((e=>{const n=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:e.customdata?"%{y}<br>%{customdata}<br>%{x}<extra></extra>":"%{y}<br>%{x}<extra></extra>",type:"scatter",showlegend:!1},t.eventStyle(e.event));a.get(s).get("data").set(n.name,n)}))},o=e=>{if(!a.has(e))return;let t=a.get(e);t.get("data").set("VA",n.selectableUnits.getTrace(e)),t.get("layout").yaxis3=n.selectableUnits.getAxis(),t.get("layout").hovermode=n.hoverMode.getMode(),Plotly.react(t.get("div"),Array.from(t.get("data").values()),t.get("layout"),{displayModeBar:!1,responsive:!0})},r=({title:n,eyeSide:i,colors:r,xaxis:l,yaxes:c,parentDOM:d})=>{const u=document.querySelector(d);e.empty(u);const p=t.buildDiv(`oes-${i}`);u.append(p);const h=t.getLayout({darkTheme:t.isDarkTheme(),legend:{yanchor:"bottom",y:s[1][1]},colors:r,plotTitle:n,xaxis:l,yaxes:c,subplot:s.length,rangeSlider:!0,dateRangeButtons:!0});a.get(i).set("div",p),a.get(i).set("layout",h),o(i),document.addEventListener("oesLayoutChange",(()=>{Plotly.relayout(p,h)}))},l=(c,d=!1)=>{if(null===c)throw new Error("[oePlot] Sorry, no JSON data!");e.log("[oePlot] - OES Medical Retina"),a.clear(),null==n?(n=t.tools(),n.plot.setReacts(o,["rightEye","leftEye"]),n.hoverMode.add(),n.selectableUnits.addAxes({axisDefaults:{type:"y",rightSide:"y2",domain:s[1],title:"VA",spikes:!0},yaxes:c.yaxis.VA,prefix:"VA"}),c.tabularDataID&&n.tabularData.add(c.tabularDataID),n.showToolbar()):(n.selectableUnits.clearTraces(),n.selectableUnits.updateAxesColors()),c.rightEye&&i(c.rightEye,"rightEye"),c.leftEye&&i(c.leftEye,"leftEye");const u=n.selectableUnits.getAxis(),p=t.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t.isDarkTheme()),h=t.getAxis({type:"y",domain:s[2],useCategories:{categoryarray:c.yaxis.offScale,rangeFit:"padTop"},spikes:!0},t.isDarkTheme()),g=t.getAxis({type:"y",domain:s[1],title:"CRT",range:c.yaxis.CRT,spikes:!0},t.isDarkTheme()),m=t.getAxis({type:"y",domain:s[0],useCategories:{categoryarray:c.allEvents,rangeFit:"pad"},spikes:!0},t.isDarkTheme());a.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:p,yaxes:[h,g,u,m],parentDOM:".oes-left-side"}),a.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:p,yaxes:[h,g,u,m],parentDOM:".oes-right-side"}),document.addEventListener("oeThemeChange",(()=>{setTimeout((()=>l(c,!0)),100)}),{once:!0}),0==d&&(e.log("[oePlot] Click and Hover Events available (click point to see data structure)"),["rightEye","leftEye"].forEach((e=>{if(!a.has(e))return;const s=a.get(e).get("div");t.addClickEvent(s,e),t.addHoverEvent(s,e)})))};e.extend("plotSummaryMedicalRetina",l)})(bluejay,bluejay.namespace("oePlot")),(function(e){"use strict";e.addModule("addSelect");const t=e.namespace("addSelect");t.all=[],t.closeAll=function(){this.all.forEach((e=>{if(null==e.close)throw'Every button defined with "js-add-select-btn" needs a popup DOM!';e.close()}))},t.init=function(){const s=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));s.length<1||s.forEach((e=>{let s=new t.Popup(e);this.all.push(s)}))},document.addEventListener("DOMContentLoaded",(()=>t.init()),{once:!0})})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=new e.Collection,s=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),a=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),n=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),a()),i=(s,a)=>{let i,o=s.target,r=t.getKey(o);r?i=t.get(r):(i=n({btn:o,content:e.find(".collapse-"+a+"-content",o.parentNode),open:o.classList.contains("collapse")}),t.add(i,o)),i.change()};e.userDown(".collapse-data-header-icon",(e=>i(e,"data"))),e.userDown(".collapse-group > .header-icon",(e=>i(e,"group"))),e.userDown(".collapse-hotlist > .header-icon",(e=>i(e,"hotlist")))})(bluejay),(function(e){"use strict";e.addModule("comments");e.userDown(".js-add-comments",(t=>{const s=t.target,a=JSON.parse(s.dataset.idgdemo);if(e.hide(s),a.bilateral){const t=document.querySelector("#"+a.id+"-right"),n=document.querySelector("#"+a.id+"-left");e.show(t,"block"),e.show(n,"block"),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(s),e.hide(t),e.hide(n)}),{once:!0}),n.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(s),e.hide(t),e.hide(n)}),{once:!0})}else{const t=document.querySelector("#"+a.id);e.show(t,"block"),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(s),e.hide(t)}),{once:!0})}}))})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=new e.Collection,s=()=>({reset(){this.editMode=!1,this.icon("comment"),e.hide(this.elem.textarea),e.hide(this.elem.userComment)}}),a=()=>({show(){this.editMode=!1,this.icon("edit");let t=e.wrapQtags(this.comment);this.elem.userComment.innerHTML=t.DOMString,this.comment=t.text,e.hide(this.elem.textarea),e.show(this.elem.userComment,"block")}}),n=()=>({edit(){this.editMode=!0,this.icon("save"),e.show(this.elem.textarea,"block"),e.hide(this.elem.userComment),this.elem.textarea.value=this.comment,e.resizeTextArea(this.elem.textarea),setTimeout((()=>this.elem.textarea.focus()),20);const t=e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),this.update(),this.elem.textarea.removeEventListener("keydown",t,!1))};this.elem.textarea.addEventListener("keydown",t,!1)}}),i=()=>({icon(t){switch(this.elem.icon.classList.remove("comments","comments-added","save","active"),t){case"comment":this.elem.icon.classList.add("comments");break;case"edit":this.elem.icon.classList.add("comments-added");break;case"save":this.elem.icon.classList.add("save","active");break;default:e.log(`commentHotlist - unknown icon: ${t}`)}}}),o=()=>({userClick(){this.editMode?this.update():this.edit()}}),r=()=>({update(){let e=this.elem.textarea.value.trim();e.length?(this.comment=e,this.show()):(this.comment="",this.reset())}}),l=(e,t,l="")=>{const c=['<textarea placeholder="Comments" rows="1" class="cols-full js-allow-qtags" style="display:none"></textarea>','<div class="user-comment" style="display:none">{{comment}}</div>'].join("");let d=document.createElement("div");d.className="patient-comments",d.innerHTML=Mustache.render(c,{comment:l}),t.appendChild(d);let u=d.querySelector("textarea"),p=d.querySelector(".user-comment");return Object.assign({editMode:!1,comment:l,elem:{icon:e,textarea:u,userComment:p}},s(),a(),n(),i(),o(),r())};e.userDown(".oe-hotlist-panel .js-comment-icon",(s=>{const a=s.target;let n=t.getKey(a);if(n){t.get(n).userClick()}else{let s=e.getParent(a,"tr").querySelector(".js-patient-comment"),n=l(a,s);n.edit(),t.add(n,a)}})),document.addEventListener("DOMContentLoaded",(()=>{e.nodeArray(document.querySelectorAll(".oe-hotlist-panel .activity-list tr")).forEach((e=>{if(e.hasAttribute("data-comment")){let s=JSON.parse(e.dataset.comment);if(s.comment){let a=e.querySelector(".oe-i.comments"),n=e.querySelector(".js-patient-comment"),i=l(a,n,s.comment);i.show(),t.add(i,a)}}}))}),{once:!0})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");const t=".js-clipboard-copy";if(null===document.querySelector(t))return;e.nodeArray(document.querySelectorAll(t)).forEach((e=>{e.style.cursor="copy"}));const s=t=>{let s=t.getBoundingClientRect(),a=s.right-s.width/2,n=s.top-5;const i=document.createElement("div");i.className="oe-tooltip fade-out copied",i.innerHTML="Copied",i.style.width="80px",i.style.top=n-30+"px",i.style.left=a-40+"px",document.body.appendChild(i),setTimeout((()=>e.remove(i)),2500)};e.userDown(t,(t=>(t=>{if(navigator.clipboard)navigator.clipboard.writeText(t.textContent).then((()=>{e.log("[ASYNC] copied text to clipboard"),s(t)})).catch((t=>{e.log("failed to copy text to clipboard")}));else{const a=document.createElement("input");a.value=t.textContent,a.style.position="absolute",a.style.top="-200px",document.body.appendChild(a),a.select(),document.execCommand("copy"),s(t),e.remove(a)}})(t.target)))})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],s=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content,"block")}}),a=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),n=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach((e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())})),this.collapsed=!this.collapsed}});e.userDown(".collapse-tile-group .oe-i",(i=>{let o=e.getParent(i.target,".element-tile-group"),r=e.getDataAttr(o);if(r)t[parseFloat(r)].change();else{let r=n(i.target);e.nodeArray(o.querySelectorAll(".element.tile")).forEach((e=>{r.addTile((e=>{const t=e.querySelector(".element-title"),n=t.textContent,i=e.querySelector(".element-data"),o=i.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:n,content:i,count:o.toString()},s(),a())})(e))})),r.change(),e.setDataAttr(o,t.length),t.push(r)}}))})(bluejay),(function(e){"use strict";e.addModule("fastDatePicker");const t=Date.now(),s=new Date(t),a=Object.assign({pickDate:null,inputDate:null,get date(){return this.pickDate},set date(e){this.pickDate=e,this.views.notify()},get userDate(){return null!=this.inputDate&&this.inputDate},set userDate(e){this.inputDate=e},changeMonth(e){this.pickDate.setMonth(e),this.views.notify()},changeFullYear(e){this.pickDate.setFullYear(e),this.views.notify()}},e.ModelViews()),n=(()=>{let t;const n=(e,s)=>{if(e.getMonth()==a.date.getMonth()&&e.getFullYear()==a.date.getFullYear()){t.querySelector("#js-fast-date-"+e.getDate()).classList.add(s)}};return a.views.add((()=>{const e=a.date.getFullYear(),i=a.date.getMonth(),o=new Date(e,i,1).getDay(),r=new Date(e,i+1,0).getDate(),l=[],c=[],d=[];for(let t=(o||7)-1,s=new Date(e,i,0).getDate();t>0;t--,s--)l.push(s);for(let e=1;e<=r;e++)c.push(e);const u=42-(l.length+c.length);for(let e=1;e<=u;e++)d.push(e);l.reverse();const p=Mustache.render('{{#prev}}<div class="prev">{{.}}</div>{{/prev}}',{prev:l}),h=Mustache.render('{{#current}}<div id="js-fast-date-{{.}}">{{.}}</div>{{/current}}',{current:c}),g=Mustache.render('{{#next}}<div class="next">{{.}}</div>{{/next}}',{next:d});t.innerHTML=p+h+g,n(s,"today"),0!=a.userDate&&n(a.userDate,"selected")})),{reset:()=>{t=null},build:s=>{t=e.div("date-grid"),t.innerHTML=Mustache.render('{{#divs}}<div class="prev">{{.}}</div>{{/divs}}',{divs:new Array(42).fill("")}),s.appendChild(t)}}})(),i=(()=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let s,n;return a.views.add((()=>{const e=s.children[a.date.getMonth()];n&&n.classList.remove("selected"),e.classList.add("selected"),n=e})),{reset:()=>{s=null,n=null},build:a=>{s=e.div("month"),s.innerHTML=Mustache.render("{{#months}}<div>{{.}}</div>{{/months}}",{months:t}),a.appendChild(s)},getMonthNum:e=>t.indexOf(e),getMonthName:e=>t[e]}})(),o=(()=>{let t,s,n,i=!1;const o=()=>{const e=a.date.getFullYear();return{c:Math.floor(e/100),y:parseFloat(e.toString().substring(2))}};return a.views.add((()=>{const e=o();e.c=20==e.c?1:0,s.c.forEach((e=>e.classList.remove("selected"))),s.y.forEach((e=>e.classList.remove("selected"))),s.c[e.c].classList.add("selected"),s.y[e.y].classList.add("selected"),n.scrollTo({top:38.5*e.y-95,left:0,behavior:i?"smooth":"auto"}),i=!0})),{reset:()=>{t=null,s=null,n=null,i=!1},build:a=>{const i=['<div class="century">{{#century}}<div>{{.}}</div>{{/century}}</div>','<ul class="years">{{#years}}<li>{{.}}</li>{{/years}}</ul>'].join(""),o=Array.from(Array(100).keys()).map((e=>e<10?`0${e}`:e));t=e.div("year"),t.innerHTML=Mustache.render(i,{century:["19","20"],years:o}),n=t.querySelector(".years"),s={c:t.querySelector(".century").childNodes,y:n.childNodes},a.append(t)},getYearUnits:o}})(),r=(()=>{let l,c,d=!1;const u=()=>{if(d)return d=!1,void l.focus();n.reset(),i.reset(),o.reset(),document.removeEventListener("blur",r.remove,{capture:!0}),e.remove(c),c=null,l=null};return{show:s=>{if(s.isSameNode(l))return;l=s;const d=l.getBoundingClientRect();c=e.div("fast-date-picker"),c.style.left=d.right-430+"px",c.style.top=d.bottom+"px",d.left<430&&(c.style.left=d.left+"px"),d.bottom+240>e.getWinH()&&(c.style.top=d.top-240+"px"),o.build(c),i.build(c),n.build(c),document.body.appendChild(c),(()=>{let e,s=!1;if(l.value&&/^\d{1,2} [a-z]{3} \d{4}/i.test(l.value)&&(e=Date.parse(l.value),!isNaN(e))){const t=new Date(e),a=t.getFullYear();a>1900&&a<2099&&(s=t)}s?(a.userDate=s,a.date=new Date(e)):a.date=new Date(t)})(),document.addEventListener("blur",r.remove,{capture:!0})},remove:u,changeDate:(e,t)=>{d=!0;const n=parseFloat(e.textContent),r=o.getYearUnits();switch(t){case"month":a.changeMonth(i.getMonthNum(e.textContent));break;case"century":if(n==r.c)return;19==n?a.changeFullYear(1999):a.changeFullYear(s.getFullYear());break;case"year":let t=n-r.y;a.changeFullYear(a.date.getFullYear()+t)}},selectDate:t=>{const s=parseFloat(t.textContent);let n=a.date.getMonth();t.classList.contains("prev")&&a.changeMonth(n-1),t.classList.contains("next")&&a.changeMonth(n+1),a.date.setDate(s),l.value=(e=>e.getDate()+" "+i.getMonthName(e.getMonth())+" "+e.getFullYear())(a.date),e.customEvent("idg:DatePickerChange",a.date),u()}}})();document.addEventListener("focus",(e=>{e.target.matches("input.date")&&r.show(e.target)}),{capture:!0}),e.userDown(".fast-date-picker .month > div",(e=>r.changeDate(e.target,"month"))),e.userDown(".fast-date-picker .century > div",(e=>r.changeDate(e.target,"century"))),e.userDown(".fast-date-picker .years li",(e=>r.changeDate(e.target,"year"))),e.userDown(".fast-date-picker .date-grid > div",(e=>r.selectDate(e.target)))})(bluejay),(function(e){"use strict";e.addModule("fastDateRange");const t=document.querySelector(".set-date-range");if(null==t)return;const s=t.querySelector(".js-filter-date-to"),a=t.querySelector(".js-filter-date-from"),n=Date.now(),i=new Date(n),o=864e5,r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=e=>e.getDate()+" "+r[e.getMonth()]+" "+e.getFullYear(),c=(e,t)=>{a.value=l(e),s.value=t?l(t):""},d=e=>c(e,!1),u=e=>{let t=i.getDay(),s=n+o*(1-t)+o*e;c(new Date(s),new Date(s+6*o))},p=e=>{let t=i.getFullYear(),s=i.getMonth()+e;s>11&&(s=0,t+=1),s<0&&(s=11,t-=1),c(new Date(t,s,1),new Date(t,s+1,0))},h=t=>{switch(t){case"yesterday":d(new Date(n-o));break;case"today":d(i);break;case"tomorrow":d(new Date(n+o));break;case"next-4-days":case"next-7-days":case"next-12-days":const s=t.split("-")[1],a=parseInt(s,10);c(i,new Date(n+o*a));break;case"last-week":u(-7);break;case"this-week":u(0);break;case"next-week":u(7);break;case"last-month":p(-1);break;case"this-month":p(0);break;case"next-month":p(1);break;default:e.log("[fastDateRange] unknown range request: "+t)}},g=e=>{const t=document.querySelector(".clinic-context .date-range");null!=t&&(t.textContent="custom"==e?`${a.value} - ${s.value}`:e)};(()=>{const e=t.querySelector("input:checked");null!=e&&h(e.value)})(),t.addEventListener("change",(e=>{h(e.target.value),g(e.target.nextSibling.textContent)})),document.addEventListener("idg:DatePickerChange",(e=>{g("custom")}))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach((t=>{e.hide(t),t.classList.remove("hidden")}));const s=e.nodeArray(document.querySelectorAll(".tr-collapse"));s.length&&s.forEach((e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")}))})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach((e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")}));e.userDown(".js-expand-message",(t=>{let s=t.target,a=e.getParent(s,"tr").querySelector(".message");s.classList.contains("expand")?(a.classList.add("expand"),s.classList.replace("expand","collapse")):(a.classList.remove("expand"),s.classList.replace("collapse","expand"))}))})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="active",s="open",a="#js-nav-hotlist-btn",n=document.querySelector(a);if(null===n)return;const i=()=>({over:function(){this.isFixed||(this.btn.classList.add(t),this.show())}}),o=()=>({changeState:function(){this.isFixed?e.customEvent("idg:hotlistViewFixed"):this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over())}}),r=()=>({show:function(){this.open||(this.open=!0,e.show(this.content,"block"))}}),l=()=>({hide:function(){!this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),c=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s),e.customEvent("idg:hotlistLockedOpen")}}),d=()=>({fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add(s),this.btn.classList.remove(t),this.show()):this.hide()}}),u=Object.assign({btn:n,content:document.getElementById("js-hotlist-panel"),open:!1,isLocked:!1,isFixed:!1},o(),i(),c(),r(),l(),d()),p=()=>{"true"===n.dataset.fixable&&u.fixedOpen(window.innerWidth>e.settings("cssHotlistFixed"))};e.userDown(a,(()=>u.changeState())),e.userEnter(a,(()=>u.over())),e.userLeave("#js-hotlist-panel-wrapper",(()=>u.hide())),e.listenForResize(p),p()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="active",s="open",a="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(a).classList.add(t);const n=()=>({over:function(){this.btn.classList.add(t)}}),i=()=>({out:function(){this.btn.classList.remove(t)}}),o=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),e.show(this.content,"block"))}}),r=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(s,t),e.hide(this.content))}}),l=Object.assign({btn:document.querySelector(a),content:document.querySelector("#js-openeyes-info"),open:!1},n(),i(),{change:function(){this.open?this.hide():this.show()}},o(),r());e.userDown(a,(()=>l.change())),e.userEnter(a,(()=>l.over())),e.userLeave(a,(()=>l.out())),e.userLeave(".openeyes-brand",(()=>l.hide()))})(bluejay),(function(e){"use strict";e.addModule("navWorklists");const t=document.getElementById("js-worklists-panel");if(null===t)return;const s=document.getElementById("js-nav-worklists-btn");let a=!1;const n=()=>{e.show(t,"block"),s.classList.add("active"),a=!0},i=()=>{e.hide(t),s.classList.remove("active"),a=!1};e.userDown("#js-nav-worklists-btn",(()=>a?i():n())),e.extend("openNavWorklistPanel",n),document.addEventListener("idg:hotlistLockedOpen",i),document.addEventListener("idg:hotlistViewFixed",i)})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",s=document.querySelector("#notification-short"),a=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(s),e.show(a,"block"),void(document.querySelector(t).style.display="none");let n=s,i=a,o=!0;const r=(e,t)=>{e.style.display="block",t.style.display="none"};e.userEnter(t,(()=>r(i,n))),e.userLeave(t,(()=>r(n,i))),e.userDown(t,(()=>{n=o?a:s,i=o?s:a,o=!o,r(n,i)}))})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],s=(t,s)=>{e.userDown(t,(()=>{e.xhr("/idg-php/v3/_load/"+s).then((t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,s.querySelector(".close-icon-btn").addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(s)}),{once:!0}),document.body.appendChild(s)})).catch((e=>console.log("OverlayPopup failed to load: Err msg -",e)))}))};for(let e=0,a=t.length;e<a;e++){let a=t[e];null!==document.querySelector(a.id)&&s(a.id,a.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.userDown(".js-idg-demo-popup-json",(t=>{let s;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");s=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+s).then((t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,document.body.append(s);let a=s.querySelector(".close-icon-btn");a&&a.addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(s)}),{once:!0})})).catch((e=>console.log("overlayPopupJSON: Failed to load",e)))}))})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t="active",s="open",a=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],n=()=>({over:function(){this.btn.classList.add(t),this.show()}}),i=()=>({out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove(t))}}),o=()=>({show:function(){this.open||(this.open=!0,d(this),this.btn.classList.add(s),e.show(this.content,"block"))}}),r=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),l=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),i(),l(),o(),r(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),d=e=>{a.forEach((t=>{t.popup!=e&&t.popup.makeHidden()}))};a.forEach((t=>{let s=document.querySelector(t.btn);if(null!==s){let a=c({btn:s,content:document.querySelector(t.content)});e.userDown(t.btn,(()=>a.change())),e.userEnter(t.btn,(()=>a.over())),e.userLeave(t.btn,(e=>a.out(e))),e.userLeave(t.content,(e=>a.out(e))),t.popup=a}}))})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,s=!1,a=null,n=null,i=null,o=window.innerHeight;const r={},l=()=>{n.style.display="none",t=s=!1,a=null},c=(l,c)=>{if(a===l&&t)return s=!0,void e.show(i,"block");n=n||(()=>{const e=document.createElement("div");return e.className="oe-patient-quick-overview",e.style.display="none",e.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),document.body.appendChild(e),i=e.querySelector(".close-icon-btn"),r.surname=e.querySelector(".patient-surname"),r.first=e.querySelector(".patient-firstname"),r.hospital=e.querySelector(".hospital-number"),r.nhs=e.querySelector(".nhs-number"),r.gender=e.querySelector(".patient-gender"),r.age=e.querySelector(".patient-age"),e})(),t=!0,s=c,a=l;let d=l.dataset,u=l.getBoundingClientRect(),p=d.mode,h=d.php,g=JSON.parse(d.patient);r.surname.textContent=g.surname,r.first.textContent=g.first,r.hospital.innerHTML="<span>ID</span> "+g.id,r.nhs.innerHTML="<span>NHS</span> "+g.nhs,r.gender.innerHTML="<em>Gen</em> "+g.gender,r.age.innerHTML="<em>Age</em> "+g.age,n.style.cssText=" ","float"==p?(n.classList.remove("side-panel"),o-u.y>300?n.style.top=u.y+u.height+5+"px":n.style.bottom=o-u.top+10+"px",n.style.left=u.x-250+u.width/2+"px"):n.classList.add("side-panel");let m=n.querySelector(".quick-overview-content");m.innerHTML="";let y=setTimeout((()=>m.innerHTML='<i class="spinner"></i>'),400);c?e.show(i,"block"):e.hide(i),e.xhr("/idg-php/v3/_load/"+h).then((e=>{clearTimeout(y),t&&(m.innerHTML=e.html,n.style.display="block")})).catch((e=>console.log("ed3app php failed to load",e)))};e.userDown(".js-patient-quick-overview",(e=>{let n=e.target;t&&s&&a===n?l():c(n,!0)})),e.userEnter(".js-patient-quick-overview",(e=>{s||c(e.target,!1)})),e.userLeave(".js-patient-quick-overview",(e=>{s||l()})),e.userDown(".oe-patient-quick-overview .close-icon-btn .oe-i",l),e.listenForResize((()=>o=window.inneHeight))})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],s=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=n(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),a=e=>{let t=e.querySelector(".pro-view-btn"),a=e.querySelector(".data-pro-view"),n=e.querySelector(".data-standard-view"),i={btn:t,oei:t.querySelector(".oe-i"),pro:a,standard:n,inPro:!0,linked:!1};return Object.assign(i,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},s())},n=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.userDown(".pro-view-btn",(s=>{const n=s.target;let i=e.getDataAttr(n);if(i)t[parseFloat(i)].change();else{e.setDataAttr(n,t.length);let s=a(e.getParent(n,".pro-data-view"));s.options(JSON.parse(n.dataset.proview)),s.change(),t.push(s)}}))})(bluejay),(function(e){"use strict";if(e.addModule("syncData"),null==document.getElementById("js-sync-data"))return;const t=document.querySelector(".sync-data .sync-btn"),s=document.querySelector(".sync-data .last-sync"),a=document.querySelector(".sync-data .sync-interval");let n=null;const i=()=>s.textContent=e.clock24(new Date(Date.now())),o=e=>{if(clearInterval(n),e){const s=e>1?"mins":"min";a.textContent=`${e} ${s}`,n=setInterval((()=>i()),6e4*e),i(),t.classList.add("on")}else a.textContent="Sync OFF",t.classList.remove("on")};o(1),e.userClick(".sync-options button",(e=>{o(parseInt(e.target.dataset.sync,10))}))})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t-e.clientHeight>15&&(e.style.height="auto",e.style.height=t+5+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",(e=>{"TEXTAREA"==e.target.tagName&&t(e.target)}),!1),document.addEventListener("DOMContentLoaded",(()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach((e=>{t(e)}))}))})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t=Object.assign({selector:".js-has-tooltip",showing:!1,target:null,type:null,clickThrough:!1,tip:null,eyeIcons:null,reset(){this.showing=!1,this.type=null,this.target=null,this.views.notify()},update(e){if(this.showing=!0,this.target=e,e.hasAttribute("data-tooltip-content"))this.type="basic",this.tip=e.dataset.tooltipContent;else{const t=JSON.parse(e.dataset.tt);this.type=t.type,this.clickThrough=t.clickPopup,"bilateral"==this.type?(this.tip={r:t.tipR,l:t.tipL},this.eyeIcons=t.eyeIcons):this.tip=t.tip}this.views.notify()}},e.ModelViews()),s=(()=>{const s=document.createElement("div");let a=window.innerWidth;e.listenForResize((()=>a=window.innerWidth));const n=()=>{s.innerHTML="",s.className="oe-tooltip",s.style.cssText="display:none"};return t.views.add((()=>{t.showing||n()})),n(),document.body.appendChild(s),{div:s,reset:n,show:(n,i)=>{let o=i/2,r=e.getHiddenElemSize(s).h,l=t.target.getBoundingClientRect(),c=l.right-l.width/2,d=l.top-r-8,u=a>e.settings("cssHotlistFixed")?e.settings("cssExtended"):a;c<=o&&(o=20,s.classList.add("offset-right")),c>u-o&&(o=i-20,s.classList.add("offset-left")),l.top<r&&(d=l.bottom+8,s.classList.add("inverted")),s.style.top=d+"px",s.style.left=c-o+"px",s.style.display=n}}})();t.views.add((()=>{"basic"===t.type&&(s.reset(),s.div.innerHTML=t.tip,s.show("block",200))}));t.views.add((()=>{"bilateral"===t.type&&(s.reset(),s.div.classList.add("bilateral"),s.div.innerHTML=Mustache.render('<div class="right">{{&r}}</div><div class="left">{{&l}}</div>',t.tip),t.eyeIcons||s.div.classList.add("no-icons"),s.show("flex",400))}));const a=e=>{!1!==t.showing&&(t.reset(),window.removeEventListener("scroll",a,{capture:!0,once:!0}))},n=e=>{t.update(e.target),window.addEventListener("scroll",a,{capture:!0,once:!0})};e.userDown(t.selector,(e=>{e.target.isSameNode(t.target)&&t.showing?a():n(e)})),e.userEnter(t.selector,n),e.userLeave(t.selector,a)})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions"),s=document.querySelector("#js-wb3-openclose-actions");if(e.userDown("#js-wb3-openclose-actions",(e=>{s.classList.contains("up")?(s.classList.replace("up","close"),t.classList.replace("down","up")):(s.classList.replace("close","up"),t.classList.replace("up","down"))})),e.userDown(".wb-idg-demo-btn",(e=>{window.location="/v3-whiteboard/"+e.target.dataset.url})),e.userDown(".edit-widget-btn .oe-i",(t=>{let s=t.target,a=e.getParent(s,".oe-wb-widget"),n=a.querySelector(".wb-data ul"),i=a.querySelector(".wb-data .edit-widget");s.classList.contains("pencil")?(s.classList.replace("pencil","tick"),e.hide(n),e.show(i,"block")):(s.classList.replace("tick","pencil"),e.hide(i),e.show(n,"block"))})),null===document.querySelector(".multipage-nav"))return;let a=document.querySelector(".multipage-stack"),n=e.nodeArray(a.querySelectorAll("img")),i=n[0].height+20;e.listenForResize((()=>i=n[0].height+20));let o=0;const r=e=>{o+=e,o<0&&(o=0),o>n.length*i&&(o=n.length*i),a.scrollTop=o};e.userDown("#js-scroll-btn-down",(()=>r(200))),e.userDown("#js-scroll-btn-up",(()=>r(-200)));let l=document.querySelector(".page-jump");n.forEach(((e,t)=>{let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",t),s.textContent=t+1,l.appendChild(s)})),e.userDown(".page-num-btn",(e=>{o=0;let t=parseInt(e.target.dataset.page*i);r(t)}))})(bluejay),(function(e){"use strict";e.addModule("GUI-btnShowContent");const t="active",s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"))}}),a=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),n=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),a());[{btn:"js-nav-shortcuts-btn",wrapper:"js-nav-shortcuts",contentID:"js-nav-shortcuts-subnav"},{btn:"js-header-print-dropdown-btn",wrapper:"js-header-print-dropdown",contentID:"js-header-print-subnav"},{btn:"js-sidebar-filter-btn",wrapper:"js-sidebar-filter",contentID:"js-sidebar-filter-options"},{btn:"js-sync-btn",wrapper:"js-sync-data",contentID:"js-sync-options"}].forEach((t=>{const s=document.getElementById(t.btn);if(null!==s){const a=n({btn:s,content:document.getElementById(t.contentID),open:!1});e.userDown(`#${t.btn}`,(()=>a.change())),e.userEnter(`#${t.btn}`,(()=>a.show())),e.userLeave(`#${t.wrapper}`,(()=>a.hide()))}}))})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let s,a=!1;const n={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const i=()=>{n.close.removeEventListener("mousedown",i),n.save&&(n.save.removeEventListener("mousedown",i),n.cancel.removeEventListener("mousedown",i)),e.remove(s),a=!1},o=t=>{a||(t=>{a=!0,s=document.createElement("div"),s.className="oe-popup-wrap";let o='<div class="oe-popup-attachment">';o+='<div class="title">'+t.title+"</div>",o+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',o+='<div class="file-attachment-content"></div>',o+='<div class="file-size-controls"></div>',o+="</div>",s.innerHTML=o;const r=s.querySelector(".file-attachment-content"),l=s.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,s=!1)=>{let a=document.createElement("button");return a.className=t,s&&(a.id=s),a.textContent=e,c.appendChild(a),a};if("pdf"!==t.type){let e="url('"+t.file+"')";r.style.backgroundImage=e,r.innerHTML='<img src="'+t.file+'" style="display:none"/>';const a=s.querySelector("img"),n=d("Fit to screen","pro-theme selected","oe-att-fit"),i=d("Actual size","pro-theme","oe-att-actual"),o=(e,t,s,n)=>{r.style.backgroundImage=e,a.style.display=t,s.classList.add("selected"),n.classList.remove("selected")};i.addEventListener("mousedown",(e=>{e.stopPropagation(),o("none","block",i,n)})),n.addEventListener("mousedown",(t=>{t.stopPropagation(),o(e,"none",n,i)}))}else r.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){r.classList.add("annotation");let a=document.createElement("div");a.className="attachment-annotation",e.find(".oe-popup-attachment",s).appendChild(a),e.xhr(t.idgPHP).then((e=>{a.innerHTML=e.html,"L"==t.eyelat&&(a.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(a.querySelector("#annotation-left").style.visibility="hidden")})).catch((e=>console.log("XHR failed: ",e))),n.save=d("Save annotations","green hint"),n.cancel=d("Cancel","red hint"),n.save.addEventListener("mousedown",i,{once:!0}),n.cancel.addEventListener("mousedown",i,{once:!0})}if(t.stack){let a=t.title.split(" - "),n="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)n+="<option>"+a[0]+" - ("+e+" Jan 1975 09:30)</option>";let i=document.createElement("div");i.className="attachment-stack",i.innerHTML='Choose report: <select class="pro-theme">'+n+"</select>",e.find(".oe-popup-attachment",s).appendChild(i)}n.close=s.querySelector(".close-icon-btn"),n.close.addEventListener("mousedown",i,{once:!0}),l.appendChild(c),document.body.appendChild(s)})(JSON.parse(t.target.dataset.attachment))};e.userDown("."+t,o),document.querySelectorAll(".js-annotate-attachment")&&e.userDown(".js-annotate-attachment",o)})(bluejay),(function(e){"use strict";e.addModule("autoCompleteInput");e.userDown(".js-idg-demo-autocomplete",(t=>(t=>{const s=t.getBoundingClientRect(),a=e.dom("ul","oe-autocomplete");a.innerHTML=["<li>Example of an autocomplete</li>","<li>Another longer example of an autocomplete suggestion</li>","<li>Abnormal communication between pericardial sac and peritoneal cavity</li>"].join(""),a.style.top=s.top+s.height+"px",a.style.left=s.left+"px",document.body.append(a),document.addEventListener("focusout",(e=>{a.remove()}),{once:!0})})(t.target)))})(bluejay),(function(e){"use strict";e.addModule("clinicPathway");let t=null;const s=document.getElementById("js-idg-clinic-pathway-btn"),a=()=>{t=e.div("pathway-in-event"),t.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle small-icon"></i></div>','<div class="clinic-pathway"><i class="spinner as-icon"></i></div>'].join(""),document.querySelector("main").classList.add("allow-for-pathway"),document.body.append(t),setTimeout((()=>(()=>{const s=Date.now(),a=e.clock24(new Date(s-93e5)),n=t.querySelector(".clinic-pathway");n.innerHTML=['<table class="oec-patients in-event">',"<tbody>","<tr>",`<td>${a}</td>`,'<td><div class="list-name">Accident &amp; Emergency</div><div class="code">First Attendance</div></td>','<td><div class="pathway active"></div></td>','<td><label class="patient-checkbox"><input class="js-check-patient" type="checkbox" value="demoAdd"><div class="checkbox-btn"></div></label></td>','<td><i class="oe-i circle-amber medium-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="Priority: Urgent"></i></td>',"<td></td>",'<td><div class="wait-duration"><svg class="duration-graphic yellow" viewBox="0 0 48 12" height="12" width="48"><circle class="c0" cx="6" cy="6" r="6"></circle><circle class="c1" cx="18" cy="6" r="6"></circle><circle class="c2" cx="30" cy="6" r="6"></circle><circle class="c3" cx="42" cy="6" r="6"></circle></svg><div class="mins"><small>2:35</small></div></div></td>',"<td>\x3c!-- complete action --\x3e</td>","</tr>","</tbody>","</table>"].join("");const i=n.querySelector(".pathway"),o=n.querySelector("td:nth-child(6)"),r=bluejay.namespace("gui");r.pathStep({shortcode:"i-comments",status:"buff",type:"comments",info:"&nbsp;",idgPopupCode:"i-comments-none"},o),r.pathStep({shortcode:"i-arr",status:"buff",type:"arrive",info:a},i),r.pathStep({shortcode:"Triage",status:"done",type:"process",info:e.clock24(new Date(s-888e4))},i),r.pathStep({shortcode:"i-redflag",status:"buff",type:"red-flag",info:e.clock24(new Date(s-714e4))},i),r.pathStep({shortcode:"MM",status:"active",type:"person",info:e.clock24(new Date(s-594e4))},i),r.pathStep({shortcode:"i-drug-admin",status:"todo",type:"process",info:"clock",idgPopupCode:"PSD-B"},i),r.pathStep({shortcode:"i-discharge",status:"todo",type:"process",info:"clock"},i),r.pathStep({shortcode:"Letter",status:"todo",type:"process",info:"clock"},i),r.pathStep({shortcode:"Blood",status:"todo",type:"process",info:"clock"},i)})()),500),s.classList.add("active")},n=()=>{t.remove(),document.querySelector("main").classList.remove("allow-for-pathway"),s.classList.remove("active")};e.userDown("#js-idg-clinic-pathway-btn",(()=>{s.classList.contains("active")?n():a(),s.blur()})),e.userDown(".pathway-in-event .close-icon-btn i",n)})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.userDown(".js-idg-ed3-app-btn",(s=>{let a=s.target;t=t||(()=>{let e=document.createElement("div");return e.className="oe-eyedraw-app spinner-loader",document.body.appendChild(e),e})();let n=a.getBoundingClientRect().bottom-532;t.style.top=n<60?"60px":n+"px",e.show(t,"block");let i=JSON.parse(a.dataset.idgDemo);var o=Object.keys(i).map((e=>e+"="+i[e])).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+o).then((e=>{t.innerHTML=e.html,t.querySelector(".close-icon-btn").addEventListener("mousedown",(()=>{t.style.display="none"}),{once:!0})})).catch((e=>console.log("ed3app php failed to load",e)))}))})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then((e=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=e.html,this.btn.classList.add("selected"),document.body.appendChild(this.nav))})).catch((e=>console.log("PHP failed to load",e)))}}),s=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.remove(this.nav)}}),a=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),n=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map((e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>"));this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),document.body.appendChild(this.nav)}}),i=e=>Object.assign({btn:null,open:!1,wrapClass:e},a(),t(),n(),s());if(null!==document.querySelector("#js-manage-elements-btn")){const t=i("oe-element-selector");e.userDown("#js-manage-elements-btn",(e=>t.change(e))),e.userDown(".oe-element-selector .close-icon-btn button",(()=>t.close()))}if(null!==document.querySelector("#js-element-structure-btn")){const t=i("sidebar element-overlay");e.userDown("#js-element-structure-btn",(e=>t.change(e)))}})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",s=document.querySelector(t);if(null===s)return;const a=document.querySelector("#js-event-audit-trail");null===a&&e.log("Audit Trail content not available in DOM?");let n=!1;const i=t=>{e.show(a,"block"),s.classList.add("active"),n=!0},o=t=>{e.hide(a),s.classList.remove("active"),n=!1};e.userDown(t,(e=>n?o(e):i(e))),e.userEnter(t,i),e.userLeave(t,o)})(bluejay),(function(e){"use strict";e.addModule("eventsUserTrail");if(null===document.querySelector("#js-events-user-trail"))return;let t=null;e.userDown("#js-events-user-trail",(()=>{t=document.createElement("div"),t.className="oe-popup-wrap";let s=document.createElement("div");s.className="oe-popup oe-events-user-trail",t.appendChild(s),document.body.appendChild(t);let a=setTimeout((()=>s.innerHTML='<i class="spinner"></i>'),400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then((e=>{clearTimeout(a),s.innerHTML=e.html})).catch((e=>console.log("ed3app php failed to load",e)))})),e.userDown(".js-idg-toggle-event-audit-trail",(e=>{let s=e.target,a=t.querySelector("#"+s.dataset.auditid);"block"===a.style.display?a.style.display="none":a.style.display="block"})),e.userDown(".oe-events-user-trail .close-icon-btn .oe-i",(()=>{e.remove(t)}))})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.userDown("#js-search-in-event",(t=>{const s=t.target,a=document.querySelector("#js-search-in-event-popup"),n=document.querySelector(".main-event"),i=a.querySelector(".close-icon-btn");s.classList.add("selected"),e.show(a,"block"),n.classList.add("examination-search-active"),i.addEventListener("mousedown",(t=>{t.stopPropagation(),n.classList.remove("examination-search-active"),e.hide(a),s.classList.remove("selected")}),{once:!0})}))})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],s="active",a=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),this.positionContent(),e.show(this.content,"block"),this.mouseOutHide(),this.closeIconBtn())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(s),e.hide(this.content))}}),i=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,s,a,n=this.btn.getBoundingClientRect(),i=e.getHiddenElemSize(this.content);n.top<400?(t="top",s=n.top):(t="bottom",s=n.bottom-i.h),n.left<500?(t+="-left",a=n.left):(t+="-right",a=n.right-i.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=s+"px",this.content.style.left=a+"px"}}),o=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},a(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",(e=>{e.stopPropagation(),this.hide()}),{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",(e=>{e.stopPropagation(),this.hide()}),{once:!0})}},i());e.userDown(".oe-filter-options .oe-filter-btn",(s=>(s=>{let a=s.target,n=e.getDataAttr(a);if(n)t[parseFloat(n)].change();else{let s=e.getParent(a,".oe-filter-options"),n=o({btn:a,wrapper:s,content:s.querySelector(".filter-options-popup")});n.show(),e.setDataAttr(a,t.length),t.push(n)}})(s)))})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),s=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t),"block"),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),a=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),n=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),i=()=>({xscroll:function(e,t){var s=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(s)}}),o=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),r=Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),{updateMeta:function(e){let t=document.querySelector(".lightning-meta"),s=e.split(",");[".type",".date",".who"].forEach(((e,a)=>{t.querySelector(e).textContent=s[a]}))}},s(),a(),n(),i(),o(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}});r.updateCounter(),r.swipeLock(),e.userDown("#lightning-left-btn",(()=>r.stepThrough(-1))),e.userDown("#lightning-right-btn",(()=>r.stepThrough(1))),e.userDown(".lightning-view",(()=>r.swipeLock())),e.userDown(".icon-event",(()=>r.swipeLock())),e.userEnter(".icon-event",(e=>{let t=e.target;r.updateStack(t.dataset.id),r.updateMeta(t.dataset.meta)}));const l=document.querySelector(".lightning-view");l.addEventListener("mousemove",(e=>{})),e.listenForResize((()=>r.xscrollWidth=l.clientWidth)),document.addEventListener("keydown",(e=>{37==(e.keyCode||e.which)&&r.stepThrough(-1),39==(e.keyCode||e.which)&&r.stepThrough(1)}))})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach((t=>{let s=t.childElementCount,a=document.createElement("div");a.textContent="("+s+")",e.hide(a),t.parentNode.appendChild(a)}));e.userDown(".js-timeline-date",(t=>{let s=t.target,a=document.querySelector("#js-icon-"+s.dataset.icons);s.classList.contains("collapse")?(e.hide(a),e.show(a.nextElementSibling,"block"),s.classList.replace("collapse","expand")):(e.show(a,"block"),e.hide(a.nextElementSibling),s.classList.replace("expand","collapse"))}))})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const s=()=>({animateScrollTo:function(e){let t=1,s=0,a=this.stack.scrollTop,n=this.pageH*e-a;clearInterval(this.animateID),this.animateID=setInterval((()=>{var e;s=Math.min(1,t/80),this.stack.scrollTop=Math.ceil(((e=s)<.5?2*e*e:(4-2*e)*e-1)*n)+a,t+=1,1==s&&clearInterval(this.animateID)}),2)}}),a=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach((e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let s=0;s<e.numOfImgs;s++){let a=document.createElement("div");a.className="page-num-btn",a.setAttribute("data-page",s),a.textContent=s+1+"/"+e.numOfImgs,t.appendChild(a)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",(t=>e.pageBtn(t.target)),{capture:!0}),e.nav.addEventListener("mousedown",(t=>e.pageBtn(t.target)),{capture:!0}),Object.assign(e,a(),s())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})}))})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const s=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),a=((()=>{const a=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),n=document.createElement("div");n.className=s.selector.options.replace(".",""),n.innerHTML=Mustache.render(a,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(n),t.appendChild(n)})(),(()=>{const t="oes-layout-icon",a=document.querySelector(s.selector.btn),n=a.querySelector("."+t),i=a.querySelector(".oe-eye-lat-icons");s.views.add((()=>{n.className=t+"  i-"+s.layout;let a=s.eye.split("-");i.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:a}),e.customEvent("oesLayoutEyeSide",a)}))})(),(()=>{let t=null;const a=document.querySelector(".oes-v2 .oes-right-side"),n=document.querySelector(".oes-v2 .oes-left-side"),i=()=>{if(s.layout!==t){switch(t=s.layout,t){case"1-0":n.style.width="",e.show(n),e.hide(a);break;case"0-1":a.style.width="",e.hide(n),e.show(a);break;case"2-1":n.style.width="66%",a.style.width="33%",e.show(n),e.show(a);break;case"1-2":n.style.width="33%",a.style.width="66%",e.show(n),e.show(a);break;case"1-1":n.style.width="50%",a.style.width="50%",e.show(n),e.show(a);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};i(),s.views.add(i)})(),(()=>{let a=!1;const n=t.querySelector(s.selector.btn),i=t.querySelector(s.selector.options),o=t=>{a=!0,e.show(i),n.classList.add("active")},r=t=>{a=!1,e.hide(i),n.classList.remove("active")};return{show:o,hide:r,change:e=>{a?r():o()}}})());e.userDown(s.selector.btn,a.change),e.userEnter(s.selector.btn,a.show),e.userLeave(s.selector.rootElem,a.hide),e.userDown(s.selector.optionBtn,(e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(s.eye=t[1]),"layout"==t[0]&&(s.layout=t[1])})(e.target.dataset.oes)))})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const s=[],a=(e,t,s)=>({id:e,text:t,info:s});e.nodeArray(t[0].querySelectorAll("li")).forEach((e=>{s.push(a(s.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))})),t.forEach((t=>{e.nodeArray(t.querySelectorAll("li")).forEach(((t,s)=>{e.setDataAttr(t,s)}))}));let n=s.length+1;const i=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),o=(a,n)=>{let o=s.findIndex((e=>e.id==a)),r=s.findIndex((e=>e.id==n));s[o]=s.splice(r,1,s[o])[0],t.length>1&&t.forEach((t=>{let a=t.querySelectorAll("li");for(let t=0,n=s.length;t<n;t++){let n=s[t],o=a[t];n.id!=e.getDataAttr(o)&&(e.setDataAttr(o,n.id),o.innerHTML=i(n.text,n.info))}}))};e.userDown(".create-new-problem-plan button",(o=>{o.preventDefault();let r=e.getParent(o.target,".create-new-problem-plan").querySelector("input");if(!r||r.value.length<2)return;let l=a(n++,r.value,"Added now!");var c;s.push(l),c=(t=>{const s=new DocumentFragment,a=document.createElement("li");return a.innerHTML=i(t.text,t.info),e.setDataAttr(a,t.id),s.appendChild(a),s})(l),t.forEach((e=>{e.appendChild(c.cloneNode(!0)),h(e.lastChild)}))})),e.userDown(".problems-plans-sortable .remove-circle",(a=>{let n=e.getParent(a.target,"li"),i=0;for(;null!==(n=n.previousSibling);)i++;t.forEach((t=>{e.remove(t.childNodes[i])})),s.splice(i,1)})),document.addEventListener("DOMContentLoaded",(()=>{t.forEach((t=>{e.nodeArray(t.querySelectorAll("li")).forEach((e=>{h(e)}))}))}));let r=null,l="js-sorting-list";const c=e=>{r=e.target,e.target.parentNode.classList.add(l),e.dataTransfer.setData("source",r.innerHTML)},d=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},u=e=>(e.preventDefault&&e.preventDefault(),!1),p=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains(l))return t.target.parentNode.classList.remove(l),r!=t.target&&(r.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),o(e.getDataAttr(r),e.getDataAttr(t.target))),!1},h=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",c,!1),e.addEventListener("dragenter",d,!1),e.addEventListener("dragover",u,!1),e.addEventListener("drop",p,!1)}})(bluejay),(function(e){"use strict";e.addModule("quicktag");const t={qtags:["Adverse_Event","Serious_Adverse_Event","Note","My_research","my_teaching","Research","Teaching","Referred","Results","My_Results_pending"].map((e=>e.toLowerCase()))};e.extend("wrapQtags",(e=>{let s=e.split(" "),a=[],n=[];if(s.forEach(((e,s)=>{e.startsWith("#")&&t.qtags.indexOf(e.substring(1))>=0?n.push(e):a.push(e)})),n.sort(),n.length){let e=n.map((e=>`<span class="qtag">${e}</span>`));return{text:n.join(" ")+" "+a.join(" "),DOMString:e.join(" ")+'<span class="dot-list-divider"></span>'+a.join(" ")}}return{text:e,DOMString:e}}));const s=(()=>{let s=!1,a="";const n={input:null,tags:null,flag:null},i=e=>{e.length?(a=e[0],n.tags.innerHTML=Mustache.render('{{#qtags}}<span class="qtag">#{{.}}</span> {{/qtags}}',{qtags:e}),n.tags.querySelector(".qtag:first-child").classList.add("selected")):(a="",n.tags.innerHTML='<div class="no-matching-tags">No matching Patient Tags</div>')};return{init:a=>{if(s)return;s=!0;const o=e.wrap(a,"js-qtag-wrapper");a.focus();let r=document.createElement("div");r.className="oe-qtags",r.style.display="none";let l=document.createElement("div");l.className="oe-qtags-flag",l.textContent="#",a.getBoundingClientRect().top<e.getWinH()-170?(r.style.top="100%",l.style.top="100%"):(r.style.bottom="100%",l.style.bottom="100%"),o.appendChild(l),o.appendChild(r),n.input=a,n.tags=r,n.flag=l,i(t.qtags)},showTags:()=>{n.tags.style.display="block",n.flag.style.display="none",i(t.qtags)},hideTags:()=>{n.tags.style.display="none",n.flag.style.display="block"},userTyping:e=>{const s=(e=e.toLowerCase()).match(/[a-z-_]*/)[0],a=s.length,n=t.qtags.filter((e=>e.substring(0,a)==s));i(n)},selectedTag:()=>a,reset:()=>{s&&(e.remove(n.tags),e.remove(n.flag),e.unwrap(n.input),n.tags=null,n.flag=null,n.input=null,s=!1)}}})(),a=e=>{e.isComposing||229===e.keyCode||("Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),e.stopPropagation(),n.insertTag(s.selectedTag()))," "==e.key&&n.stopTagging())},n=(()=>{let t=!1,i=null,o=0,r="",l=!1;const c=()=>{document.removeEventListener("input",g,{capture:!0}),document.removeEventListener("blur",h,{capture:!0}),i=null,t=!1,o=0,s.reset()},d=()=>{t=!1,o=0,s.hideTags(),e.log("[qTags] - Keys: Enter, Tab and Spacebar - normal"),document.removeEventListener("keydown",a,!0)},u=n=>{t=!0,o=n,r=i.value,s.showTags(),e.log("[qTags] - Keys: Enter, Tab & Spacebar - suspended (keydown)"),document.addEventListener("keydown",a,!0)},p=()=>{l=!0,setTimeout((()=>{i.focus(),l=!1}),20)},h=()=>{l||c()},g=e=>{t?s.userTyping(i.value.substring(o)):"#"===e.data&&u(e.target.selectionStart)};return{init:e=>{e.isSameNode(i)||(null!==i&&c(),e.classList.contains("js-allow-qtags")&&(i=e,s.init(i),document.addEventListener("input",g,{capture:!0}),document.addEventListener("blur",h,{capture:!0})))},stopTagging:d,insertTag:e=>{let t=e+" ";o===r.length?i.value=r+t:i.value=r.substring(0,o)+t+r.substring(o+1),d()},userClicksFlag:()=>{i.value=i.value+" #",u(i.value.length),p()},userClicksTag:e=>{n.insertTag(e),p()},reset:c,focusOut:h}})();document.addEventListener("focus",(e=>n.init(e.target)),{capture:!0}),e.userDown(".oe-qtags",n.stopTagging),e.userDown(".oe-qtags-flag",n.userClicksFlag),e.userDown(".oe-qtags .qtag",(e=>{const t=e.target.textContent;n.userClicksTag(t.substring(1))}))})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],s=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.userDown(".element .js-elem-reduce .oe-i",((a,n)=>{let i=a.target,o=e.getDataAttr(i);if(o)t[parseFloat(o)].change();else{let a=s({elem:e.getParent(i,".element"),icon:i});a.change(),e.setDataAttr(i,t.length),t.push(a)}}))})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",s=e.getDataAttributeName(),a=[];function n(e,t,s){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=s,this.content.addEventListener("scroll",(()=>this.scroll()),{once:!0})}n.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout((()=>e.remove(this.flag)),400)},n.prototype.userClick=function(){this.hasScrolled||i(this.content,this.scrollEndPos)};const i=(e,t)=>{let s=1,a=0,n=setInterval((()=>{var i;a=Math.min(1,s/200),e.scrollTop=Math.ceil((i=a)*(2-i)*t),s+=1,1==a&&clearInterval(n)}),2)};(()=>{let i=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(i.length<1)return;const o=document.createDocumentFragment(),r=document.createElement("div");r.className=t,o.appendChild(r),i.forEach((e=>{let t=e.querySelector(".restrict-data-content"),i=e.clientHeight,r=t.scrollHeight;if(r>i&&0===t.scrollTop){let l=o.cloneNode(!0),c=l.firstChild;c.setAttribute(s,a.length),e.appendChild(l),a.push(new n(c,t,r-i))}}))})(),e.userDown("."+t,(e=>{a[e.target.getAttribute(s)].userClick()}))})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const s=e.nodeArray(document.querySelectorAll(".js-filter-group"));let a=document.querySelector(".js-list-filter.selected");const n=e=>{s.forEach((t=>{t.style.display=e}))};t.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();let s=t.target;var i;s.classList.add("selected"),"all"==(i=s.dataset.list)?n("block"):(n("none"),e.show(document.querySelector("#"+i),"block")),a.classList.remove("selected"),a=s}))}))})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let s=document.querySelectorAll(".element-title");if(s.length<1)return;let a=document.createDocumentFragment();s.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",a.appendChild(t)})),t.appendChild(a)})(),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector(".sidebar-eventlist"))return;const t={el:null,show(e){this.el=e.parentNode.previousSibling,this.el.classList.add("fade-in")},hide(){this.el.classList.remove("fade-in")}},s={id:null,div:null,locked:!1,iCloseBtn:"i-btn-close",click(e){e.id==this.id?this.locked?this.unlock():this.lock():(this.show(e),this.lock())},over(e){this.locked||this.show(e)},out(){this.locked||this.remove()},lock(){this.locked=!0,this.div.appendChild(e.div(`${this.iCloseBtn}`))},unlock(){this.locked=!1,this.div.querySelector(`.${this.iCloseBtn}`).remove()},close(){this.remove(),this.locked=!1},remove(){this.div.remove(),this.div=null,this.id=null},show(t){null!==this.div&&this.remove(),this.id=t.id;const s=['<div class="event-icon"><i class="oe-i-e large {{icon}}"></i></div>','<div class="title">{{event}} - {{date}}</div>','<div class="quick-view-content {{type}}"></div>'].join("");this.div=e.div("oe-event-quickview fade-in"),this.div.innerHTML=Mustache.render(s,t),this.load(t.type,t.content),document.body.appendChild(this.div)},load(t,s){const a=this.div.querySelector(".quick-view-content");switch(t){case"img":a.innerHTML=`<img src="${s}" />`;break;case"pdf":a.innerHTML=`<embed src="${s}#toolbar=0" width="100%" height="100%"></embed>`;break;case"php":e.xhr(s,this.id).then((e=>{this.id==e.token&&(a.innerHTML=e.html)})).catch((e=>console.log("PHP failed to load",e)));break;case"none":a.innerHTML=`<div class="not-available">${s}</div>`;break;default:e.log("QuickView Error - load content type unknown:"+t)}}};e.userEnter(".event .event-type",(a=>{t.show(a.target);const n=e.getParent(a.target,"li.event");s.over(JSON.parse(n.dataset.quick))})),e.userLeave(".event .event-type",(e=>{t.hide(),s.out()})),e.userDown(`.oe-event-quickview .${s.iCloseBtn}`,(()=>{s.close()})),document.addEventListener("click",(t=>{if(t.target.matches(".event .event-type")){t.preventDefault(),t.stopImmediatePropagation();const a=e.getParent(t.target,"li.event");s.click(JSON.parse(a.dataset.quick))}}),{capture:!0})})(bluejay),(function(e){"use strict";if(e.addModule("signatureCapture"),null===document.querySelector(".js-idg-capture-signature"))return;const t=()=>{e.xhr("/idg-php/v3/_load/signature-pad.php").then((t=>{const s=e.div("oe-popup-wrap");s.innerHTML=t.html,document.body.appendChild(s);let a=s.querySelector(".close-icon-btn");a&&a.addEventListener("mousedown",(t=>{e.remove(s)}),{once:!0}),(()=>{var e=document.getElementById("signature-pad").querySelector("canvas"),t=document.getElementById("signature-pad-clear"),s=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"});function a(){var t=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*t,e.height=e.offsetHeight*t,e.getContext("2d").scale(t,t),s.clear()}window.onresize=a,a(),t.addEventListener("click",(function(e){s.clear()}))})()})).catch((e=>console.log("signature pad: failed to load",e)))};e.loadJS("https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js",!0).then((()=>{e.userDown(".js-idg-capture-signature",t)}))})(bluejay),(function(e){"use strict";e.extend("demoSignatureDeviceLink",(()=>{e.xhr("/idg-php/v3/_load/signature-device-link.php").then((t=>{const s=e.div("oe-popup-wrap");s.innerHTML=t.html,document.body.appendChild(s);let a=s.querySelector(".close-icon-btn");a&&a.addEventListener("mousedown",(t=>{e.remove(s)}),{once:!0}),captureSignature()})).catch((e=>console.log("signature popup: failed to load",e)))}))})(bluejay),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let s,a,n=!1;t.addEventListener("dragstart",(e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();s=e.clientX-t.left,a=e.clientY-t.top}),!1),t.addEventListener("dragend",(e=>{let n=Math.round(e.clientY-a),i=Math.round(e.clientX-s);n=n<1?1:n,i=i<1?1:i,t.style.top=n+"px",t.style.left=i+"px"}),!1);e.userDown("#js-vc-scratchpad",(s=>{let a=s.target;n?(e.hide(t),a.textContent="ScratchPad"):(e.show(t,"block"),a.textContent="Hide ScratchPad"),n=!n}))})(bluejay),(function(e){"use strict";const t=bluejay.namespace("addSelect");t.ListOption=function(e,s){let a=e.classList.contains("selected"),n=!1,i=JSON.parse(e.dataset.insert);void 0!==i.dependents&&(n=new t.OptionDependents(i.dependents,s.uniqueId)),this.click=function(){this.toggleState(),s.optionClicked(a,this),0!=n&&n.show(a)},this.toggleState=function(){e.classList.toggle("selected"),a=!a},this.deselect=function(){a&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>a,set:t=>{a=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==n}),Object.defineProperty(this,"value",{get:()=>i.value}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.namespace("addSelect").OptionDependents=function(t,s){if(void 0===t)return!1;const a="#add-to-"+s+"-";let n=[];t.split(",").forEach((e=>{let t=e.split("."),s={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",a+"listgroup"+t[0]),s.div=document.querySelector(a+"listgroup"+t[0]),null===s.div&&console.log("obj.div = null!",a+"listgroup"+t[0]),s.holder=s.div.querySelector(".optional-placeholder"),null===s.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])s.showDefaultText=!0;else{s.showDefaultText=!1,s.lists=[];for(let e=1;e<t.length;e++){let n=document.querySelector(a+"list"+t[e]);null===n?console.log("Err: OptionDependents, list? ",a+"list"+t[e]):s.lists.push(n)}}n.push(s)})),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach((t=>{e.hide(t)}))},this.myLists=function(){n.forEach((t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder,"block"):(t.holder&&e.hide(t.holder),t.lists.forEach((t=>{e.show(t,"block")})))}))},this.reset=function(){n.forEach((t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder,"block")}))}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.OptionsList=function(s){let a=JSON.parse(s.dataset.options);const n="inputTemplate"==a.type,i="single"==a.type,o=(a.hasExtraOptions,"true"===a.isOptionalList);this.uniqueId=s.dataset.id,o&&e.hide(s.parentNode);let r=[],l=[];e.nodeArray(s.querySelectorAll("li")).forEach((e=>{let s=new t.ListOption(e,this);r.push(s),s.selected&&s.dependents&&l.push(s)})),this.optionClicked=function(e,t){if(n){let e=s.previousElementSibling,a=t.value,n=a.indexOf("{"),i=a.indexOf("}")+1;return e.value=a,t.deselect(),void setTimeout((()=>{e.focus(),e.select(),e.setSelectionRange(n,i)}),50)}e&&i&&r.forEach((e=>{e!==t&&e.deselect()}))},this.checkForDefaultSelections=()=>{l.length&&l.forEach((e=>{e.selected=!1,e.click()}))}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.Popup=function(s){let a=document.querySelector("#"+s.dataset.popup);if(null==a)return;let n=[];this.anchorLeft=!!a.dataset.anchorLeft,this.btn=s,this.popup=a,this.closeBtn=a.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(a,"block"),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){a.style.display="none"},this.reset=function(){},e.nodeArray(a.querySelectorAll(".add-options")).forEach((e=>{let s=new t.OptionsList(e);s.checkForDefaultSelections(),n.push(s)})),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight,a=s-e.bottom;if(s-a<325&&(a=s-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let s=e.right-this.popup.getBoundingClientRect().width,a=s<0?s-25:0;this.popup.style.right=t-e.right+a+"px"}this.popup.style.bottom=a+"px"}})(bluejay),(function(e,t,s){"use strict";e.addModule("clinicManager");const a=document.getElementById("js-clinic-manager");if(null===a)return;const n=()=>{e.log("[Clinic] - intialising");const n=new Map,o=t.filters(),r=t.adder(),l=Object.assign({_filter:"",delayID:null,get filter(){return this._filter},set filter(e){this._filter=e,this.renderLists(),o.selected(l.filter)},updateView(){this.delayID&&clearTimeout(this.delayID),this.delayID=setTimeout((()=>{null==document.querySelector(".oe-pathstep-popup")&&0==r.isOpen()&&this.renderLists(),this.delayID=null}),1750)},renderLists(){n.forEach((e=>e.render(this._filter)))}},e.ModelViews()),c=()=>{let e=[],t=[],s=new Map,a=new Map;const i=(e,t)=>{t.forEach((t=>{e.has(t.step)?e.get(t.step).add(t.uid):0!=t.step&&e.set(t.step,new Set([t.uid]))}))};n.forEach((n=>{const o=n.getPatientFilterState();e=e.concat(o.status),t=t.concat(o.redflagged),i(s,o.waitingFor),i(a,o.assignments)})),o.updateCount(e,t),o.waitingFor.updateOptions(s),o.assignee.updateOptions(a),l.updateView()};a.addEventListener("change",(e=>{const t=e.target;t.matches(".js-check-patient")&&t.checked&&r.show();const s=a.querySelectorAll("tbody .js-check-patient:checked");r.tickCount(s.length)}),{useCapture:!0});const d=()=>{o.waitingFor.reset(),o.assignee.reset(),s.pathStepPopup.remove(),n.forEach((e=>e.untickPatients()))};e.userDown(".js-idg-clinic-btn-filter",(e=>{d(),l.filter=e.target.dataset.filter})),e.userDown(".js-filter-option",(e=>{d(),l.filter=JSON.parse(e.target.dataset.patients)}),{capture:!0});const u=e=>{n.forEach((t=>t.addStepsToPatients(e)))};e.userDown("div.oec-adder .insert-steps li",(e=>{const s=JSON.parse(e.target.dataset.idg);if("editable"!=s.s)"popup"==s.s&&(t.pathwayPopup(s.c),s.s="todo"),"preset-pathway"==s.c?[{c:"One",s:"todo",t:"process"},{c:"Two",s:"todo",t:"process"},{c:"i-fork",s:"buff",t:"fork"}].forEach((e=>u(e))):(u(s),r.addSuccess());else switch(s.c){case"Gen":t.customStep("common");break;case"on-hold":t.customStep("timer")}})),e.userDown("div.oec-adder .close-btn",(()=>{n.forEach((e=>e.untickPatients())),r.hide()})),e.userClick(".oe-popup button.js-cancel-popup-steps",(t=>{e.getParent(t.target,".oe-popup-wrap").remove(),u({c:"c-last"})}));const p=(e,t)=>{n.forEach((s=>s.patientStateChange(e,t)))};e.userClick(".js-idg-clinic-btn-arrived",(e=>p(e.target.dataset.patient,"arrived"))),e.userDown(".js-idg-pathway-complete",(e=>p(e.target.dataset.patient,"complete"))),e.userDown(".js-idg-pathway-reactivate",(e=>p(e.target.dataset.patient,"reactivate"))),e.userDown(".js-idg-pathway-finish",(e=>t.pathwayPopup("quick-finish")));const h=new DocumentFragment;iDG_ClinicListDemo.forEach((s=>{const a=e.getToken();n.set(a,t.addList(s,a,h))})),a.append(h),l.filter="all",c(),document.addEventListener("idg:AppUpdateFilters",(()=>c())),document.addEventListener("idg:addCustomStep",(e=>{u(e.detail)})),i.remove();const g=e.dom("div","alert-box info row","Please select a list to view");t.navPanelListBtns((e=>{n.forEach((t=>t.showList(e))),e.size?g.remove():a.append(g),c()}))},i=e.div("oe-popup-wrap",'<div class="spinner"></div><div class="spinner-message">Loading...</div>');document.body.append(i),setTimeout((()=>n()),400)})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t){"use strict";bluejay.namespace("clinic").adder=()=>{const t=e.div("oec-adder"),s=e.div("add-to");let a=!1;const n=(()=>{const t=["Caroline Kilduff (CK)","David Haider (DH)","Ian Rodrigues (IR)","James Morgan (JM)","Peter Thomas (PT)","Toby Fisher (TF)","Toby Bisco (TB)"],s=e.div("row"),a=e.dom("ul","btn-list"),n=e.dom("input","assign-to search");n.setAttribute("type","text"),n.setAttribute("placeholder","Assign to...");return{build:i=>{s.append(n,a),i.append(s),n.addEventListener("input",(s=>{s.stopPropagation();const n=s.target.value;var i;n.length>1?(i=n,e.empty(a),t.filter((e=>e.toLowerCase().startsWith(i.toLowerCase()))).forEach((t=>{const s=t.substring(t.length-3),n=e.dom("li",!1,`<i class="oe-i person no-click small pad-right"></i> ${t}`);n.setAttribute("data-idg",JSON.stringify({c:"assign",s:s.slice(0,-1)})),a.append(n)}))):e.empty(a)}))},clear:()=>{e.empty(a),n.value=""}}})();return(()=>{const a=e=>`<i class="oe-i ${e} small pad-right"></i>`,i=new Map,o=(e,t=!1,s=!1,a="todo",n="process",o=!1)=>{t=t||e,s=s||e,i.set(e,{btn:t,shortcode:s,status:a,type:n,idg:o})};o("Nurse"),o("Doctor"),o("HCA"),o("Gen","General task",!1,"editable"),o("Exam","Examination"),o("Triage"),o("Bio","Biometry"),o("Colour"),o("Img","Imaging"),o("VA","Visual Acuity"),o("Orth","Orthoptics"),o("Ref","Refraction"),o("CDU","Clinical decision unit"),o("Presc","Prescription","Rx"),o("Dilate"),o("Dr Jones"),o("DrugAdmin",a("drop")+"Drug Administration Preset Order","i-drug-admin","popup"),o("VisFields","Visual Fields","Fields","popup"),o("Letter"),o("Letter-discharge","Letter - discharge","Disc.letter"),o("Blood","Blood tests"),o("MRI","MRI tests"),o("preset-pathway","Add common pathway",!1,"popup"),o("i-fork",a("fork")+"Decision / review",!1,"buff","fork"),o("i-break",a("path-break")+"Break in pathway",!1,"buff","break"),o("i-discharge",a("stop")+"Check out",!1,"todo","process"),o("on-hold",a("time")+"Hold timer (mins)",!1,"editable"),o("c-last",'Remove last "todo" pathway step');const r=e.div("insert-steps");n.build(r);const l=(t,s)=>{const a=t?`<h4>${t}</h4>`:"",n=e.dom("div","row",a),o=e.dom("ul","btn-list");s.forEach((t=>{const s=i.get(t),a=e.dom("li",!1,`${s.btn}`);a.setAttribute("data-idg",JSON.stringify({c:s.shortcode,s:s.status,t:s.type,i:s.idg})),"c-last"==t&&(a.className="red"),o.append(a)})),n.append(o),r.append(n)};l("Path",["i-fork","i-break","i-discharge","on-hold"]),l("Preset pathways",["preset-pathway"]),l("Standard",["Bio","DrugAdmin","VisFields","Letter","Presc","Exam","Gen"].sort()),l("Custom",["Triage","Colour","Dr Jones","Letter-discharge","Dilate","Img","VA","Orth","Ref","CDU","Doctor","Nurse","HCA","Blood","MRI"].sort()),l("Remove step from patient",["c-last"]),t.append(e.div("close-btn"),s,r),document.querySelector(".oe-clinic").append(t)})(),{show:()=>{a||(a=!0,t.classList.remove("fadein"),t.classList.add("fadein"))},hide:()=>{a=!1,t.classList.remove("fadein"),n.clear()},isOpen:()=>a,tickCount:e=>{s.innerHTML=e?`<span class="num">${e}</span> selected`:"No patients selected"},addSuccess:()=>{s.classList.add("success"),setTimeout((()=>{s.classList.remove("success")}),1200)}}}})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").clock=t=>{const s=e.div("oec-clock");e.hide(s);e.getParent(t,".oec-group").append(s);const a=()=>{const a=e.nodeArray(t.querySelectorAll("tr"));if(!a.length)return void e.hide(s);let n=a[a.length-1].getBoundingClientRect().bottom;const i=Date.now();a.find((e=>{if(e.dataset.timestamp>i)return n=e.getBoundingClientRect().top-1,!0})),n<160?e.hide(s):e.show(s),s.style.top=`${n}px`,s.textContent=e.clock24(new Date(i))};setTimeout((()=>{s.style.top=`${t.getBoundingClientRect().bottom}px`,setInterval(a,500)}),1e3)}})(bluejay),(function(e,t){"use strict";let s=null,a=null,n=null;const i=e=>{if("taskname"==e.target.name){const t=e.target.value,s=e.target.parentNode.querySelector('input[name="shortname"]');t.length>16?s.value=t.substring(0,13)+"...":s.value=t,n.c=s.value.length>1?s.value:"General"}"idg-timer-mins"==e.target.name&&(n.c=e.target.value)};e.userClick("button.js-add-custom-step",(()=>{e.customEvent("idg:addCustomStep",n),a.remove()}));t.customStep=t=>{var o;s=t,a=a||(()=>{const t=e.div("oe-popup-wrap"),s=e.div("oe-popup");return t.append(s),s.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>','<div class="title"></div>','<div class="oe-popup-content">',"</div>\x3c!-- .oe-popup-content --\x3e",'<div class="popup-actions flex-right">','<button class="green hint js-add-custom-step">Add to selected patients</button>','<button class="red hint js-cancel-popup-steps">Cancel</button>',"</div>"].join(""),s.addEventListener("input",i),t})(),"common"==s&&((o=a.firstChild).querySelector(".title").textContent="Add custom general task",o.querySelector(".oe-popup-content").innerHTML=["<h4>Name</h4>",'<input name="taskname" type="text" maxlength="64" size="66" placeholder="Task name (maximum 64 characters)"/>',"<h4>Step pathway display name (restricted to 16 characters)</h4>",'<input name="shortname" type="text" maxlength="16" size="18" placeholder="Display name"/>'].join(""),n={c:"General",s:"todo",t:"process"}),"timer"==s&&(e=>{e.querySelector(".title").textContent="Add pathway hold timer";const t=e=>`<label><input type="radio" name="idg-timer-mins" value="${e}"><div class="li">Add ${e} minute timer</div></label>`;e.querySelector(".oe-popup-content").innerHTML=["<h4>Timer</h4>",'<fieldset class="btn-list">',t(1),t(2),t(5),t(10),t(15),t(20),t(30),"</fieldset>"].join(""),n={c:"1",s:"todo",t:"hold",i:"on-hold"}})(a.firstChild),document.body.append(a)}})(bluejay,bluejay.namespace("clinic")),(function(e){"use strict";null!==document.getElementById("js-clinic-manager")&&document.addEventListener("change",(t=>{if(t.target.matches('input[name="idg-radio-g-fields-custom"]')){const s=document.querySelector(".js-idg-ps-field-custom");3==t.target.value?e.show(s):e.hide(s)}}))})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").filterBtn=(t,s)=>{const a=t.filter,n=e.div("name"),i=e.div("count"),o=document.createElement("li");o.className="filter-btn js-idg-clinic-btn-filter",o.setAttribute("data-filter",a),t.name.startsWith("-f")?n.innerHTML='<i class="oe-i flag-red medium-icon no-click">':n.innerHTML=t.name,o.append(n,i),s.append(o);return{updateCount:(e,t)=>{let s=0;switch(a){case"all":s=e.length;break;case"clinic":s=e.reduce(((e,t)=>"done"!=t&&"later"!=t?e+1:e),0);break;case"-f":s=t.reduce(((e,t)=>t?e+1:e),0);break;case"waiting":s=e.reduce(((e,t)=>"waiting"==t||"long-wait"==t||"stuck"==t?e+1:e),0);break;case"issues":s=e.reduce(((e,t)=>"break"==t||"long-wait"==t||"stuck"==t?e+1:e),0);break;default:s=e.reduce(((e,t)=>t==a?e+1:e),0)}i.textContent=s},selected:e=>{e===a?o.classList.add("selected"):o.classList.remove("selected")}}}})(bluejay),(function(e,t){"use strict";const s=(e,t="")=>`<div class="name">${e}</div><div class="count">${t}</div>`;t.filterChangeable=(t,a="")=>{const n=e.div("changeable-filter"),i=e.dom("nav","options");e.hide(i);const o=e.div("filter-btn");o.innerHTML=s(t),n.append(o,i);return n.addEventListener("mousedown",(e=>{const t=e.target;if(e.target.matches("nav .js-filter-option")){const e=JSON.parse(t.dataset.display);o.innerHTML=s(e.name,e.count),o.classList.add("selected")}})),n.addEventListener("mouseenter",(()=>{e.show(i)})),n.addEventListener("mouseleave",(()=>{e.hide(i)})),{render:()=>n,updateOptions:t=>{const n=new DocumentFragment;t.forEach(((t,i)=>{let o=i,r=i;switch(i){case"i-discharge":r=o="Check out";break;case"i-drug-admin":r=o="Drug Admin";break;case"DH":o="David Haider (DH)";break;case"CK":o="Caroline Kilduff (CK)";break;case"JM":o="James Morgan (JM)";break;case"IR":o="Ian Rodrigues (IR)";break;case"PT":o="Peter Thomas (PT)";break;case"TB":o="Toby Bisco (TB)";break;case"TF":o="Toby Fisher (TF)"}const l=e.div("filter-btn js-filter-option");l.innerHTML=s(`${a} ${o}`,t.size),l.setAttribute("data-patients",JSON.stringify([...t.values()])),l.setAttribute("data-display",JSON.stringify({name:`${a}${r}`,count:t.size})),n.append(l)})),e.empty(i),i.append(n)},reset:()=>{o.classList.remove("selected"),o.innerHTML=s(t)}}}})(bluejay,bluejay.namespace("clinic")),(function(e,t){"use strict";t.filters=()=>{const s=new Set,a=e.dom("ul","quick-filters");[["All","all"],["Arrived","clinic"],["Issues","issues"],["Departed","discharged"],["Completed","done"]].forEach((e=>{s.add(t.filterBtn({name:e[0],filter:e[1]},a))}));const n=e.dom("input","search");n.setAttribute("type","text"),n.setAttribute("placeholder","Name filter");const i=t.filterChangeable("Waiting for&hellip;","&hellip;"),o=t.filterChangeable('<i class="oe-i person no-click medium"></i>'),r=(t,s,a)=>{const n=e.dom("button",`${t} ${s}`,a);return n.setAttribute("name",s),n};document.getElementById("js-clinic-filters").append(r("popup-filter","table-sort","Time"),n,a,i.render(),o.render(),r("popup-filter","info-help-overlay","\x3c!-- icon --\x3e")),e.userDown("#js-clinic-filters button.popup-filter",(e=>{t.pathwayPopup(e.target.name)}));return{updateCount:(...e)=>{s.forEach((t=>t.updateCount(...e)))},selected:e=>{s.forEach((t=>t.selected(e)))},waitingFor:i,assignee:o}}})(bluejay,bluejay.namespace("clinic")),(function(e,t){"use strict";const s=document.getElementById("js-worklists-panel");if(null===s)return;t.navPanelListBtns=t=>{const a=s.querySelector(".js-idg-demo-list-view");if(null==a)return;const n=a.querySelector(".worklists"),i=e.dom("fieldset"),o=new DocumentFragment,r=document.querySelectorAll(".oec-group");if(r.length<2)return;r.forEach((t=>{const s=e.dom("label");s.innerHTML=`<input type="checkbox" value="${t.dataset.id}" checked><span class="btn">${t.dataset.title}</span>`,o.append(s)})),e.empty(n),i.append(o),n.append(i),e.show(a);const l=e.nodeArray(n.querySelectorAll("input[type=checkbox]")),c=a.querySelector("button[name=all]");c.classList.add("selected");const d=()=>{const e=new Set;l.forEach((t=>{t.checked&&e.add(t.value)}));const s=e.size>1?"lists":"list",a=e.size?`<b>${e.size}</b> ${s}`:"<b>0</b>";document.querySelector(".clinic-context .lists").innerHTML=a,t(e)};d(),n.addEventListener("change",(e=>{c.classList.remove("selected"),d()}));const u=e=>{l.forEach((t=>t.checked=e)),d()};c.addEventListener("mousedown",(e=>{c.classList.contains("selected")?(u(!1),c.classList.remove("selected"),setTimeout((()=>c.blur()),100)):(u(!0),c.classList.add("selected"))}))}})(bluejay,bluejay.namespace("clinic")),(function(e){"use strict";const t=document.getElementById("js-worklists-panel");if(null===t)return;const s=document.querySelectorAll(".js-idg-tab-panel");e.userDown("#js-idg-worklist-tab-btns > button",(a=>{t.querySelector("#js-idg-worklist-tab-btns > button.selected").classList.remove("selected");const n=a.target;n.classList.add("selected"),s.forEach((t=>{t.classList.contains(n.name)?e.show(t):e.hide(t)}))}))})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").pathwayPopup=t=>{let s;switch(t){case"i-drug-admin":s="drugadmin-preset-orders.php";break;default:s=`${t}.php`}e.xhr("/idg-php/load/pathway-popups/"+s).then((t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,document.body.append(s);const a=s.querySelector(".js-fake-add");null!=a&&a.addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(s)}),{once:!0})})).catch((e=>console.log("overlayPopupJSON: Failed to load",e)))}})(bluejay),(function(e,t,s){"use strict";t.pathway=t=>{const a=e.div("pathway");t.append(a);const n=[];let i=!1;const o=(e,t=!1)=>n.findIndex((s=>s.getStatus()==e||s.getStatus()==t)),r=(e,t=-1)=>(n.forEach(((s,a)=>{s.getStatus()==e&&(t=a)})),t),l=(e,t)=>{n[e]=n.splice(t,1,n[e])[0]},c=(e,t)=>{const s=n.splice(e,1)[0];e<t&&t--,n.splice(t,0,s)},d=()=>{n.forEach((e=>a.append(e.render())))},u=()=>{i=!0};return{setStatus:e=>a.className=`pathway ${e}`,getStatus:()=>{const e=n[n.length-1].getCode();if("i-fin"==e)return"done";if(i)return"discharged";if("i-wait"==e||"i-delayed"==e)return"stuck";if(n.findIndex((e=>"i-delayed"==e.getCode()))>0)return"long-wait";const t=n.findIndex((e=>"i-break"==e.getCode()));if(t>0){if("break"==n[t].getType())return"break"}return o("active")>0?"active":"waiting"},addStep:e=>{switch(e.getCode()){case"i-arr":n.splice(0,0,e);break;case"i-break":case"i-wait":const t=o("todo","config");-1===t?n.push(e):n.splice(t,0,e);break;default:n.push(e)}d()},removeStep:e=>{if(n.length&&"c-last"==e){const e=n[n.length-1];e.isRemovable()&&n.length>1&&(e.remove(),n.splice(-1,1))}},shiftStepPos:(e,t)=>{const s=n.findIndex((t=>t==e));if(s){const a=s+t,i=n[a];i&&i.isRemovable()&&(l(s,a),d(),e.renderPopup())}},deleteRemovedStep:e=>{n.forEach(((t,s)=>{t.key==e&&n.splice(s,1)}))},stopWaiting:()=>{let e=!1;n.forEach(((t,s)=>{const a=t.getCode();"i-wait"!=a&&"i-delayed"!=a||(t.remove(),e=s)})),e&&n.splice(e,1);const t=o("todo","config"),s=r("active");t>0&&s>t&&(c(s,t),d())},addWaiting:()=>{if(i)return;const e=o("active");if(-1==e){const e=s.pathStep({shortcode:"i-wait",info:0,status:"buff",type:"wait"},null),t=o("todo","config");-1==t?n.push(e):n.splice(t,0,e)}else{const t=r("done");t>e&&l(e,t)}d()},waitingFor:()=>{const e=n.findIndex((e=>{const t=e.getCode();return"i-wait"==t||"i-delayed"==t}));return-1!=e&&e!=n.length-1&&n[e+1].getCode()},checkStepOrder:()=>{const e=o("todo","config"),t=r("done"),s=o("active");c(e,s>1&&e<s?s+1:t+1),d()},discharged:u,canComplete:()=>!!i&&-1==o("todo","config"),removeCompleted:()=>{u();const e=n[n.length-1];"i-fin"==e.getCode()&&(e.remove(),n.splice(-1,1)),d()},completed:()=>{for(let e=n.length-1;e>=0;e--){const t=n[e],s=t.getCode(),a=t.getStatus();"i-wait"!=s&&"Delayed"!=s&&"todo"!=a&&"config"!=a||(t.remove(),n.splice(e,1))}}}}})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t,s){"use strict";t.patient=(a,n=!1)=>{const i=document.createElement("tr"),o={path:document.createElement("td"),addIcon:document.createElement("td"),assign:document.createElement("td"),risks:document.createElement("td"),notes:document.createElement("td"),complete:document.createElement("td")},r=t.pathway(o.path),l=t.waitDuration(a.uid),c=e.dom("input","js-check-patient");c.setAttribute("type","checkbox");const d=Object.assign({uid:a.uid,isRendered:!1,_status:null,risk:null,redFlagged:!1,_assigned:!1,get assigned(){return this._assigned},set assigned(t){this._assigned=t,e.customEvent("idg:AppUpdateFilters")},get status(){return this._status},set status(t){if(!["fake-done","done","waiting","long-wait","active","stuck","later","break","discharged"].find((e=>e==t)))throw new Error(`Clinic: invaild Patient status: "${t}"`);this._status=t,this.views.notify(),e.customEvent("idg:AppUpdateFilters")}},e.ModelViews());d.views.add((()=>{i.className=d.status,r.setStatus(d.status),l.render(d.status),"done"==d.status&&(o.addIcon.innerHTML="\x3c!-- completed --\x3e")}));d.views.add((()=>{const e=(e,t,s,a)=>{o.complete.innerHTML=[`<i class="oe-i ${e} ${t}-icon pad js-has-tooltip ${s}"`,`data-tooltip-content="${a}"`,`data-patient="${d.uid}"></i>`].join(" ")};"later"==d.status?e("no-permissions","small","","Pathway not started"):"done"==d.status?e("undo","medium","js-idg-pathway-reactivate","Re-activate pathway to add steps"):r.canComplete()?e("save","medium","js-idg-pathway-complete","Pathway completed"):"discharged"==d.status?e("save-blue","medium","js-idg-pathway-finish","Quick complete pathway"):e("save-blue","medium","js-idg-pathway-finish","Patient has left<br/>Quick complete pathway")}));const u=t=>{"done"!=d.status&&("i-redflag"==t.shortcode&&(d.redFlagged=!0),"i-arr"==t.shortcode&&"later"!=a.status&&l.arrived(t.timestamp),"i-fin"==t.shortcode&&(l.finished(t.timestamp),r.completed()),"i-break"==t.shortcode&&r.stopWaiting(),"i-wait"==t.shortcode||"i-delayed"==t.shortcode?t.info=t.mins:t.info=e.clock24(new Date(t.timestamp)),r.addStep(s.pathStep(t,null,d.uid)),d.status=r.getStatus())};document.addEventListener("idg:pathStepChange",(e=>{const t=e.detail;if(t.pathwayID==d.uid){switch(t.getStatus()){case"todo":r.checkStepOrder();break;case"active":r.stopWaiting();break;case"done":"i-discharge"==t.getCode()||"DNA"==t.getCode()?(l.finished(Date.now()),r.discharged(),r.canComplete()&&(d.status="discharged",g("complete"))):r.addWaiting();break;case"buff":"break-back"==t.getType()&&r.addWaiting();break;case"userRemoved":r.deleteRemovedStep(t.key)}d.status=r.getStatus()}}),{capture:!0}),document.addEventListener("idg:pathStepShift",(e=>{const t=e.detail.pathStep,s=e.detail.shift;t.pathwayID==d.uid&&r.shiftStepPos(t,s)}),{capture:!0});const p=()=>{const t=e.dom("label","patient-checkbox"),s=e.div("checkbox-btn");t.append(c,s),o.addIcon.append(t)},h=e=>{e&&(o.assign.innerHTML=e,d.assigned=e)};a.pathway.forEach((e=>u(e))),"discharged"==a.status&&(l.finished(Date.now()),r.discharged()),c.setAttribute("value",`${d.uid}`),p(),(e=>{if(null==e)return;const t=n?"circle":"triangle",s=n?"medium-icon":"",a=["grey","red","amber","green"][e];let i="{{tip}}";switch(e){case 3:i=n?"Priority: Standard":"Patient Risk: 2 (Low)";break;case 2:i=n?"Priority: Urgent":"Patient Risk: 2 (Medium)";break;case 1:i=n?"Priority: Immediate":"Patient Risk: 1 (High)"}o.risks.innerHTML=`<i class="oe-i ${t}-${a} ${s} js-has-tooltip" data-tt-type="basic" data-tooltip-content="${i}"></i>`,d.risk=e})(a.risk),h(a.assign),(e=>{const t=s.pathStep({shortcode:"i-comments",status:"buff",type:e?"comments-added":"comments",idgPopupCode:!e&&"i-comments-none"},!1);o.notes.append(t.render())})(a.notes),d.status="fake-done"==a.status?"done":a.status,i.setAttribute("data-timestamp",a.bookedTimestamp),i.insertAdjacentHTML("beforeend",`<td>${a.time}</td>`),i.insertAdjacentHTML("beforeend",`<td><div class="list-name">${a.clinic[0]}</div><div class="code">${a.clinic[1]}</div></td>`),i.append(t.patientMeta(a)),i.append(t.patientQuickView(a)),i.append(o.path),i.append(o.addIcon),i.append(o.assign),i.append(o.risks),i.append(o.notes),i.append(l.render(d.status)),i.append(o.complete);const g=e=>{switch(e){case"arrived":u({shortcode:"i-arr",status:"buff",type:"arrive",timestamp:Date.now(),idgPopupCode:"arrive-basic"}),u({shortcode:"i-wait",status:"buff",type:"wait",mins:0});break;case"complete":if("active"==d.status)return;u({shortcode:"i-fin",status:"buff",type:"finish",timestamp:Date.now()});break;case"reactivate":if("done"!=d.status)return;r.removeCompleted(),d.status=r.getStatus(),p()}};return{onStateChange:g,getID:()=>d.uid,getStatus:()=>d.status,getWaitingFor:()=>({uid:d.uid,step:r.waitingFor()}),getAssigned:()=>({uid:d.uid,step:d.assigned}),getRedFlagged:()=>d.redFlagged,render:e=>{let t=!1;if("string"!=typeof e)return e.find((e=>e==d.uid))==d.uid?i:null;switch(e){case"all":t=!0;break;case"clinic":t=!("done"==d.status||"later"==d.status);break;case"-f":t=d.redFlagged;break;case"waiting":t="waiting"==d.status||"long-wait"==d.status||"stuck"==d.status;break;case"issues":t="break"==d.status||"long-wait"==d.status||"stuck"==d.status;break;default:t=d.status==e}return d.isRendered=t,t?i:null},addPathStep:u,removePathStep:e=>{r.removeStep(e),d.status=r.getStatus()},setTicked:e=>{"done"!=d.status&&(!d.isRendered&&e||(c.checked=e))},assignee:h,isTicked:()=>c.checked}}})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t){"use strict";t.patientJSON=(s,a=!1,n=!1)=>{const i=JSON.parse(s);i.forEach((t=>{t.uid=e.getToken();const s=n?(e=>{let t=new Date(Date.now()+6e4*e),s=t.getMinutes()%5;return t.setMinutes(t.getMinutes()-s),t.getTime()})(t.booked):Date.now()+6e4*t.booked;t.time=e.clock24(new Date(s)),t.bookedTimestamp=s,t.pathway.forEach(((e,t,s)=>{const a={shortcode:e[0],timestamp:Date.now()+6e4*e[1],mins:e[1],status:e[2],type:e[3]};e[4]&&(a.idgPopupCode=e[4]),s[t]=a}))}));const o=new Map;return i.forEach((e=>{o.set(e.uid,t.patient(e,a))})),o}})(bluejay,bluejay.namespace("clinic")),(function(e,t){"use strict";bluejay.namespace("clinic").patientMeta=e=>{const t=['<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview">','<span class="patient-surname">{{lastname}}</span>, ','<span class="patient-firstname">{{{firstname}}}</span>',"</a>",'<div class="patient-icons">','{{#duplicate}}<i class="oe-i exclamation-orange small pad js-has-tooltip" data-tt-type="basic" data-tooltip-content="Double check details. More than one {{lastname}} in clinic"></i>{{/duplicate}}',"</div>","</div>",'<div class="patient-details">','<div class="nhs-number"><span>NHS</span>{{nhs}}</div>','<div class="gender">{{gender}}</div>','<div class="patient-age"><em>dob</em> {{dob}} <span class="yrs">{{age}}</span></div>',"</div>","</div>"].join(""),s=document.createElement("td");return s.innerHTML=Mustache.render(t,e),s}})(),(function(e,t){"use strict";bluejay.namespace("clinic").patientQuickView=e=>{const t=document.createElement("i");t.className="oe-i eye-circle medium pad js-patient-quick-overview",t.setAttribute("data-mode","side"),t.setAttribute("data-php","patient/quick/overview.php"),t.setAttribute("data-patient",JSON.stringify({surname:e.lastname,first:e.firstname,id:!1,nhs:e.nhs,gender:e.gender,age:e.age}));const s=document.createElement("td");return s.appendChild(t),s}})(),(function(e,t){"use strict";bluejay.namespace("clinic").waitDuration=t=>{const s=document.createElement("td");let a=null,n=0,i=null;const o=(e=!1)=>{const t=0==e?Date.now():e;n=Math.floor((t-a)/6e4)},r=()=>{o(),i=setInterval((()=>{o(),c("active")}),15e3)},l=t=>{const s=e.div("mins"),a=Math.floor(n/60),i=(n%60).toString().padStart(2,"0");return s.innerHTML=t?`<small>${a}:${i}</small>`:`${a}:${i}`,s},c=t=>{const a=e.div();switch(t){case"discharged":case"done":a.className="wait-duration stopped",a.append(l(!1));break;default:a.className="wait-duration",a.append((()=>{let e="green";n>120&&(e="yellow"),n>180&&(e="orange"),n>240&&(e="red");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class",`duration-graphic ${e}`),t.setAttribute("viewBox","0 0 48 12"),t.setAttribute("height",12),t.setAttribute("width",48);for(let e=0;e<4;e++){const s=12*(e+1)-6,a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("class",`c${e}`),a.setAttribute("cx",`${s}`),a.setAttribute("cy","6"),a.setAttribute("r","6"),t.appendChild(a)}return t})(),l(!0))}return e.empty(s),s.append(a),s};return{arrived:e=>{null===a&&(a=e,r())},finished:e=>{clearInterval(i),a&&o(e)},startTimer:r,render:c}}})(bluejay),(function(e,t){"use strict";t.addList=(s,a,n)=>{const i=t.patientJSON(s.json,s.usesPriority,s.fiveMinBookings);let o=!0;const r=e.dom("section","oec-group");r.id=`idg-list-${a}`,r.setAttribute("data-id",a),r.setAttribute("data-title",`${s.title}`),((t,s)=>{const a=s.usesPriority?"circle":"triangle",n=e.dom("header",!1,`<h3>${s.title} : ${s.date}</h3>`),i=e.dom("table","oec-patients");i.innerHTML=Mustache.render(["<thead><tr>{{#th}}<th>{{{.}}}</th>{{/th}}</tr></thead>","<tbody></tbody>"].join(""),{th:["Time","Clinic","Patient","\x3c!-- meta data --\x3e","Pathway",'<label class="patient-checkbox"><input class="js-check-patient" value="all" type="checkbox"><div class="checkbox-btn"></div></label>','<i class="oe-i person no-click small"></i>',`<i class="oe-i ${a}-grey no-click small"></i>`,'<i class="oe-i comments no-click small"></i>',"Total duration","\x3c!-- complete icon --\x3e"]}),t.append(n,i)})(r,s),n.append(r);const l=r.querySelector("tbody");t.clock(l),r.addEventListener("change",(e=>{const t=e.target;t.matches(".js-check-patient")&&"all"==t.value&&i.forEach((e=>e.setTicked(t.checked)))}),{useCapture:!0});return{render:t=>{const s=new DocumentFragment;if(i.forEach((e=>{const a=e.render(t);null!=a&&s.append(a)})),e.empty(l),l.append(s),0===l.rows.length){const t=e.dom("tr","no-results",'<td>\x3c!-- padding --\x3e</td><td colspan=\'9\' style="padding:20px 0" class="fade">No patients found</div></td>');l.append(t)}},addStepsToPatients:e=>{const{c:t,s:s,t:a,i:n}=e;i.forEach((e=>{e.isTicked()&&("c-last"==t?e.removePathStep(t):"assign"==t?e.assignee(s):e.addPathStep({shortcode:t,status:s,type:a,timestamp:Date.now(),idgPopupCode:n||!1}))}))},getPatientFilterState:()=>{const e=[],t=[],s=[],a=[];return o&&i.forEach((n=>{e.push(n.getStatus()),t.push(n.getRedFlagged()),s.push(n.getWaitingFor()),a.push(n.getAssigned())})),{status:e,redflagged:t,waitingFor:s,assignments:a}},untickPatients:()=>{i.forEach((e=>e.setTicked(!1))),r.querySelector("thead .js-check-patient").checked=!1},patientStateChange:(e,t)=>{i.has(e)&&i.get(e).onStateChange(t)},showList:t=>{t.has(a)?(e.show(r),o=!0):(e.hide(r),o=!1)}}}})(bluejay,bluejay.namespace("clinic")),(function(e,t){"use strict";e.addModule("gui.pathStep");t.pathStep=(()=>{const s="oe-pathstep-btn",a=new e.Collection,n=()=>({userDown(){t.pathStepPopup.full(this,!1)},userOver(){t.pathStepPopup.quick(this)},userOut(){t.pathStepPopup.hide()}}),i=()=>({render(){return this.span.className=[s,this.status,this.type].join(" "),this.displayInfo(),this.span}}),o=()=>({setCode(e){this.shortcode=e;const t=this.span.querySelector(".step");e.startsWith("i-")?(t.textContent="",t.className=`step ${e}`):(t.className="step",t.textContent=e),this.render()},getCode(){return this.shortcode},setStatus(e){if(!["config","todo","todo-next","active","done","buff"].find((t=>t==e)))throw new Error(`PathStep: invaild status: "${e}".`);this.status=e,this.render()},getStatus(){return this.status},setType(e){if(!["none","process","person","wait","hold","delayed-wait","arrive","red-flag","fork","break","break-back","finish","comments","comments-added"].find((t=>t==e)))throw new Error(`PathStep: invaild type: "${e}"`);this.type=e,this.render()},getType(){return this.type},isRemovable(){let e="config"==this.status||"todo"==this.status||"todo-next"==this.status||"buff"==this.status;return"buff"==this.status&&(e=!("wait"==this.type||"wait long"==this.type||"break"==this.type)),e},nextState(){let t=!1;switch(this.status){case"config":t="todo";break;case"todo":case"todo-next":t="active";break;case"active":t="done",this.info&&(this.info.textContent=e.clock24(new Date(Date.now())));break;case"buff":"break"==this.type&&(this.type="break-back",this.render(),this.renderPopup(),e.customEvent("idg:pathStepChange",this))}t&&this.changeState(t)},prevState(){let e=!1;switch(this.status){case"todo":e="config";break;case"done":case"active":e="todo"}e&&this.changeState(e)},jumpState(e){this.changeState(e)},changeState(s){this.setStatus(s),e.customEvent("idg:pathStepChange",this),t.pathStepPopup.remove(),"done"!=s&&"hold"!=this.type&&this.renderPopup(),"hold"==this.type&&("active"==this.status?this.holdTimer():this.span.querySelector("svg").remove())},renderPopup(){t.pathStepPopup.full(this,!0)},setIdgPopupCode(e){this.idgCode=e},removeIdgPopupCode(){delete this.idgCode},holdTimer(){const e="http://www.w3.org/2000/svg",t=(e,t,s)=>e.setAttribute(t,s),s=document.createElementNS(e,"svg"),a=document.createElementNS(e,"circle");t(s,"class","progress-ring"),t(s,"viewBox","0 0 34 34"),t(a,"fill","transparent"),t(a,"r",15),t(a,"cx",17),t(a,"cy",17),s.append(a),this.span.append(s);const n=30*Math.PI;a.style.strokeDasharray=`${n} ${n}`,a.style.strokeDashoffset=n;const i=6e4*Number(this.shortcode);let o=null;const r=e=>{o=o||e;const t=e-o;let s=t/i*100;s<2&&(s=2);const l=n-s/100*n;s>100?this.jumpState("done"):"active"==this.status&&t<i&&(a.style.strokeDashoffset=l,setTimeout(window.requestAnimationFrame(r),300))};window.requestAnimationFrame(r)}}),r=()=>({setInfo(t){"hold"!=this.type&&!1!==t&&(this.info=e.dom("span","info"),this.info.innerHTML="clock"===t?e.clock24(new Date(Date.now())):t,this.span.append(this.info),"i-wait"!=this.shortcode&&"i-delayed"!=this.shortcode||this.countWaitMins())},countWaitMins(){"i-wait"!=this.shortcode&&"i-delayed"!=this.shortcode||setTimeout((()=>{const t=parseInt(this.info.textContent,10)+1;this.info.textContent=t,t>59&&"i-wait"==this.shortcode&&(this.setType("delayed-wait"),this.setCode("i-delayed"),e.customEvent("idg:pathStepChange",this)),this.countWaitMins()}),6e4)},displayInfo(){this.info&&("active"==this.status||"i-fin"==this.shortcode||"i-wait"==this.shortcode||"i-delayed"==this.shortcode?e.show(this.info):e.hide(this.info),"i-arr"==this.shortcode&&"done"==this.status&&e.show(this.info))}}),l=()=>({remove(){this.span.remove(),a.delete(this.key)},userRemove(){this.remove(),this.status="userRemoved",e.customEvent("idg:pathStepChange",this)}}),c=e=>Object.assign({span:e},{setKey(e){this.key=e}},i(),o(),r(),n(),l()),d=e=>{const t=a.getKey(e);return a.get(t)};e.userLeave(`.${s}`,(e=>d(e.target).userOut())),e.userEnter(`.${s}`,(e=>d(e.target).userOver())),e.userDown(`.${s}`,(e=>d(e.target).userDown()));return({shortcode:t,status:n,type:i,info:o,idgPopupCode:r},l,d=null)=>{const u=t.startsWith("i-")?`<span class="step ${t}"></span>`:`<span class="step">${t}</span>`,p=c(e.dom("span",s,u));p.shortcode=t,p.setStatus(n),p.setType(i),p.setInfo(o),p.pathwayID=d,"hold"==p.getType()&&"active"==p.getStatus()&&p.holdTimer();const h=p.render();return r&&p.setIdgPopupCode(r),p.setKey(a.add(p,h)),l&&l.append(h),p}})()})(bluejay,bluejay.namespace("gui")),(function(e,t,s){"use strict";e.addModule("gui.pathStep");t.pathStepPopup=(()=>{const t=e.div("oe-pathstep-popup");let s=null,a=!1,n=null,i=null;const o=(s,a,n,o)=>{const r=`${s.replaceAll(" ","-")}.${a}.${n}`.toLowerCase();e.xhr(`/idg-php/load/pathstep/_ps.php?full=${o}&code=${r}`,i).then((s=>{if(i!=s.token)return;e.empty(t);const a=e.div("slide-open");a.innerHTML=s.html,t.append(a,(t=>{const s=e.div("close-icon-btn");return s.innerHTML=t?'<i class="oe-i remove-circle medium-icon"></i>':'<i class="oe-i expand small-icon"></i>',s})(o)),t.style.height=a.scrollHeight+22+"px"})).catch((e=>console.log("PHP failed to load",e)))},r=({shortcode:a,status:n,type:i,span:r,idgCode:c},d)=>{clearTimeout(s);const u=c||a;e.empty(t),t.classList.remove("arrow-t","arrow-b"),t.removeAttribute("style");const p=e.dom("h3","title");p.innerHTML='<i class="spinner as-icon"></i>',t.append(p),o(u,n,i,d);const h=e.getWinH(),g=r.getBoundingClientRect();t.style.left=g.right-380+"px",g.bottom<.6*h?(t.style.top=g.bottom+2+"px",t.style.bottom="auto",t.classList.add("arrow-t")):(t.style.top="auto",t.style.bottom=h-g.top+2+"px",t.classList.add("arrow-b")),document.body.append(t),document.body.querySelector("main").addEventListener("scroll",l,{capture:!0,once:!0})},l=()=>{n=null,a=!1,s=setTimeout((()=>t.remove()),50)};e.userDown(".oe-pathstep-popup .close-icon-btn .oe-i",l),e.userDown(".oe-pathstep-popup .js-idg-ps-popup-btn",(t=>{const s=t.target.dataset.action;switch(s){case"remove":n.userRemove(),l();break;case"next":n.nextState();break;case"done":n.jumpState(s);break;case"prev":n.prevState();break;case"left":case"right":e.customEvent("idg:pathStepShift",{pathStep:n,shift:"right"==s?1:-1}),e.customEvent("idg:AppUpdateFilters");break;case"DNA":n.setCode("DNA"),n.jumpState("done");break;default:e.log(`PathStepPopup: Unknown request state: ${s}`)}})),e.userDown(".oe-pathstep-popup .js-customise-view i.js-edit",(s=>{e.show(t.querySelector(".js-customise-edit")),e.hide(t.querySelector(".js-customise-view"))}));const c=()=>{e.hide(t.querySelector(".js-customise-edit")),e.show(t.querySelector(".js-customise-view"))};return e.userDown(".oe-pathstep-popup .js-customise-edit i.js-save",(s=>{return a=s.target.previousSibling.value,n.setCode(a),n.removeIdgPopupCode(),t.querySelector(".js-customise-view h3").textContent=a,c(),void e.customEvent("idg:AppUpdateFilters");var a})),e.userDown(".oe-pathstep-popup .js-customise-edit i.js-cancel",(()=>c())),t.addEventListener("input",(e=>{if(e.target.matches("input.js-step-comments")){const s=e.target;t.querySelector(".js-comments-view em.comment").textContent=s.value;const a=s.value.length,n=Number(s.getAttribute("maxlength"));t.querySelector(".js-comments-edit .percent-bar").style.width=a/n*100+"%"}})),e.userDown(".oe-pathstep-popup .step-comments i.js-save",(s=>{e.hide(t.querySelector(".js-comments-edit")),e.show(t.querySelector(".js-comments-view")),s.target.classList.replace("save-plus","save")})),e.userDown(".oe-pathstep-popup .step-comments i.js-edit",(()=>{e.show(t.querySelector(".js-comments-edit")),e.hide(t.querySelector(".js-comments-view"))})),{full:(e,t=!1)=>{e===n&&0==t?l():(n=e,i=e.key,a=!0,r(e,!0))},quick:e=>{a||(i=e.key,r(e,!1))},hide:()=>{a||l()},remove:l}})()})(bluejay,bluejay.namespace("gui"),bluejay.namespace("clinic")),(function(e,t){"use strict";if(e.addModule("queueManager"),null===document.getElementById("js-queue-mgmt-app"))return;const s=e.div("oe-popup-wrap",'<div class="spinner"></div><div class="spinner-message">Loading...</div>');document.body.append(s),setTimeout((()=>a()),500);const a=()=>{e.log("[Queue Manager] - intialising"),t.app(JSON.parse(idgQueueDemoJSON)),s.remove()}})(bluejay,bluejay.namespace("queue")),(function(e,t){"use strict";const s=new Map,a=new Map,n=t=>{const s=e.getToken(),a=e.div("patient");a.id=s,a.setAttribute("draggable",!0);let n=t.risk?"urgent":"grey";return a.innerHTML=`<i class="oe-i triangle-${n} small pad-right selected"></i> ${t.lastname}, ${t.firstname}`,{id:s,div:a,queue:null,queuePos:null,queueChange(e){this.queue!=e&&(this.queue&&this.queue.removePatient(this.queuePos),this.queue=e)},setQueuePos(e){this.queuePos=e}}},i=({id:t,header:s,root:a})=>{const n=e.div("queue"),i=e.div("patient-list");n.id=t,n.innerHTML="q0"==t?`<header class="in-flow">${s}</header>`:`<header>${s}</header>`,n.append(i);const o=e.div("side-queue-btn selected");return o.setAttribute("data-queue",t),o.innerHTML=`${s}<div class="patients"></div>`,document.getElementById("idg-side-queue-clinicians").append(o),a.append(n),{id:t,div:n,btn:o,capacity:10,btnPatients:o.querySelector(".patients"),patientList:i,list:[],updatePatients(){this.list.forEach(((e,t)=>e.setQueuePos(t)));const e=this.list.length>21?21:this.list.length;this.btnPatients.style.width=11*e+"px"},changePatientPos(e,t){this.list[e.queuePos]=null,this.list.splice(t,0,e);const s=this.list.findIndex((e=>null===e));this.list.splice(s,1),this.render()},addPatientAndPos(e,t){e.queueChange(this),this.list.splice(t,0,e),this.render()},addPatient(e){e.queueChange(this),this.list.push(e),this.render()},removePatient(e){this.list.splice(e,1),this.render()},render(){const t=new DocumentFragment;this.list.forEach((e=>t.append(e.div))),e.empty(i),i.append(t),this.updatePatients()}}},o=e=>{e.target.classList.add("moving"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",e.target.id)},r=e=>{e.target.classList.remove("moving")},l=t=>{if(t.preventDefault(),t.dataTransfer.dropEffect="move",t.target.matches(".queue")){e.find(".patient-list",t.target).classList.add("add-to-end")}return t.target.matches(".queue .patient-list .patient")&&(t.target.classList.add("add-above"),t.target.classList.remove("over")),!1},c=t=>{if(t.target.matches(".queue")){e.find(".patient-list",t.target).classList.remove("add-to-end")}t.target.matches(".queue .patient-list .patient")&&t.target.classList.remove("add-above")},d=t=>{t.preventDefault();const n=t.dataTransfer.getData("text/plain"),i=a.get(n);if(t.target.matches(".queue")){e.find(".patient-list",t.target).classList.remove("add-to-end");s.get(t.target.id).addPatient(i)}if(t.target.matches(".queue .patient-list .patient")){if(t.target.classList.remove("add-above"),n==t.target.id)return!1;const e=a.get(t.target.id),s=e.queue;e.queue==i.queue?s.changePatientPos(i,e.queuePos):s.addPatientAndPos(i,e.queuePos)}return!1};t.app=t=>{const u=document.getElementById("js-queue-mgmt-app"),p=(e,t)=>{s.set(e,i({id:e,header:t,root:u}))};p("q0","New referrals"),p("q1","Dr Amit Baum"),p("q2","Dr Angela Glasby"),p("q3","Dr Robin Baum"),t.forEach((e=>{const t=n(e);a.set(t.id,t);s.get("q"+e.qNum).addPatient(t)}));const h=()=>{const e=["SMITH","JONES","TAYLOR","BROWN","WILLIAMS","JOHNSON","DAVIES"],t=["Jack (Mr)","David (Mr)","Sarah (Ms)","Lucy (Mrs)","Jane (Mrs)","Mark (Mr)","James (Mr)","Ian (Mr)"],i=n({lastname:e[Math.floor(Math.random()*e.length)],firstname:t[Math.floor(Math.random()*t.length)],risk:Math.random()<.2});a.set(i.id,i),s.get("q0").addPatient(i);const o=2e3*Math.floor(3*Math.random())+4e3;setTimeout(h,o)};setTimeout(h,4e3),u.addEventListener("dragstart",o,{useCapture:!0}),u.addEventListener("dragover",l,{useCapture:!0}),u.addEventListener("dragleave",c,{useCapture:!0}),u.addEventListener("dragend",r,{useCapture:!0}),u.addEventListener("drop",d,{useCapture:!0}),e.userEnter(".queue  .patient",(e=>e.target.classList.add("over"))),e.userLeave(".queue  .patient",(e=>e.target.classList.remove("over"))),e.userDown(".side-queue-btn",(t=>{const a=t.target,n=s.get(t.target.dataset.queue);a.classList.contains("selected")?(a.classList.remove("selected"),e.hide(n.div)):(a.classList.add("selected"),e.show(n.div))}))}})(bluejay,bluejay.namespace("queue")),(function(e){"use strict";if(null===document.querySelector("#tinymce-letterheader-editor"))return;let t=null;const s={user_name:{label:"User Name",value:"<span>Admin Admin</span>"},firm_name:{label:"Firm Name",value:"<span>Glaucoma Clinic</span>"},site_name:{label:"Site Name",value:"<span>Kings Hospital</span>"},site_phone:{label:"Site Phone",value:"<span>0123456789</span>"},site_fax:{label:"Site Fax",value:null},site_email:{label:"Site Email",value:null},site_address:{label:"Site Address",value:"<span>100 Main Road</span>"},site_city:{label:"Site City",value:"<span>London</span>"},site_postcode:{label:"Site Postcode",value:"<span>W1 1AA</span>"},primary_logo:{label:"Primary Logo",value:'<img src="/idg-php/imgDemo/correspondence/letterhead-logo.png">'},secondary_logo:{label:"Secondary Logo",value:null},current_date:{label:"Today's Date",value:"<span>"+document.documentElement.dataset.today+"</span>"}};tinymce.init({selector:"#tinymce-letterheader-editor",schema:"html5-strict",branding:!1,min_height:400,menubar:!1,plugins:["lists table paste code"],contextmenu:"table",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | table | code",custom_undo_redo_levels:10,hidden_input:!1,block_formats:"Paragraph=p; Header 2=h2; Header 3=h3",content_css:"/newblue/css/style_oe3_print.min.css",setup:function(e){e.on("init",(function(a){t=e,(()=>{var e=new DocumentFragment;for(const a in s){let n=s[a].label,i=s[a].value;if(null!==i){var t=document.createElement("button");t.className="idg-quick-insert",t.textContent=n,t.setAttribute("data-insert",JSON.stringify({key:a,value:i})),e.appendChild(t)}}document.querySelector(".editor-quick-insert-btns").appendChild(e)})()}))}}),e.userDown(".idg-quick-insert",(e=>{let s=JSON.parse(e.target.dataset.insert);var a,n;a=s.key,n=s.value,t.insertContent('<span contenteditable="false" data-substitution="'+a+'">'+n+"</span>")}))})(bluejay),(function(e){"use strict";if(null==document.getElementById("js-idg-annotate-image-tester"))return;const t=()=>{e.log(`[Annotate] - Fabric Version ${fabric.version}`);const t=document.getElementById("js-idg-annotate-image-tester"),s=t.querySelector(".line-width");let a=null,n="#f00";const i=document.createElement("canvas");i.id="c1",i.textContent="Image annotation tool",t.querySelector(".canvas-js").append(i);const o=new fabric.Canvas("c1");fabric.Object.prototype.set({borderColor:"rgb(0,255,255)",cornerColor:"rgb(0,255,255)",cornerSize:12,transparentCorners:!1}),o.freeDrawingBrush.color=n,o.freeDrawingBrush.width=12;const r=(e,s,a)=>{o.clear();const n=t.offsetWidth-170,i=n/s;o.setHeight(a*i),o.setWidth(n),fabric.Image.fromURL(`/idg-php/imgDemo/annotate/${e}.jpg`,(e=>{e.scale(i),o.setBackgroundImage(e,o.renderAll.bind(o))}))},l=(()=>{let e,t;o.on("mouse:down",(s=>(s=>{if(!e||t)return;t=!0;const a=new fabric.Circle({radius:30,left:s.pointer.x-30,top:s.pointer.y-30,fill:!1,stroke:n,strokeWidth:4,centeredScaling:!0});o.add(a),o.setActiveObject(a)})(s))),o.on("selection:cleared",(()=>t=!1));return{start:()=>{e=!0,t=!1},stop:()=>{e=!1}}})(),c=(()=>{let e,t;const s=new fabric.Triangle({width:30,height:30,fill:"red",left:30,top:30}),a=new fabric.Line([42,60,42,120],{stroke:"red",strokeWidth:7}),n=new fabric.Group([s,a],{originY:"top"});o.on("mouse:down",(s=>(s=>{if(!e||t)return;let a;t=!0,n.clone((e=>a=e));const i=o.height/2>s.pointer.y,r=o.width/2>s.pointer.x;let l,c,d;i?r?(l=-45,c=s.pointer.x,d=s.pointer.y+18):(l=45,c=s.pointer.x-18,d=s.pointer.y):r?(l=-135,c=s.pointer.x+20,d=s.pointer.y):(l=135,c=s.pointer.x,d=s.pointer.y-20),a.rotate(l),a.set({top:d,left:c}),o.add(a),o.setActiveObject(a)})(s))),o.on("selection:cleared",(()=>t=!1));return{start:()=>{e=!0,t=!1},stop:()=>{e=!1}}})(),d=e=>{if("erase"!=e.name)switch(a&&a.classList.remove("draw"),a=e,e.classList.add("draw"),l.stop(),c.stop(),o.set("isDrawingMode",!1),o.set("defaultCursor","crosshair"),s.style.display="none",e.name){case"manipulate":o.set("defaultCursor","auto");break;case"freedraw":o.set("isDrawingMode",!0),s.style.display="block";break;case"circle":l.start();break;case"pointer":c.start()}else o.remove(o.getActiveObject())};e.userDown(".js-tool-btn",(e=>d(e.target))),s.querySelector("input").addEventListener("change",(e=>{const t=e.target.value;s.querySelector("small").textContent=`Line width: ${t}`,o.freeDrawingBrush.width=4*t}));const u=document.getElementById("js-idg-annotate-image");if(null!=u){const e=u.options,t=t=>{const s=e[t],a=JSON.parse(s.dataset.idg);r(s.value,a.w,a.h)};u.addEventListener("change",(()=>{t(e.selectedIndex)}),!1),t(0)}else r("widefield",1392,1010);d(document.querySelector('.js-tool-btn[name="freedraw"]'))};e.loadJS("https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.3.1/fabric.min.js",!0).then((()=>t()))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-btx-inj-svg"))return;const t=document.querySelector(".btx-face"),s=document.querySelector(".btx-eyeballs"),a=document.querySelector("table.btx-list"),n=document.getElementById("js-idg-btx-unit-total"),i=Object.assign({_muscles:"face",_injections:[],get muscles(){return this._muscles},set muscles(e){this._muscles=e,this._injections.forEach((e=>e.div.remove())),this._injections=[],this.views.notify()},set injections(e){e.humanUnits=e.units.toFixed(1),this._injections.push(e),this.views.notify()},get injections(){return this._injections},injNum(){return this._injections.length},removeInj(e){const t=this._injections;t[e].div.remove(),t.splice(e,1),t.forEach(((e,t)=>{e.injCount=t+1,e.ref=t,e.div.innerHTML=r(e.units,e.injCount)})),this.views.notify()},volumeChange(e,t){const s=this._injections[e],a=Math.round(10*parseFloat(t));s.vol=a/10,s.units=l(s.vol),s.humanUnits=s.units.toFixed(1),s.div.innerHTML=r(s.units,s.injCount),o()}},e.ModelViews());i.views.add((()=>{"face"==i.muscles?(e.show(t),e.hide(s)):(e.hide(t),e.show(s))}));i.views.add((()=>{const t=["{{#list}}<tr>",'<td><span class="highlighter"><b>{{injCount}}</b></span></td>','<td><input type="text" value="{{muscles}}" class="cols-11"></td>',"<td>{{side}}</td>",'<td><input type="number" step="0.1" min="0" max="5" value="{{vol}}" class="fixed-width-medium js-idg-btx-vol" data-btx="{{ref}}"/></td>',"<td>{{humanUnits}}</td>","<td>Botox (BTX)</td>",'<td><i class="oe-i trash" data-btx="{{ref}}"></i></td>',"</tr>{{/list}}"].join(""),s=a.querySelector("tbody");e.empty(s),s.innerHTML=Mustache.render(t,{list:i.injections})}));const o=()=>{let e=0;i.injections.length&&(e=i.injections.reduce(((e,t)=>e+t.units),0)),n.textContent=e.toFixed(1)};i.views.add(o);const r=(e,t)=>`<div class="units">${e.toFixed(1)}</div><div class="agent">BTX</div><div class="inj-num">${t}</div>`,l=e=>{const t=document.querySelector('input[name="btx-units-ml"]');return e*parseInt(t.value,10)};e.userDown(".js-btx-inj-svg",(a=>{((a,n)=>{const o=document.querySelector('input[name="btx-volume-ml"]'),c=parseInt(10*parseFloat(o.value),10),d=i.injNum(),u=d+1,p=l(c/10),h=e.div("inj-marker");h.style.top=n-30+"px",h.style.left=a+"px",h.innerHTML=r(p,u);let g="",m=a>192?"Left":"Right";"face"==i.muscles?(t.append(h),g="Frontalis",n>118&&(g="Corrugator"),n>139&&(g="Orbicularis upper"),n>190&&(g="Orbicularis lower"),n>242&&(g="Zygomaticus"),n>310&&(g="Mentalis"),n>375&&(g="Platysma"),a<201&&a>174&&n<181&&n>130&&(m="Midline",g="Procerus"),a<245&&a>151&&n<310&&n>280&&(g="Orbicularis oris")):(s.append(h),n<160&&n>136&&(g="Superior"),n<240&&n>218&&(g="Inferior"),n<205&&n>160&&(a<110&&a>70&&(g="Lateral"),a<310&&a>270&&(g="Lateral"),a<230&&a>150&&(g="Medial")),g=g?g+" rectus":"?",n<218&&n>205&&(g="inferior oblique")),i.injections={ref:d,injCount:u,vol:c/10,units:p,div:h,side:m,muscles:g}})(a.offsetX,a.offsetY)})),e.userDown("table.btx-list .trash",(e=>{i.removeInj(parseInt(e.target.dataset.btx,10))})),document.addEventListener("change",(e=>{e.target.matches(".js-idg-btx-vol")&&(i.volumeChange(e.target.dataset.btx,e.target.value),e.target.parentNode.nextSibling.textContent=l(e.target.value).toFixed(1)),e.target.matches('input[name="idg-btx-muscles"]')&&(i.muscles=e.target.value)}))})(bluejay),(function(e){"use strict";null!==document.querySelector(".js-idg-demo-ed2")&&(e.userDown(".js-idg-demo-doodle-drawer",(t=>{let s=t.target;e.getParent(s,"li").classList.toggle("ed2-drawer-open")})),e.userDown(".ed-canvas-edit",(t=>{let s=t.target;e.getParent(s,".ed2-editor").querySelector(".ed2-doodle-popup").classList.toggle("closed")})),e.userDown("#js-idg-demo-ed2-search-input",(e=>{let t=e.target.nextElementSibling;console.log("hi"),"none"==t.style.display?t.style.display="block":t.style.display="none"})))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".oe-worklists.eferral-manager"))return;const t=new e.Collection,s={accepted:null,tr:null,iEdit:null,iState:null,fullName:"JONES, David (Mr)",nhs:"000",age:"42",gender:"Male",riskNum:0,_pathway:null,active(){this.iEdit.classList.replace("pencil","pencil-blue"),this.iEdit.classList.add("selected"),this.tr.classList.add("active")},inactive(){this.iEdit.classList.replace("pencil-blue","pencil"),this.iEdit.classList.remove("selected"),this.tr.classList.remove("active")},accept(){this.accepted=!0,this.iState.classList.replace("status-query","tick-green"),this.iState.classList.replace("cross-red","tick-green")},reject(){this.accepted=!1,this.iState.classList.replace("status-query","cross-red"),this.iState.classList.replace("tick-green","cross-red")},name(){return this.fullName},details(){return`${this.gender}, ${this.age}y`},setRisk(e){this.iRisk=e,this.riskNum=["grey","red","amber","green"].findIndex((t=>e.classList.contains(`triangle-${t}`)))},get risk(){let e='<i class="oe-i triangle-grey small pad-right"></i><b>Moderate</b>&nbsp;(R2)';switch(this.riskNum){case 1:e='<i class="oe-i triangle-red small pad-right"></i><b>High</b>&nbsp;(R1)';break;case 2:e='<i class="oe-i triangle-amber small pad-right"></i><b>Moderate</b>&nbsp;(R2)';break;case 3:e='<i class="oe-i triangle-green small pad-right"></i><b>Low</b>&nbsp;(R3)'}return e},set risk(e){var t,s;this.riskNum=parseInt(e,10),t=this.iRisk,s=e,t.className=`oe-i triangle-${["grey","red","amber","green"][s]} selected`,null===this.accepted&&this.accept()},set pathway(e){this._pathway=e},get pathway(){return this._pathway}};e.nodeArray(document.querySelectorAll("table.eferrals")).forEach((a=>{Array.from(a.tBodies[0].rows).forEach((a=>{if(a.classList.contains("js-locked"))return;let n=Object.create(s);n.tr=a,n.iEdit=a.querySelector(".oe-i.pencil"),n.iState=a.querySelector(".oe-i.js-referral-status-icon"),n.fullName=a.querySelector(".patient-name").textContent,n.age=a.querySelector(".patient-age").textContent.substring(3),n.gender=a.querySelector(".patient-gender").textContent.substring(3),n.nhs=a.querySelector(".nhs-number").textContent.substring(3),n.setRisk(a.querySelector('[class*="triangle-"]')),n.pathway=a.querySelector(".js-pathway").textContent,n.hasImage=Math.random()>=.5;let i=e.getParent(a,".worklist-group");n.group=i.querySelector(".worklist-summary h2").textContent,n.myKey=t.add(n,n.iEdit)}))}));const a=(()=>{let s=null;const n={view:{overview:document.getElementById("sidebar-eferral-overview"),patient:document.getElementById("sidebar-manage-patient"),reject:document.getElementById("sidebar-reject-accept")},btn:{overview:document.getElementById("idg-js-sidebar-viewmode-1"),patient:document.getElementById("idg-js-sidebar-viewmode-2")},patient:{fullName:document.getElementById("js-sidebar-patient-fullname"),details:document.getElementById("js-sidebar-patient-details"),group:document.getElementById("js-sidebar-referral-group"),attachment:document.getElementById("js-demo-attachment-image"),risk:document.getElementById("sidebar-eref-patient-risk"),pathway:document.getElementById("sidebar-eref-pathway"),tests:document.getElementById("sidebar-eref-tests")}};return{change:t=>{"overview"==t?(e.show(n.view.overview),e.hide(n.view.patient),n.btn.overview.classList.add("selected"),n.btn.patient.classList.remove("selected")):(e.hide(n.view.overview),e.show(n.view.patient),n.btn.overview.classList.remove("selected"),n.btn.patient.classList.add("selected"))},managePatient:e=>{null!==s&&s.inactive(),n.patient.fullName.innerHTML=`<span class="highlighter">${e.fullName}</span>`,n.patient.details.innerHTML=[`<small class="fade">NHS</small> ${e.nhs}`,`&nbsp;<small class="fade">Gen</small> ${e.gender}`,`&nbsp;<small class="fade">Age</small> ${e.age}`].join(""),n.patient.group.textContent=e.group,n.patient.risk.innerHTML=e.risk,n.patient.pathway.innerHTML=`<b>${e.pathway}</b>`,n.patient.attachment.style.display=e.hasImage?"block":"none",e.active(),s=e},nextPatient:e=>{const n="next"===e?t.next(s.myKey):t.prev(s.myKey);n&&a.managePatient(t.get(n))},rejectPatient:e=>{e.classList.contains("red")?s.reject():s.accept()}}})();document.addEventListener("DOMContentLoaded",(()=>{a.managePatient(t.getFirst())}),{once:!0});e.userDown(".js-edit-patient-icon",(e=>{let s=e.target,n=t.getKey(s);a.managePatient(t.get(n)),a.change("patient")})),e.userDown("#idg-js-sidebar-viewmode-1",(()=>a.change("overview"))),e.userDown("#idg-js-sidebar-viewmode-2",(()=>a.change("patient"))),e.userDown("#side-patient-next-btn",(()=>a.nextPatient("next"))),e.userDown("#side-patient-previous-btn",(()=>a.nextPatient("prev"))),e.userDown("#sidebar-reject-accept button",(e=>a.rejectPatient(e.target))),document.addEventListener("keydown",(e=>{e.stopPropagation(),"z"===e.key&&a.nextPatient("next"),"a"===e.key&&a.nextPatient("prev")}),!1)})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-event-date-change"))return;e.userDown(".js-event-date-change > .rewind",(t=>{let s=t.target,a=t.target.parentNode.querySelector("input"),n=t.target.parentNode.querySelector(".js-event-date");s.classList.add("disabled"),e.hide(n),e.show(a),setTimeout((()=>a.focus()),20)}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".login.multisite"))return;let t=0;const s=document.querySelector(".login-institution"),a=document.querySelector(".login-site"),n=document.querySelector(".login-details"),i=document.querySelector(".login-steps"),o=document.querySelector("ul.step-options");e.hide(n),e.hide(i);const r=e.div("user");r.innerHTML='<input type="text" placeholder="Username"><input type="password" placeholder="Password"><button class="green hint" id="js-login">Login</button>';const l=(t,l="")=>{switch(t){case 1:document.querySelector(".pre-id").remove(),e.show(n),e.show(i),s.innerHTML="<small>Please select an institution</small>",a.textContent="",o.innerHTML=Mustache.render("{{#options}}<li>{{.}}</li>{{/options}}",{options:["Bolton","Cardiff and Vale University","East Kent Hospitals University","Guy's and St Thomas'","Barking, Havering and Redbridge University Hospitals NHS Trust","Barnet, Enfield and Haringey Mental Health NHS Trust","Barnsley Hospital NHS Foundation Trust","Barts Health NHS Trust","Bedford Hospital NHS Trust","BEDFORDSHIRE HOSPITALS NHS FOUNDATION TRUST","Berkshire Healthcare NHS Foundation Trust","Birmingham and Solihull Mental Health NHS Foundation Trust","Birmingham Community Healthcare NHS Foundation Trust","Birmingham Women's and Children's NHS Foundation Trust","Black Country Healthcare NHS Foundation Trust","Blackpool Teaching Hospitals NHS Foundation Trust","Bolton NHS Foundation Trust","Bradford District NHS Foundation Trust","Bradford Teaching Hospitals NHS Foundation Trust","Bridgewater Community Healthcare NHS Foundation Trust","Brighton and Sussex University Hospitals NHS Trust","Buckinghamshire Healthcare NHS Trust","Burton Hospitals NHS Foundation Trust"]});break;case 2:s.innerHTML=`${l}<i class="oe-i remove-circle small-icon pad-left"></i>`,a.innerHTML="<small>Please select a site</small>",o.innerHTML=Mustache.render("{{#options}}<li>{{.}}</li>{{/options}}",{options:["Kings site","Queens site","Another site"]});break;case 3:a.innerHTML=`${l}<i class="oe-i remove-circle small-icon pad-left"></i>`,i.parentNode.insertBefore(r,i.nextSibling),i.remove()}};l(t),e.userDown(".step-options li",(e=>{const s=e.target;l(++t,s.textContent)})),e.userDown("#js-user-email-id",(()=>l(++t)))})(bluejay),(function(e){"use strict";bluejay.demoLoginTimeOut=()=>{const e=document.createElement("div");e.className="oe-popup-wrap dark",document.body.appendChild(e);const t=['<div class="oe-login timeout">','<div class="login">',"<h1>Timed out</h1>",'<div class="login-details">','<ul class="row-list">','<li class="login-institution">Cardiff and Vale University</li>','<li class="login-site">Queens site</li>',"</ul>","</div>",'<div class="user">','<input type="text" placeholder="Username">','<input type="password" placeholder="Password">','<button class="green hint" id="js-login">Login</button>',"</div>",'<div class="info">',"You have been logged out for security reasons. Please login to continue","</div>",'<div class="flex-c"><a href="/v3/login-multisite" class="button">Or exit to homepage</a></div>',"</div>","</div>"].join("");e.innerHTML=Mustache.render(t,{})}})(),(function(e){"use strict";if(null===document.querySelector(".js-idg-demo-13420"))return;document.addEventListener("input",(t=>{let s=t.target;if(s.matches(".js-idg-demo-13420 .toggle-switch input")){let t=e.getParent(s,"tr"),a=t.querySelector(".js-idg-ongoing-text"),n=t.querySelector(".js-idg-date-stop"),i=t.querySelector(".js-idg-duration-dispense"),o=t.querySelector(".js-idg-taper-btn"),r=t.querySelector(".js-idg-stopped-reasons");s.checked?(e.hide(n),e.hide(r),e.show(a,"block"),e.show(i,"block"),e.show(o,"block")):(e.show(n,"block"),e.hide(a),e.hide(i),e.hide(o))}}));const t=(t,s)=>{let a=t.querySelector(".js-idg-stop-btn"),n=t.querySelector(".js-idg-stop-date"),i=t.querySelector(".js-idg-stopped-reasons"),o=t.querySelector(".js-idg-cancel-stop");s?(e.hide(a),e.show(n,"block"),e.show(i,"block"),e.show(o,"block")):(e.show(a,"block"),e.hide(n),e.hide(i),e.hide(o))};document.addEventListener("click",(s=>{s.target.matches(".js-idg-stop-btn")&&t(e.getParent(s.target,"td"),!0)})),document.addEventListener("mousedown",(s=>{s.target.matches(".js-idg-cancel-stop")&&t(e.getParent(s.target,"td"),!1)})),document.addEventListener("mousedown",(e=>{let t=e.target;if(t.matches(".js-show-medication-history")){document.querySelectorAll(".js-idg-medication-history-"+t.dataset.idgdemo).forEach((e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"}))}}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".home-messages"))return;const t={messages:document.getElementById("idg-js-sidebar-viewmode-1"),tags:document.getElementById("idg-js-sidebar-viewmode-2")},s={messages:document.querySelector(".sidebar-messages"),tags:document.querySelector(".sidebar-tags")},a={messages:document.querySelector(".messages-all"),tags:document.querySelector(".tags-all")};e.userDown("#idg-js-sidebar-viewmode-1",(()=>{t.messages.classList.contains("selected")||(t.messages.classList.add("selected"),t.tags.classList.remove("selected"),e.show(s.messages),e.hide(s.tags),e.show(a.messages),e.hide(a.tags))})),e.userDown("#idg-js-sidebar-viewmode-2",(()=>{t.tags.classList.contains("selected")||(t.messages.classList.remove("selected"),t.tags.classList.add("selected"),e.hide(s.messages),e.show(s.tags),e.hide(a.messages),e.show(a.tags))}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-diagnosis-active-switcher"))return;const t=(t,a)=>{let n=t.querySelector(".js-idg-diagnosis-text"),i=t.querySelector(".toggle-switch"),o=t.querySelector(".remove-circle"),r=t.querySelector(".js-idg-diagnosis-add-btn"),l=t.querySelector(".js-idg-diagnosis-doubt"),c=t.querySelector(".js-idg-diagnosis-doubt-input"),d=t.dataset.idgside,u=t.parentNode.previousElementSibling.querySelector(".oe-eye-lat-icons .oe-i"),p=t.parentNode.nextElementSibling.querySelector(".js-idg-diagnosis-date");switch(a){case"active":e.reshow(n),e.reshow(i),e.reshow(l),e.hide(o),e.hide(r),e.reshow(p),n.textContent="Active (confirmed)",n.classList.remove("fade"),l.querySelector("input").checked=!1,i.querySelector("input").checked=!0,s(u,d,"active");break;case"confirmed":e.hide(c),e.reshow(n);break;case"doubt":e.reshow(c),e.hide(n);break;case"inactive":e.reshow(n),e.reshow(i),e.reshow(o),e.hide(r),e.hide(l),e.hide(c),e.reshow(p),n.textContent="Inactive from",n.classList.add("fade"),s(u,d,"inactive");break;case"removed":e.hide(i),e.hide(o),e.reshow(r),e.hide(p),n.textContent="Not present",s(u,d,"none")}},s=(e,t,s)=>{if(null===e)return;let a=["oe-i"],n="left"==t?"L":"R";switch(s){case"active":a.push("laterality",n);break;case"inactive":a.push("laterality",n+"i");break;case"none":a.push("laterality","NA")}a.push("small","pad"),e.className=a.join(" ")};let a=null;const n=(t,s)=>{let n=t.querySelector(".js-idg-diagnosis-state-options"),i=t.querySelector(".js-idg-right-icon .oe-systemic-icons"),o=t.querySelector(".js-idg-right-icon .oe-eye-lat-icons .oe-i");if(s){n.innerHTML='<span class="oe-eye-lat-icons"><i class="oe-i laterality NA small pad"></i></span>',n.colSpan=0;let s=t.insertCell(2),a=t.insertCell(3);if(s.innerHTML='<div class="flex-layout cols-11 js-idg-diagnosis-active-switcher" data-idgdemo="-r-nSysEx2" data-idgside="right"><div class="js-idg-diagnosis-actions"><label class="toggle-switch" style="display: none;"><input type="checkbox"><div class="toggle-btn"></div></label><label class="inline highlight js-idg-diagnosis-doubt" style="display: none;"><input value="diagnosis-doubt" name="idg-4131" type="checkbox"> <i class="oe-i doubt small-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="? = doubts; suspected, etc"></i></label><i class="oe-i remove-circle small-icon pad-left" style="display: none;"></i><button class="js-idg-diagnosis-add-btn ">Add right side</button></div><div class="js-idg-diagnosis-state"><input class="js-idg-diagnosis-doubt-input" value="Suspected" placeholder="Suspected" maxlength="32" style="display: none;"><span class="js-idg-diagnosis-text js-active-state fade ">Not present</span></div></div>',a.innerHTML='<div class="js-idg-diagnosis-date"><input type="text" class="date" value="30 Apr 2020"></div>',e.hide(t.cells[5].querySelector(".toggle-switch")),e.hide(t.cells[5].querySelector(".highlight")),null===t.cells[5].querySelector(".js-idg-diagnosis-actions .js-idg-diagnosis-add-btn")){let e=document.createElement("button");e.className="js-idg-diagnosis-add-btn",e.textContent="Add left side",t.cells[5].querySelector(".js-idg-diagnosis-actions").appendChild(e)}else e.reshow(t.cells[5].querySelector(".js-idg-diagnosis-add-btn"));let r=t.cells[5].querySelector(".js-idg-diagnosis-text");r.textContent="Inactive from",r.classList.add("fade"),i.style.display="none",o.style.display="inline-block"}else t.deleteCell(2),t.deleteCell(2),n.innerHTML=a,n.colSpan=3,e.hide(t.cells[3].querySelector(".js-idg-diagnosis-add-btn")),e.reshow(t.cells[3].querySelector(".toggle-switch")),t.cells[3].querySelector(".toggle-switch").checked=!0,e.reshow(t.cells[3].querySelector(".highlight")),n.querySelector("input").checked=!0,i.style.display="inline-block",o.style.display="none"};document.addEventListener("input",(s=>{let n=s.target;if(n.matches(".js-idg-diagnosis-active-switcher .toggle-switch input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"active":"inactive")}if(n.matches(".js-idg-diagnosis-doubt input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"doubt":"confirmed")}if(n.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-diagnosis-state-options input")){((t,s)=>{let n=t.querySelector(".js-idg-sides"),i=t.querySelector(".js-idg-diagnosis-text"),o=t.querySelector(".js-idg-diagnosis-active-switcher"),r=o.querySelector(".toggle-switch"),l=o.querySelector(".js-idg-diagnosis-doubt"),c=o.querySelector(".js-idg-diagnosis-doubt-input"),d=t.querySelector(".js-idg-right-icon .oe-systemic-icons");switch(null==a&&(a=t.querySelector(".js-idg-diagnosis-state-options").innerHTML,e.reshow(i)),s){case"0":e.reshow(n),e.reshow(i),i.textContent="Active (confirmed)",i.classList.remove("fade"),e.reshow(r),r.querySelector("input").checked=!0,e.reshow(l),l.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i person-green small pad";break;case"1":e.hide(n),e.reshow(i),i.textContent="Not present",i.classList.add("fade"),e.hide(r),e.reshow(l),l.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad";break;case"2":e.hide(n),e.reshow(i),i.textContent="Not checked",i.classList.add("fade"),e.hide(r),e.hide(l),e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad"}})(e.getParent(n,".js-idg-demo-sys-diag-side-switcher"),n.value)}})),document.addEventListener("click",(t=>{let s=t.target;if(s.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-sides")){let t=e.getParent(s,".js-idg-demo-sys-diag-side-switcher"),a=s.querySelector(".oe-i");"no-sides"==s.dataset.state?(n(t,!0),s.dataset.state="sides",a.classList.replace("person","person-split")):(n(t,!1),s.dataset.state="no-sides",a.classList.replace("person-split","person"))}})),document.addEventListener("mousedown",(s=>{let a=s.target;var n;if(a.matches(".js-show-diagnosis-history")&&(n=a.dataset.idgdemo,document.querySelectorAll(".js-idg-diagnosis-history-"+n).forEach((e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"}))),a.matches(".js-idg-diagnosis-active-switcher .remove-circle")){let s=e.getParent(a,".js-idg-diagnosis-active-switcher");t(s,"removed")}if(a.matches(".js-idg-diagnosis-add-btn")){let s=e.getParent(a,".js-idg-diagnosis-active-switcher");t(s,"active")}}));e.userDown(".js-idg-demo-remove-oph-diag",(t=>{e.xhr("/idg-php/v3/_load/specific/exam-oph-diag-delete.php").then((t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,s.querySelector(".close-icon-btn").addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(s)}),{once:!0}),document.body.appendChild(s)})).catch((e=>console.log("failed to copy",e)))}))})(bluejay),(function(e){"use strict";e.userDown(".js-idg-fav-demo .expand-fav i",(t=>{const s=t.target,a=e.getParent(s,".fav");s.classList.contains("expand")?(s.classList.replace("expand","collapse"),e.show(a.querySelector(".js-full-details"))):(s.classList.replace("collapse","expand"),e.hide(a.querySelector(".js-full-details")))}))})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);